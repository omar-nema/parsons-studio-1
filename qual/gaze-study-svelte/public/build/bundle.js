var app=function(){"use strict";function t(){}const e=t=>t;function n(t,e){for(const n in e)t[n]=e[n];return t}function r(t){return t()}function i(){return Object.create(null)}function o(t){t.forEach(r)}function s(t){return"function"==typeof t}function a(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let l;function c(t,e){return l||(l=document.createElement("a")),l.href=e,t===l.href}function u(e,...n){if(null==e)return t;const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function h(t){let e;return u(t,(t=>e=t))(),e}function d(t,e,n){t.$$.on_destroy.push(u(e,n))}function f(t,e,n){return t.set(n),e}const p="undefined"!=typeof window;let _=p?()=>window.performance.now():()=>Date.now(),g=p?t=>requestAnimationFrame(t):t;const m=new Set;function v(t){m.forEach((e=>{e.c(t)||(m.delete(e),e.f())})),0!==m.size&&g(v)}function y(t){let e;return 0===m.size&&g(v),{promise:new Promise((n=>{m.add(e={c:t,f:n})})),abort(){m.delete(e)}}}function w(t,e){t.appendChild(e)}function b(t){if(!t)return document;const e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function C(t){const e=I("style");return function(t,e){w(t.head||t,e)}(b(t),e),e}function x(t,e,n){t.insertBefore(e,n||null)}function k(t){t.parentNode.removeChild(t)}function E(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function I(t){return document.createElement(t)}function S(t){return document.createTextNode(t)}function N(){return S(" ")}function T(){return S("")}function R(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function P(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function M(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function A(t,e){t.value=null==e?"":e}function O(t,e,n,r){t.style.setProperty(e,n,r?"important":"")}function D(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e)return void(r.selected=!0)}t.selectedIndex=-1}function L(t,e,n){t.classList[n?"add":"remove"](e)}const F=new Set;let $,q=0;function j(t,e,n,r,i,o,s,a=0){const l=16.666/r;let c="{\n";for(let t=0;t<=1;t+=l){const r=e+(n-e)*o(t);c+=100*t+`%{${s(r,1-r)}}\n`}const u=c+`100% {${s(n,1-n)}}\n}`,h=`__svelte_${function(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}(u)}_${a}`,d=b(t);F.add(d);const f=d.__svelte_stylesheet||(d.__svelte_stylesheet=C(t).sheet),p=d.__svelte_rules||(d.__svelte_rules={});p[h]||(p[h]=!0,f.insertRule(`@keyframes ${h} ${u}`,f.cssRules.length));const _=t.style.animation||"";return t.style.animation=`${_?`${_}, `:""}${h} ${r}ms linear ${i}ms 1 both`,q+=1,h}function z(t,e){const n=(t.style.animation||"").split(", "),r=n.filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")),i=n.length-r.length;i&&(t.style.animation=r.join(", "),q-=i,q||g((()=>{q||(F.forEach((t=>{const e=t.__svelte_stylesheet;let n=e.cssRules.length;for(;n--;)e.deleteRule(n);t.__svelte_rules={}})),F.clear())})))}function B(t){$=t}function U(t){(function(){if(!$)throw new Error("Function called outside component initialization");return $})().$$.on_mount.push(t)}const W=[],H=[],V=[],G=[],Y=Promise.resolve();let K=!1;function X(t){V.push(t)}let Q=!1;const J=new Set;function Z(){if(!Q){Q=!0;do{for(let t=0;t<W.length;t+=1){const e=W[t];B(e),tt(e.$$)}for(B(null),W.length=0;H.length;)H.pop()();for(let t=0;t<V.length;t+=1){const e=V[t];J.has(e)||(J.add(e),e())}V.length=0}while(W.length);for(;G.length;)G.pop()();K=!1,Q=!1,J.clear()}}function tt(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(X)}}let et;function nt(t,e,n){t.dispatchEvent(function(t,e,n=!1){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,!1,e),r}(`${e?"intro":"outro"}${n}`))}const rt=new Set;let it;function ot(){it={r:0,c:[],p:it}}function st(){it.r||o(it.c),it=it.p}function at(t,e){t&&t.i&&(rt.delete(t),t.i(e))}function lt(t,e,n,r){if(t&&t.o){if(rt.has(t))return;rt.add(t),it.c.push((()=>{rt.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}const ct={duration:0};function ut(n,r,i,a){let l=r(n,i),c=a?0:1,u=null,h=null,d=null;function f(){d&&z(n,d)}function p(t,e){const n=t.b-c;return e*=Math.abs(n),{a:c,b:t.b,d:n,duration:e,start:t.start,end:t.start+e,group:t.group}}function g(r){const{delay:i=0,duration:s=300,easing:a=e,tick:g=t,css:m}=l||ct,v={start:_()+i,b:r};r||(v.group=it,it.r+=1),u||h?h=v:(m&&(f(),d=j(n,c,r,s,i,a,m)),r&&g(0,1),u=p(v,s),X((()=>nt(n,r,"start"))),y((t=>{if(h&&t>h.start&&(u=p(h,s),h=null,nt(n,u.b,"start"),m&&(f(),d=j(n,c,u.b,u.duration,0,a,l.css))),u)if(t>=u.end)g(c=u.b,1-c),nt(n,u.b,"end"),h||(u.b?f():--u.group.r||o(u.group.c)),u=null;else if(t>=u.start){const e=t-u.start;c=u.a+u.d*a(e/u.duration),g(c,1-c)}return!(!u&&!h)})))}return{run(t){s(l)?(et||(et=Promise.resolve(),et.then((()=>{et=null}))),et).then((()=>{l=l(),g(t)})):g(t)},end(){f(),u=h=null}}}const ht="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function dt(t){t&&t.c()}function ft(t,e,n,i){const{fragment:a,on_mount:l,on_destroy:c,after_update:u}=t.$$;a&&a.m(e,n),i||X((()=>{const e=l.map(r).filter(s);c?c.push(...e):o(e),t.$$.on_mount=[]})),u.forEach(X)}function pt(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function _t(t,e){-1===t.$$.dirty[0]&&(W.push(t),K||(K=!0,Y.then(Z)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function gt(e,n,r,s,a,l,c,u=[-1]){const h=$;B(e);const d=e.$$={fragment:null,ctx:null,props:l,update:t,not_equal:a,bound:i(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(h?h.$$.context:[])),callbacks:i(),dirty:u,skip_bound:!1,root:n.target||h.$$.root};c&&c(d.root);let f=!1;if(d.ctx=r?r(e,n.props||{},((t,n,...r)=>{const i=r.length?r[0]:n;return d.ctx&&a(d.ctx[t],d.ctx[t]=i)&&(!d.skip_bound&&d.bound[t]&&d.bound[t](i),f&&_t(e,t)),n})):[],d.update(),f=!0,o(d.before_update),d.fragment=!!s&&s(d.ctx),n.target){if(n.hydrate){const t=function(t){return Array.from(t.childNodes)}(n.target);d.fragment&&d.fragment.l(t),t.forEach(k)}else d.fragment&&d.fragment.c();n.intro&&at(e.$$.fragment),ft(e,n.target,n.anchor,n.customElement),Z()}B(h)}class mt{$destroy(){pt(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const vt=[];function yt(e,n=t){let r;const i=new Set;function o(t){if(a(e,t)&&(e=t,r)){const t=!vt.length;for(const t of i)t[1](),vt.push(t,e);if(t){for(let t=0;t<vt.length;t+=2)vt[t][0](vt[t+1]);vt.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(s,a=t){const l=[s,a];return i.add(l),1===i.size&&(r=n(o)||t),s(e),()=>{i.delete(l),0===i.size&&(r(),r=null)}}}}let wt=yt("gallery"),bt=yt(null),Ct=yt(null),xt=yt([]),kt=yt([]),Et=yt(!1),It=yt(!1),St=yt(!1),Nt=yt(null),Tt=function(t,e){return{subscribe:yt(t,e).subscribe}}(10),Rt=yt(0),Pt=yt(!0),Mt=yt(null),At=yt(null),Ot=yt(null),Dt=yt(null),Lt=yt(null),Ft=yt(null),$t=yt(null),qt=yt(null);var jt=()=>{const t=window.innerWidth,e=window.innerHeight,n={mobile:t<640,sm:t>=640&&t<768,md:t>=768&&t<1024,lg:t>=1024&&t<1100,medLg:t>=1100&&t<1280,xl:t>=1280&&t<1536,"2xl":t>=1536},r=Object.keys(n).filter((t=>n[t]))[0];return{windowW:t,windowH:e,screens:n,screenSize:r}};function zt(t){const e=t-1;return e*e*e+1}function Bt(t){return--t*t*t*t*t+1}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function Ut(t,{delay:n=0,duration:r=400,easing:i=e}={}){const o=+getComputedStyle(t).opacity;return{delay:n,duration:r,easing:i,css:t=>"opacity: "+t*o}}function Wt(t,{delay:e=0,duration:n=400,easing:r=zt}={}){const i=getComputedStyle(t),o=+i.opacity,s=parseFloat(i.height),a=parseFloat(i.paddingTop),l=parseFloat(i.paddingBottom),c=parseFloat(i.marginTop),u=parseFloat(i.marginBottom),h=parseFloat(i.borderTopWidth),d=parseFloat(i.borderBottomWidth);return{delay:e,duration:n,easing:r,css:t=>`overflow: hidden;opacity: ${Math.min(20*t,1)*o};height: ${t*s}px;padding-top: ${t*a}px;padding-bottom: ${t*l}px;margin-top: ${t*c}px;margin-bottom: ${t*u}px;border-top-width: ${t*h}px;border-bottom-width: ${t*d}px;`}}function Ht(t){var{fallback:e}=t,r=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}(t,["fallback"]);const i=new Map,o=new Map;function a(t,i,o){return(a,l)=>(t.set(l.key,{rect:a.getBoundingClientRect()}),()=>{if(i.has(l.key)){const{rect:t}=i.get(l.key);return i.delete(l.key),function(t,e,i){const{delay:o=0,duration:a=(t=>30*Math.sqrt(t)),easing:l=zt}=n(n({},r),i),c=e.getBoundingClientRect(),u=t.left-c.left,h=t.top-c.top,d=t.width/c.width,f=t.height/c.height,p=Math.sqrt(u*u+h*h),_=getComputedStyle(e),g="none"===_.transform?"":_.transform,m=+_.opacity;return{delay:o,duration:s(a)?a(p):a,easing:l,css:(t,e)=>`\n\t\t\t\topacity: ${t*m};\n\t\t\t\ttransform-origin: top left;\n\t\t\t\ttransform: ${g} translate(${e*u}px,${e*h}px) scale(${t+(1-t)*d}, ${t+(1-t)*f});\n\t\t\t`}}(t,a,l)}return t.delete(l.key),e&&e(a,l,o)})}return[a(o,i,!1),a(i,o,!0)]}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function Vt(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{l(r.next(t))}catch(t){o(t)}}function a(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((r=r.apply(t,e||[])).next())}))}function Gt(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function Yt(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Kt(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function Xt(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Qt=!1,Jt="${JSCORE_VERSION}",Zt=function(t,e){if(!t)throw te(e)},te=function(t){return new Error("Firebase Database ("+Jt+") INTERNAL ASSERT FAILED: "+t)},ee=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},ne={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const i=t[e],o=e+1<t.length,s=o?t[e+1]:0,a=e+2<t.length,l=a?t[e+2]:0,c=i>>2,u=(3&i)<<4|s>>4;let h=(15&s)<<2|l>>6,d=63&l;a||(d=64,o||(h=64)),r.push(n[c],n[u],n[h],n[d])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(ee(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){const o=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(o>>10)),e[r++]=String.fromCharCode(56320+(1023&o))}else{const o=t[n++],s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let e=0;e<t.length;){const i=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const s=e<t.length?n[t.charAt(e)]:64;++e;const a=e<t.length?n[t.charAt(e)]:64;if(++e,null==i||null==o||null==s||null==a)throw Error();const l=i<<2|o>>4;if(r.push(l),64!==s){const t=o<<4&240|s>>2;if(r.push(t),64!==a){const t=s<<6&192|a;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},re=function(t){try{return ne.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function ie(t){return oe(void 0,t)}function oe(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)e.hasOwnProperty(n)&&"__proto__"!==n&&(t[n]=oe(t[n],e[n]));return t}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class se{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function ae(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}function le(){return!0===Qt}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class ce extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,ce.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ue.prototype.create)}}class ue{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,i=this.errors[t],o=i?function(t,e){return t.replace(he,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",s=`${this.serviceName}: ${o} (${r}).`;return new ce(r,s,n)}}const he=/\{\$([^}]+)}/g;
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function de(t){return JSON.parse(t)}function fe(t){return JSON.stringify(t)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const pe=function(t){let e={},n={},r={},i="";try{const o=t.split(".");e=de(re(o[0])||""),n=de(re(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function _e(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ge(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function me(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function ve(t,e,n){const r={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}function ye(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const n=t[i],o=e[i];if(we(n)&&we(o)){if(!ye(n,o))return!1}else if(n!==o)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function we(t){return null!==t&&"object"==typeof t}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class be{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,e){e||(e=0);const n=this.W_;if("string"==typeof t)for(let r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(let r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(let t=16;t<80;t++){const e=n[t-3]^n[t-8]^n[t-14]^n[t-16];n[t]=4294967295&(e<<1|e>>>31)}let r,i,o=this.chain_[0],s=this.chain_[1],a=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(let t=0;t<80;t++){t<40?t<20?(r=l^s&(a^l),i=1518500249):(r=s^a^l,i=1859775393):t<60?(r=s&a|l&(s|a),i=2400959708):(r=s^a^l,i=3395469782);const e=(o<<5|o>>>27)+r+c+i+n[t]&4294967295;c=l,l=a,a=4294967295&(s<<30|s>>>2),s=o,o=e}this.chain_[0]=this.chain_[0]+o&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(t,e){if(null==t)return;void 0===e&&(e=t.length);const n=e-this.blockSize;let r=0;const i=this.buf_;let o=this.inbuf_;for(;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++o,++r,o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}digest(){const t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let t=this.blockSize-1;t>=56;t--)this.buf_[t]=255&e,e/=256;this.compress_(this.buf_);let n=0;for(let e=0;e<5;e++)for(let r=24;r>=0;r-=8)t[n]=this.chain_[e]>>r&255,++n;return t}}function Ce(t,e){return`${t} failed: ${e} argument `}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const xe=function(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function ke(t){return t&&t._delegate?t._delegate:t}var Ee=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},t}(),Ie="[DEFAULT]",Se=function(){function t(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}return t.prototype.get=function(t){var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new se;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:e});r&&n.resolve(r)}catch(t){}}return this.instancesDeferred.get(e).promise},t.prototype.getImmediate=function(t){var e,n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}},t.prototype.getComponent=function(){return this.component},t.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(t))try{this.getOrInitializeService({instanceIdentifier:Ie})}catch(t){}try{for(var r=Yt(this.instancesDeferred.entries()),i=r.next();!i.done;i=r.next()){var o=Kt(i.value,2),s=o[0],a=o[1],l=this.normalizeInstanceIdentifier(s);try{var c=this.getOrInitializeService({instanceIdentifier:l});a.resolve(c)}catch(t){}}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}}},t.prototype.clearInstance=function(t){void 0===t&&(t=Ie),this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)},t.prototype.delete=function(){return Vt(this,void 0,void 0,(function(){var t;return Gt(this,(function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(Xt(Xt([],Kt(t.filter((function(t){return"INTERNAL"in t})).map((function(t){return t.INTERNAL.delete()})))),Kt(t.filter((function(t){return"_delete"in t})).map((function(t){return t._delete()})))))];case 1:return e.sent(),[2]}}))}))},t.prototype.isComponentSet=function(){return null!=this.component},t.prototype.isInitialized=function(t){return void 0===t&&(t=Ie),this.instances.has(t)},t.prototype.getOptions=function(t){return void 0===t&&(t=Ie),this.instancesOptions.get(t)||{}},t.prototype.initialize=function(t){var e,n;void 0===t&&(t={});var r=t.options,i=void 0===r?{}:r,o=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(o))throw Error(this.name+"("+o+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var s=this.getOrInitializeService({instanceIdentifier:o,options:i});try{for(var a=Yt(this.instancesDeferred.entries()),l=a.next();!l.done;l=a.next()){var c=Kt(l.value,2),u=c[0],h=c[1];o===this.normalizeInstanceIdentifier(u)&&h.resolve(s)}}catch(t){e={error:t}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}return s},t.prototype.onInit=function(t,e){var n,r=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(r,i);var o=this.instances.get(r);return o&&t(o,r),function(){i.delete(t)}},t.prototype.invokeOnInitCallbacks=function(t,e){var n,r,i=this.onInitCallbacks.get(e);if(i)try{for(var o=Yt(i),s=o.next();!s.done;s=o.next()){var a=s.value;try{a(t,e)}catch(t){}}}catch(t){n={error:t}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},t.prototype.getOrInitializeService=function(t){var e,n=t.instanceIdentifier,r=t.options,i=void 0===r?{}:r,o=this.instances.get(n);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:(e=n,e===Ie?void 0:e),options:i}),this.instances.set(n,o),this.instancesOptions.set(n,i),this.invokeOnInitCallbacks(o,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,o)}catch(t){}return o||null},t.prototype.normalizeInstanceIdentifier=function(t){return void 0===t&&(t=Ie),this.component?this.component.multipleInstances?t:Ie:t},t.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},t}();
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var Ne,Te=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new Se(t,this);return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}();
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(Ne||(Ne={}));const Re={debug:Ne.DEBUG,verbose:Ne.VERBOSE,info:Ne.INFO,warn:Ne.WARN,error:Ne.ERROR,silent:Ne.SILENT},Pe=Ne.INFO,Me={[Ne.DEBUG]:"log",[Ne.VERBOSE]:"log",[Ne.INFO]:"info",[Ne.WARN]:"warn",[Ne.ERROR]:"error"},Ae=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),i=Me[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${r}]  ${t.name}:`,...n)};class Oe{constructor(t){this.name=t,this._logLevel=Pe,this._logHandler=Ae,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Ne))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?Re[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Ne.DEBUG,...t),this._logHandler(this,Ne.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Ne.VERBOSE,...t),this._logHandler(this,Ne.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Ne.INFO,...t),this._logHandler(this,Ne.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Ne.WARN,...t),this._logHandler(this,Ne.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Ne.ERROR,...t),this._logHandler(this,Ne.ERROR,...t)}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class De{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const Le="@firebase/app",Fe="0.7.4",$e=new Oe("@firebase/app"),qe="[DEFAULT]",je={[Le]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},ze=new Map,Be=new Map;function Ue(t,e){try{t.container.addComponent(e)}catch(n){$e.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function We(t){const e=t.name;if(Be.has(e))return $e.debug(`There were multiple attempts to register component ${e}.`),!1;Be.set(e,t);for(const e of ze.values())Ue(e,t);return!0}function He(t,e){return t.container.getProvider(e)}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Ve=new ue("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function."});
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Ge{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Ee("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Ve.create("app-deleted",{appName:this._name})}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Ye="9.1.3";function Ke(t="[DEFAULT]"){const e=ze.get(t);if(!e)throw Ve.create("no-app",{appName:t});return e}function Xe(t,e,n){var r;let i=null!==(r=je[t])&&void 0!==r?r:t;n&&(i+=`-${n}`);const o=i.match(/\s|\//),s=e.match(/\s|\//);if(o||s){const t=[`Unable to register library "${i}" with version "${e}":`];return o&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&s&&t.push("and"),s&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void $e.warn(t.join(" "))}We(new Ee(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var Qe;Qe="",We(new Ee("platform-logger",(t=>new De(t)),"PRIVATE")),Xe(Le,Fe,Qe),Xe(Le,Fe,"esm2017"),Xe("fire-js","");var Je;
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
Xe("firebase","9.1.3","app"),function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"}(Je||(Je={}));
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const Ze="firebasestorage.googleapis.com";class tn extends ce{constructor(t,e){super(en(t),`Firebase Storage: ${e} (${en(t)})`),this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,tn.prototype)}_codeEquals(t){return en(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function en(t){return"storage/"+t}function nn(t){return new tn("invalid-argument",t)}function rn(){return new tn("app-deleted","The Firebase app was deleted.")}function on(t){throw new tn("internal-error","Internal error: "+t)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class sn{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=Je.NO_ERROR,this.sendPromise_=new Promise((t=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=Je.ABORT,t()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=Je.NETWORK_ERROR,t()})),this.xhr_.addEventListener("load",(()=>{t()}))}))}send(t,e,n,r){if(this.sent_)throw on("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),void 0!==r)for(const t in r)r.hasOwnProperty(t)&&this.xhr_.setRequestHeader(t,r[t].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw on("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw on("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}}getResponseText(){if(!this.sent_)throw on("cannot .getResponseText() before sending");return this.xhr_.responseText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",t)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class an{createConnection(){return new sn}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class ln{constructor(t,e){this.bucket=t,this.path_=e}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let n;try{n=ln.makeFromUrl(t,e)}catch(e){return new ln(t,"")}if(""===n.path)return n;throw new tn("invalid-default-bucket","Invalid default bucket '"+t+"'.")}static makeFromUrl(t,e){let n=null;const r="([A-Za-z0-9.\\-_]+)";const i=new RegExp("^gs://"+r+"(/(.*))?$","i");function o(t){t.path_=decodeURIComponent(t.path)}const s=e.replace(/[.]/g,"\\."),a=[{regex:i,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${s}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:o},{regex:new RegExp(`^https?://${e===Ze?"(?:storage.googleapis.com|storage.cloud.google.com)":e}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:o}];for(let e=0;e<a.length;e++){const r=a[e],i=r.regex.exec(t);if(i){const t=i[r.indices.bucket];let e=i[r.indices.path];e||(e=""),n=new ln(t,e),r.postModify(n);break}}if(null==n)throw function(t){return new tn("invalid-url","Invalid URL '"+t+"'.")}(t);return n}}class cn{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function un(t,e,n,r){if(r<e)throw nn(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw nn(`Invalid value for '${t}'. Expected ${n} or less.`)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class hn{constructor(t,e,n,r,i,o,s,a,l,c,u){this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=s,this.errorCallback_=a,this.timeout_=l,this.progressCallback_=c,this.pool_=u,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((t,e)=>{this.resolve_=t,this.reject_=e,this.start_()}))}start_(){const t=(t,e)=>{if(e)return void t(!1,new dn(!1,null,!0));const n=this.pool_.createConnection();this.pendingConnection_=n;const r=t=>{const e=t.loaded,n=t.lengthComputable?t.total:-1;null!==this.progressCallback_&&this.progressCallback_(e,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const e=n.getErrorCode()===Je.NO_ERROR,i=n.getStatus();if(!e||this.isRetryStatusCode_(i)){const e=n.getErrorCode()===Je.ABORT;return void t(!1,new dn(!1,null,e))}const o=-1!==this.successCodes_.indexOf(i);t(!0,new dn(o,n))}))},e=(t,e)=>{const n=this.resolve_,r=this.reject_,i=e.connection;if(e.wasSuccessCode)try{const t=this.callback_(i,i.getResponseText());void 0!==t?n(t):n()}catch(t){r(t)}else if(null!==i){const t=new tn("unknown","An unknown error occurred, please check the error payload for server response.");t.serverResponse=i.getResponseText(),this.errorCallback_?r(this.errorCallback_(i,t)):r(t)}else if(e.canceled){r(this.appDelete_?rn():new tn("canceled","User canceled the upload/download."))}else{r(new tn("retry-limit-exceeded","Max retry time for operation exceeded, please try again."))}};this.canceled_?e(0,new dn(!1,null,!0)):this.backoffId_=function(t,e,n){let r=1,i=null,o=!1,s=0;function a(){return 2===s}let l=!1;function c(...t){l||(l=!0,e.apply(null,t))}function u(e){i=setTimeout((()=>{i=null,t(h,a())}),e)}function h(t,...e){if(l)return;if(t)return void c.call(null,t,...e);if(a()||o)return void c.call(null,t,...e);let n;r<64&&(r*=2),1===s?(s=2,n=0):n=1e3*(r+Math.random()),u(n)}let d=!1;function f(t){d||(d=!0,l||(null!==i?(t||(s=2),clearTimeout(i),u(0)):t||(s=1)))}return u(0),setTimeout((()=>{o=!0,f(!0)}),n),f}(t,e,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&function(t){t(!1)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}isRetryStatusCode_(t){const e=t>=500&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r}}class dn{constructor(t,e,n){this.wasSuccessCode=t,this.connection=e,this.canceled=!!n}}function fn(t,e,n,r,i,o){const s=function(t){const e=encodeURIComponent;let n="?";for(const r in t)t.hasOwnProperty(r)&&(n=n+(e(r)+"=")+e(t[r])+"&");return n=n.slice(0,-1),n}(t.urlParams),a=t.url+s,l=Object.assign({},t.headers);return function(t,e){e&&(t["X-Firebase-GMPID"]=e)}(l,e),function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(l,n),function(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(null!=e?e:"AppManager")}(l,o),function(t,e){null!==e&&(t["X-Firebase-AppCheck"]=e)}(l,r),new hn(a,t.method,l,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class pn{constructor(t,e){this._service=t,this._location=e instanceof ln?e:ln.makeFromUrl(e,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,e){return new pn(t,e)}get root(){const t=new ln(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return function(t){const e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}(this._location.path)}get storage(){return this._service}get parent(){const t=function(t){if(0===t.length)return null;const e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this._location.path);if(null===t)return null;const e=new ln(this._location.bucket,t);return new pn(this._service,e)}_throwIfRoot(t){if(""===this._location.path)throw function(t){return new tn("invalid-root-operation","The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)}}function _n(t,e){const n=null==e?void 0:e.storageBucket;return null==n?null:ln.makeFromBucketSpec(n,t)}class gn{constructor(t,e,n,r,i,o){this.app=t,this._authProvider=e,this._appCheckProvider=n,this._pool=r,this._url=i,this._firebaseVersion=o,this._bucket=null,this._host=Ze,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?ln.makeFromBucketSpec(i,this._host):_n(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,null!=this._url?this._bucket=ln.makeFromBucketSpec(this._url,t):this._bucket=_n(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){un("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){un("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const e=await t.getToken();if(null!==e)return e.accessToken}return null}async _getAppCheckToken(){const t=this._appCheckProvider.getImmediate({optional:!0});if(t){return(await t.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((t=>t.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new pn(this,t)}_makeRequest(t,e,n){if(this._deleted)return new cn(rn());{const r=fn(t,this._appId,e,n,this._pool,this._firebaseVersion);return this._requests.add(r),r.getPromise().then((()=>this._requests.delete(r)),(()=>this._requests.delete(r))),r}}async makeRequestWithTokens(t){const[e,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,e,n)}}const mn="@firebase/storage",vn="0.8.4",yn="storage";function wn(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),i=t.getProvider("app-check-internal");return new gn(n,r,i,new an,e,Ye)}We(new Ee(yn,wn,"PUBLIC").setMultipleInstances(!0)),Xe(mn,vn,""),Xe(mn,vn,"esm2017");const bn="@firebase/database",Cn="0.12.2";
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
let xn="";
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class kn{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),fe(e))}get(t){const e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:de(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class En{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e}get(t){return _e(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const In=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new kn(e)}}catch(t){}return new En},Sn=In("localStorage"),Nn=In("sessionStorage"),Tn=new Oe("@firebase/database"),Rn=function(){let t=1;return function(){return t++}}(),Pn=function(t){const e=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);if(i>=55296&&i<=56319){const e=i-55296;r++,Zt(r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(e<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e}(t),n=new be;n.update(e);const r=n.digest();return ne.encodeByteArray(r)},Mn=function(...t){let e="";for(let n=0;n<t.length;n++){const r=t[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?e+=Mn.apply(null,r):e+="object"==typeof r?fe(r):r,e+=" "}return e};let An=null,On=!0;const Dn=function(...t){var e,n;if(!0===On&&(On=!1,null===An&&!0===Nn.get("logging_enabled")&&(e=!0,Zt(!n||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(Tn.logLevel=Ne.VERBOSE,An=Tn.log.bind(Tn),n&&Nn.set("logging_enabled",!0)):"function"==typeof e?An=e:(An=null,Nn.remove("logging_enabled")))),An){const e=Mn.apply(null,t);An(e)}},Ln=function(t){return function(...e){Dn(t,...e)}},Fn=function(...t){const e="FIREBASE INTERNAL ERROR: "+Mn(...t);Tn.error(e)},$n=function(...t){const e=`FIREBASE FATAL ERROR: ${Mn(...t)}`;throw Tn.error(e),new Error(e)},qn=function(...t){const e="FIREBASE WARNING: "+Mn(...t);Tn.warn(e)},jn=function(t){return"number"==typeof t&&(t!=t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},zn="[MIN_NAME]",Bn="[MAX_NAME]",Un=function(t,e){if(t===e)return 0;if(t===zn||e===Bn)return-1;if(e===zn||t===Bn)return 1;{const n=Qn(t),r=Qn(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1}},Wn=function(t,e){return t===e?0:t<e?-1:1},Hn=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+fe(e))},Vn=function(t){if("object"!=typeof t||null===t)return fe(t);const e=[];for(const n in t)e.push(n);e.sort();let n="{";for(let r=0;r<e.length;r++)0!==r&&(n+=","),n+=fe(e[r]),n+=":",n+=Vn(t[e[r]]);return n+="}",n},Gn=function(t,e){const n=t.length;if(n<=e)return[t];const r=[];for(let i=0;i<n;i+=e)i+e>n?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r};function Yn(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const Kn=function(t){Zt(!jn(t),"Invalid JSON number");const e=1023;let n,r,i,o,s;0===t?(r=0,i=0,n=1/t==-1/0?1:0):(n=t<0,(t=Math.abs(t))>=Math.pow(2,-1022)?(o=Math.min(Math.floor(Math.log(t)/Math.LN2),e),r=o+e,i=Math.round(t*Math.pow(2,52-o)-Math.pow(2,52))):(r=0,i=Math.round(t/Math.pow(2,-1074))));const a=[];for(s=52;s;s-=1)a.push(i%2?1:0),i=Math.floor(i/2);for(s=11;s;s-=1)a.push(r%2?1:0),r=Math.floor(r/2);a.push(n?1:0),a.reverse();const l=a.join("");let c="";for(s=0;s<64;s+=8){let t=parseInt(l.substr(s,8),2).toString(16);1===t.length&&(t="0"+t),c+=t}return c.toLowerCase()},Xn=new RegExp("^-?(0*)\\d{1,10}$"),Qn=function(t){if(Xn.test(t)){const e=Number(t);if(e>=-2147483648&&e<=2147483647)return e}return null},Jn=function(t){try{t()}catch(t){setTimeout((()=>{const e=t.stack||"";throw qn("Exception was thrown by user callback.",e),t}),Math.floor(0))}},Zn=function(t,e){const n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n};
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class tr{constructor(t,e){this.appName_=t,this.appCheckProvider=e,this.appCheck=null==e?void 0:e.getImmediate({optional:!0}),this.appCheck||null==e||e.get().then((t=>this.appCheck=t))}getToken(t){return this.appCheck?this.appCheck.getToken(t):new Promise(((e,n)=>{setTimeout((()=>{this.appCheck?this.getToken(t).then(e,n):e(null)}),0)}))}addTokenChangeListener(t){var e;null===(e=this.appCheckProvider)||void 0===e||e.get().then((e=>e.addTokenListener(t)))}notifyForInvalidToken(){qn(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class er{constructor(t,e,n){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((t=>this.auth_=t))}getToken(t){return this.auth_?this.auth_.getToken(t).catch((t=>t&&"auth/token-not-initialized"===t.code?(Dn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t))):new Promise(((e,n)=>{setTimeout((()=>{this.auth_?this.getToken(t).then(e,n):e(null)}),0)}))}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then((e=>e.addAuthTokenListener(t)))}removeTokenChangeListener(t){this.authProvider_.get().then((e=>e.removeAuthTokenListener(t)))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',qn(t)}}class nr{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}nr.OWNER="owner";
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const rr=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ir="websocket",or="long_polling";
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class sr{constructor(t,e,n,r,i=!1,o="",s=!1){this.secure=e,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=s,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Sn.get("host:"+t)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Sn.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){const t=this.secure?"https://":"http://",e=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${t}${this.host}/${e}`}}function ar(t,e,n){let r;if(Zt("string"==typeof e,"typeof type must == string"),Zt("object"==typeof n,"typeof params must == object"),e===ir)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else{if(e!==or)throw new Error("Unknown connection type: "+e);r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?"}(function(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams})(t)&&(n.ns=t.namespace);const i=[];return Yn(n,((t,e)=>{i.push(t+"="+e)})),r+i.join("&")}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class lr{constructor(){this.counters_={}}incrementCounter(t,e=1){_e(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return ie(this.counters_)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const cr={},ur={};function hr(t){const e=t.toString();return cr[e]||(cr[e]=new lr),cr[e]}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class dr{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){for(this.pendingResponses[t]=e;this.pendingResponses[this.currentResponseNum];){const t=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<t.length;++e)t[e]&&Jn((()=>{this.onMessage_(t[e])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const fr="start";class pr{constructor(t,e,n,r,i,o,s){this.connId=t,this.repoInfo=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=s,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ln(t),this.stats_=hr(e),this.urlFn=t=>(this.appCheckToken&&(t.ac=this.appCheckToken),ar(e,or,t))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new dr(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{let e=!1;const n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new _r(((...t)=>{const[e,n,r,i,o]=t;if(this.incrementIncomingBytes_(t),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,e===fr)this.id=n,this.password=r;else{if("close"!==e)throw new Error("Unrecognized command received: "+e);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...t)=>{const[e,n]=t;this.incrementIncomingBytes_(t),this.myPacketOrderer.handleResponse(e,n)}),(()=>{this.onClosed_()}),this.urlFn);const t={start:"t"};t.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=this.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",this.transportSessionId&&(t.s=this.transportSessionId),this.lastSessionId&&(t.ls=this.lastSessionId),this.applicationId&&(t.p=this.applicationId),this.appCheckToken&&(t.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&rr.test(location.hostname)&&(t.r="f");const e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){pr.forceAllow_=!0}static forceDisallow(){pr.forceDisallow_=!0}static isAvailable(){return!!pr.forceAllow_||!(pr.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const e=fe(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const n=function(t){const e=ee(t);return ne.encodeByteArray(e,!0)}(e),r=Gn(n,1840);for(let t=0;t<r.length;t++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[t]),this.curSegmentNum++}addDisconnectPingFrame(t,e){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const e=fe(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class _r{constructor(t,e,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Rn(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=_r.createIFrame_();let n="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)){n='<script>document.domain="'+document.domain+'";<\/script>'}const r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(t){Dn("frame writing exception"),t.stack&&Dn(t.stack),Dn(t)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||Dn("No IE domain setting required")}catch(e){const n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;let e=this.urlFn(t),n="",r=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;{const t=this.pendingSegs.shift();n=n+"&seg"+r+"="+t.seg+"&ts"+r+"="+t.ts+"&d"+r+"="+t.d,r++}}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1}enqueueSegment(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);const n=()=>{this.outstandingRequests.delete(e),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(t,(()=>{clearTimeout(r),n()}))}addTag(t,e){setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=t,n.onload=n.onreadystatechange=function(){const t=n.readyState;t&&"loaded"!==t&&"complete"!==t||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),e())},n.onerror=()=>{Dn("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(t){}}),Math.floor(1))}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */let gr=null;"undefined"!=typeof MozWebSocket?gr=MozWebSocket:"undefined"!=typeof WebSocket&&(gr=WebSocket);class mr{constructor(t,e,n,r,i,o,s){this.connId=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ln(this.connId),this.stats_=hr(e),this.connURL=mr.connectionURL_(e,o,s,r),this.nodeAdmin=e.nodeAdmin}static connectionURL_(t,e,n,r){const i={v:"5"};return"undefined"!=typeof location&&location.hostname&&rr.test(location.hostname)&&(i.r="f"),e&&(i.s=e),n&&(i.ls=n),r&&(i.ac=r),ar(t,ir,i)}open(t,e){this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Sn.set("previous_websocket_failure",!0);try{if(le());else{const t={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}};this.mySock=new gr(this.connURL,[],t)}}catch(t){this.log_("Error instantiating WebSocket.");const e=t.message||t.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=t=>{this.handleIncomingFrame(t)},this.mySock.onerror=t=>{this.log_("WebSocket error.  Closing connection.");const e=t.message||t.data;e&&this.log_(e),this.onClosed_()}}start(){}static forceDisallow(){mr.forceDisallow_=!0}static isAvailable(){let t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const e=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(e);n&&n.length>1&&parseFloat(n[1])<4.4&&(t=!0)}return!t&&null!==gr&&!mr.forceDisallow_}static previouslyFailed(){return Sn.isInMemoryStorage||!0===Sn.get("previous_websocket_failure")}markConnectionHealthy(){Sn.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const e=de(t);this.onMessage(e)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(Zt(null===this.frames,"We already have a frame buffer"),t.length<=6){const e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(null===this.mySock)return;const e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{const t=this.extractFrameCount_(e);null!==t&&this.appendFrame_(t)}}send(t){this.resetKeepAlive();const e=fe(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const n=Gn(e,16384);n.length>1&&this.sendString_(String(n.length));for(let t=0;t<n.length;t++)this.sendString_(n[t])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}mr.responsesRequiredToBeHealthy=2,mr.healthyTimeout=3e4;
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class vr{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[pr,mr]}initTransports_(t){const e=mr&&mr.isAvailable();let n=e&&!mr.previouslyFailed();if(t.webSocketOnly&&(e||qn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[mr];else{const t=this.transports_=[];for(const e of vr.ALL_TRANSPORTS)e&&e.isAvailable()&&t.push(e)}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class yr{constructor(t,e,n,r,i,o,s,a,l,c){this.id=t,this.repoInfo_=e,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=s,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ln("c:"+this.id+":"),this.transportManager_=new vr(e),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(e,n)}),Math.floor(0));const r=t.healthyTimeout||0;r>0&&(this.healthyTimeout_=Zn((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){const e={t:"d",d:t};this.sendData_(e)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if("t"in t){const e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const e=Hn("t",t),n=Hn("d",t);if("c"===e)this.onSecondaryControl_(n);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const e=Hn("t",t),n=Hn("d",t);"c"===e?this.onControl_(n):"d"===e&&this.onDataMessage_(n)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const e=Hn("t",t);if("d"in t){const n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let t=0;t<this.pendingDataMessages.length;++t)this.onDataMessage_(this.pendingDataMessages[t]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?Fn("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Fn("Unknown control packet command: "+e)}}onHandshake_(t){const e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&qn("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;const e=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,n),Zn((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Zn((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()}onConnectionLost_(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Sn.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class wr{put(t,e,n,r){}merge(t,e,n,r){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,n){}onDisconnectMerge(t,e,n){}onDisconnectCancel(t,e){}reportStats(t){}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class br{constructor(t){this.allowedEvents_=t,this.listeners_={},Zt(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){const n=[...this.listeners_[t]];for(let t=0;t<n.length;t++)n[t].callback.apply(n[t].context,e)}}on(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});const r=this.getInitialEvent(t);r&&e.apply(n,r)}off(t,e,n){this.validateEventType_(t);const r=this.listeners_[t]||[];for(let t=0;t<r.length;t++)if(r[t].callback===e&&(!n||n===r[t].context))return void r.splice(t,1)}validateEventType_(t){Zt(this.allowedEvents_.find((e=>e===t)),"Unknown event: "+t)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Cr extends br{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||ae()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new Cr}getInitialEvent(t){return Zt("online"===t,"Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class xr{constructor(t,e){if(void 0===e){this.pieces_=t.split("/");let e=0;for(let t=0;t<this.pieces_.length;t++)this.pieces_[t].length>0&&(this.pieces_[e]=this.pieces_[t],e++);this.pieces_.length=e,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"}}function kr(){return new xr("")}function Er(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Ir(t){return t.pieces_.length-t.pieceNum_}function Sr(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new xr(t.pieces_,e)}function Nr(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function Tr(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Rr(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new xr(e,0)}function Pr(t,e){const n=[];for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);if(e instanceof xr)for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);else{const t=e.split("/");for(let e=0;e<t.length;e++)t[e].length>0&&n.push(t[e])}return new xr(n,0)}function Mr(t){return t.pieceNum_>=t.pieces_.length}function Ar(t,e){const n=Er(t),r=Er(e);if(null===n)return e;if(n===r)return Ar(Sr(t),Sr(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function Or(t,e){if(Ir(t)!==Ir(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function Dr(t,e){let n=t.pieceNum_,r=e.pieceNum_;if(Ir(t)>Ir(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}class Lr{constructor(t,e){this.errorPrefix_=e,this.parts_=Tr(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let t=0;t<this.parts_.length;t++)this.byteLength_+=xe(this.parts_[t]);Fr(this)}}function Fr(t){if(t.byteLength_>768)throw new Error(t.errorPrefix_+"has a key path longer than 768 bytes ("+t.byteLength_+").");if(t.parts_.length>32)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+$r(t))}function $r(t){return 0===t.parts_.length?"":"in property '"+t.parts_.join(".")+"'"}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class qr extends br{constructor(){let t,e;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,(()=>{const e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))}),!1)}static getInstance(){return new qr}getInitialEvent(t){return Zt("visible"===t,"Unknown event type: "+t),[this.visible_]}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const jr=1e3;class zr extends wr{constructor(t,e,n,r,i,o,s,a){if(super(),this.repoInfo_=t,this.applicationId_=e,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=o,this.appCheckTokenProvider_=s,this.authOverride_=a,this.id=zr.nextPersistentConnectionId_++,this.log_=Ln("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=jr,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!le())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");qr.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&Cr.getInstance().on("online",this.onOnline_,this)}sendRequest(t,e,n){const r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(fe(i)),Zt(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(t){this.initConnection_();const e=new se,n={p:t._path.toString(),q:t._queryObject},r={action:"g",request:n,onComplete:t=>{const r=t.d;"ok"===t.s?(this.onDataUpdate_(n.p,r,!1,null),e.resolve(r)):e.reject(r)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_||setTimeout((()=>{const t=this.outstandingGets_[i];void 0!==t&&r===t&&(delete this.outstandingGets_[i],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),this.log_("get "+i+" timed out on connection"),e.reject(new Error("Client is offline.")))}),3e3),this.connected_&&this.sendGet_(i),e.promise}listen(t,e,n,r){this.initConnection_();const i=t._queryIdentifier,o=t._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),Zt(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Zt(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");const s={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(o).set(i,s),this.connected_&&this.sendListen_(s)}sendGet_(t){const e=this.outstandingGets_[t];this.sendRequest("g",e.request,(n=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),e.onComplete&&e.onComplete(n)}))}sendListen_(t){const e=t.query,n=e._path.toString(),r=e._queryIdentifier;this.log_("Listen on "+n+" for "+r);const i={p:n};t.tag&&(i.q=e._queryObject,i.t=t.tag),i.h=t.hashFn(),this.sendRequest("q",i,(i=>{const o=i.d,s=i.s;zr.warnOnListenWarnings_(o,e);(this.listens.get(n)&&this.listens.get(n).get(r))===t&&(this.log_("listen response",i),"ok"!==s&&this.removeListen_(n,r),t.onComplete&&t.onComplete(s,o))}))}static warnOnListenWarnings_(t,e){if(t&&"object"==typeof t&&_e(t,"w")){const n=ge(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const t='".indexOn": "'+e._queryParams.getIndex().toString()+'"',n=e._path.toString();qn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${t} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&40===t.length||function(t){const e=pe(t).claims;return"object"==typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,e=function(t){const e=pe(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")}(t)?"auth":"gauth",n={cred:t};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(e,n,(e=>{const n=e.s,r=e.d||"error";this.authToken_===t&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(t=>{const e=t.s,n=t.d||"error";"ok"===e?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(e,n)}))}unlisten(t,e){const n=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),Zt(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t._queryObject,e)}sendUnlisten_(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);const i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})}onDisconnectMerge(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})}onDisconnectCancel(t,e){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})}sendOnDisconnect_(t,e,n,r){const i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,(t=>{r&&setTimeout((()=>{r(t.s,t.d)}),Math.floor(0))}))}put(t,e,n,r){this.putInternal("p",t,e,n,r)}merge(t,e,n,r){this.putInternal("m",t,e,n,r)}putInternal(t,e,n,r,i){this.initConnection_();const o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;const s=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(s):this.log_("Buffering put: "+e)}sendPut_(t){const e=this.outstandingPuts_[t].action,n=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(e,n,(n=>{this.log_(e+" response",n),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)}))}reportStats(t){if(this.connected_){const e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,(t=>{if("ok"!==t.s){const e=t.d;this.log_("reportStats","Error sending stats: "+e)}}))}}onDataMessage_(t){if("r"in t){this.log_("from server: "+fe(t));const e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"apc"===t?this.onAppCheckRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):Fn("Unrecognized action received from server: "+fe(t)+"\nAre you using the latest client?")}onReady_(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){Zt(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=jr,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=jr,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=jr),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const t=(new Date).getTime()-this.lastConnectionAttemptTime_;let e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),e=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+zr.nextConnectionId_++,i=this.lastSessionId;let o=!1,s=null;const a=function(){s?s.close():(o=!0,n())},l=function(t){Zt(s,"sendRequest call when we're not connected not allowed."),s.sendRequest(t)};this.realtime_={close:a,sendRequest:l};const c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[a,l]=await Promise.all([this.authTokenProvider_.getToken(c),this.appCheckTokenProvider_.getToken(c)]);o?Dn("getToken() completed but was canceled"):(Dn("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=l&&l.token,s=new yr(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,e,n,(t=>{qn(t+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),i))}catch(t){this.log_("Failed to get token: "+t),o||(this.repoInfo_.nodeAdmin&&qn(t),a())}}}interrupt(t){Dn("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Dn("Resuming connection for reason: "+t),delete this.interruptReasons_[t],me(this.interruptReasons_)&&(this.reconnectDelay_=jr,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(t,e){let n;n=e?e.map((t=>Vn(t))).join("$"):"default";const r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(t,e){const n=new xr(t).toString();let r;if(this.listens.has(n)){const t=this.listens.get(n);r=t.get(e),t.delete(e),0===t.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(t,e){Dn("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,e){Dn("App check token revoked: "+t+"/"+e),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const e of t.values())this.sendListen_(e);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};t["sdk.js."+xn.replace(/\./g,"-")]=1,ae()?t["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=Cr.getInstance().currentlyOnline();return me(this.interruptReasons_)&&t}}zr.nextPersistentConnectionId_=0,zr.nextConnectionId_=0;
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Br{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new Br(t,e)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ur{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){const n=new Br(zn,t),r=new Br(zn,e);return 0!==this.compare(n,r)}minPost(){return Br.MIN}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */let Wr;class Hr extends Ur{static get __EMPTY_NODE(){return Wr}static set __EMPTY_NODE(t){Wr=t}compare(t,e){return Un(t.name,e.name)}isDefinedOn(t){throw te("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return Br.MIN}maxPost(){return new Br(Bn,Wr)}makePost(t,e){return Zt("string"==typeof t,"KeyIndex indexValue must always be a string."),new Br(t,Wr)}toString(){return".key"}}const Vr=new Hr;
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Gr{constructor(t,e,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let o=1;for(;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}getNext(){if(0===this.nodeStack_.length)return null;let t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}class Yr{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Yr.RED,this.left=null!=r?r:Kr.EMPTY_NODE,this.right=null!=i?i:Kr.EMPTY_NODE}copy(t,e,n,r,i){return new Yr(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const i=n(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return Kr.EMPTY_NODE;let t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,e){let n,r;if(n=this,e(t,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return Kr.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,Yr.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,Yr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}Yr.RED=!0,Yr.BLACK=!1;class Kr{constructor(t,e=Kr.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new Kr(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,Yr.BLACK,null,null))}remove(t){return new Kr(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Yr.BLACK,null,null))}get(t){let e,n=this.root_;for(;!n.isEmpty();){if(e=this.comparator_(t,n.key),0===e)return n.value;e<0?n=n.left:e>0&&(n=n.right)}return null}getPredecessorKey(t){let e,n=this.root_,r=null;for(;!n.isEmpty();){if(e=this.comparator_(t,n.key),0===e){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:e>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new Gr(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new Gr(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new Gr(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new Gr(this.root_,null,this.comparator_,!0,t)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Xr(t,e){return Un(t.name,e.name)}function Qr(t,e){return Un(t,e)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */let Jr;Kr.EMPTY_NODE=new class{copy(t,e,n,r,i){return this}insert(t,e,n){return new Yr(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Zr=function(t){return"number"==typeof t?"number:"+Kn(t):"string:"+t},ti=function(t){if(t.isLeafNode()){const e=t.val();Zt("string"==typeof e||"number"==typeof e||"object"==typeof e&&_e(e,".sv"),"Priority must be a string or number.")}else Zt(t===Jr||t.isEmpty(),"priority of unexpected type.");Zt(t===Jr||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
let ei,ni,ri;class ii{constructor(t,e=ii.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=e,this.lazyHash_=null,Zt(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),ti(this.priorityNode_)}static set __childrenNodeConstructor(t){ei=t}static get __childrenNodeConstructor(){return ei}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new ii(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:ii.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return Mr(t)?this:".priority"===Er(t)?this.priorityNode_:ii.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,e){return null}updateImmediateChild(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:ii.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)}updateChild(t,e){const n=Er(t);return null===n?e:e.isEmpty()&&".priority"!==n?this:(Zt(".priority"!==n||1===Ir(t),".priority must be the last token in a path"),this.updateImmediateChild(n,ii.__childrenNodeConstructor.EMPTY_NODE.updateChild(Sr(t),e)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,e){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+Zr(this.priorityNode_.val())+":");const e=typeof this.value_;t+=e+":",t+="number"===e?Kn(this.value_):this.value_,this.lazyHash_=Pn(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===ii.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof ii.__childrenNodeConstructor?-1:(Zt(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const e=typeof t.value_,n=typeof this.value_,r=ii.VALUE_TYPE_ORDER.indexOf(e),i=ii.VALUE_TYPE_ORDER.indexOf(n);return Zt(r>=0,"Unknown leaf type: "+e),Zt(i>=0,"Unknown leaf type: "+n),r===i?"object"===n?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){const e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1}}ii.VALUE_TYPE_ORDER=["object","boolean","number","string"];const oi=new class extends Ur{compare(t,e){const n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?Un(t.name,e.name):i}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return Br.MIN}maxPost(){return new Br(Bn,new ii("[PRIORITY-POST]",ri))}makePost(t,e){const n=ni(t);return new Br(e,new ii("[PRIORITY-POST]",n))}toString(){return".priority"}},si=Math.log(2);
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class ai{constructor(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/si,10)),this.current_=this.count-1;const n=(r=this.count,parseInt(Array(r+1).join("1"),2));var r;this.bits_=t+1&n}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const li=function(t,e,n,r){t.sort(e);const i=function(e,r){const o=r-e;let s,a;if(0===o)return null;if(1===o)return s=t[e],a=n?n(s):s,new Yr(a,s.node,Yr.BLACK,null,null);{const l=parseInt(o/2,10)+e,c=i(e,l),u=i(l+1,r);return s=t[l],a=n?n(s):s,new Yr(a,s.node,Yr.BLACK,c,u)}},o=function(e){let r=null,o=null,s=t.length;const a=function(e,r){const o=s-e,a=s;s-=e;const c=i(o+1,a),u=t[o],h=n?n(u):u;l(new Yr(h,u.node,r,null,c))},l=function(t){r?(r.left=t,r=t):(o=t,r=t)};for(let t=0;t<e.count;++t){const n=e.nextBitIsOne(),r=Math.pow(2,e.count-(t+1));n?a(r,Yr.BLACK):(a(r,Yr.BLACK),a(r,Yr.RED))}return o}(new ai(t.length));return new Kr(r||e,o)};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */let ci;const ui={};class hi{constructor(t,e){this.indexes_=t,this.indexSet_=e}static get Default(){return Zt(ui&&oi,"ChildrenNode.ts has not been loaded"),ci=ci||new hi({".priority":ui},{".priority":oi}),ci}get(t){const e=ge(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof Kr?e:null}hasIndex(t){return _e(this.indexSet_,t.toString())}addIndex(t,e){Zt(t!==Vr,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=e.getIterator(Br.Wrap);let o,s=i.getNext();for(;s;)r=r||t.isDefinedOn(s.node),n.push(s),s=i.getNext();o=r?li(n,t.getCompare()):ui;const a=t.toString(),l=Object.assign({},this.indexSet_);l[a]=t;const c=Object.assign({},this.indexes_);return c[a]=o,new hi(c,l)}addToIndexes(t,e){const n=ve(this.indexes_,((n,r)=>{const i=ge(this.indexSet_,r);if(Zt(i,"Missing index implementation for "+r),n===ui){if(i.isDefinedOn(t.node)){const n=[],r=e.getIterator(Br.Wrap);let o=r.getNext();for(;o;)o.name!==t.name&&n.push(o),o=r.getNext();return n.push(t),li(n,i.getCompare())}return ui}{const r=e.get(t.name);let i=n;return r&&(i=i.remove(new Br(t.name,r))),i.insert(t,t.node)}}));return new hi(n,this.indexSet_)}removeFromIndexes(t,e){const n=ve(this.indexes_,(n=>{if(n===ui)return n;{const r=e.get(t.name);return r?n.remove(new Br(t.name,r)):n}}));return new hi(n,this.indexSet_)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */let di;class fi{constructor(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&ti(this.priorityNode_),this.children_.isEmpty()&&Zt(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return di||(di=new fi(new Kr(Qr),null,hi.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||di}updatePriority(t){return this.children_.isEmpty()?this:new fi(this.children_,t,this.indexMap_)}getImmediateChild(t){if(".priority"===t)return this.getPriority();{const e=this.children_.get(t);return null===e?di:e}}getChild(t){const e=Er(t);return null===e?this:this.getImmediateChild(e).getChild(Sr(t))}hasChild(t){return null!==this.children_.get(t)}updateImmediateChild(t,e){if(Zt(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);{const n=new Br(t,e);let r,i;e.isEmpty()?(r=this.children_.remove(t),i=this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(t,e),i=this.indexMap_.addToIndexes(n,this.children_));const o=r.isEmpty()?di:this.priorityNode_;return new fi(r,o,i)}}updateChild(t,e){const n=Er(t);if(null===n)return e;{Zt(".priority"!==Er(t)||1===Ir(t),".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(Sr(t),e);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const e={};let n=0,r=0,i=!0;if(this.forEachChild(oi,((o,s)=>{e[o]=s.val(t),n++,i&&fi.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):i=!1})),!t&&i&&r<2*n){const t=[];for(const n in e)t[n]=e[n];return t}return t&&!this.getPriority().isEmpty()&&(e[".priority"]=this.getPriority().val()),e}hash(){if(null===this.lazyHash_){let t="";this.getPriority().isEmpty()||(t+="priority:"+Zr(this.getPriority().val())+":"),this.forEachChild(oi,((e,n)=>{const r=n.hash();""!==r&&(t+=":"+e+":"+r)})),this.lazyHash_=""===t?"":Pn(t)}return this.lazyHash_}getPredecessorChildName(t,e,n){const r=this.resolveIndex_(n);if(r){const n=r.getPredecessorKey(new Br(t,e));return n?n.name:null}return this.children_.getPredecessorKey(t)}getFirstChildName(t){const e=this.resolveIndex_(t);if(e){const t=e.minKey();return t&&t.name}return this.children_.minKey()}getFirstChild(t){const e=this.getFirstChildName(t);return e?new Br(e,this.children_.get(e)):null}getLastChildName(t){const e=this.resolveIndex_(t);if(e){const t=e.maxKey();return t&&t.name}return this.children_.maxKey()}getLastChild(t){const e=this.getLastChildName(t);return e?new Br(e,this.children_.get(e)):null}forEachChild(t,e){const n=this.resolveIndex_(t);return n?n.inorderTraversal((t=>e(t.name,t.node))):this.children_.inorderTraversal(e)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,e){const n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,(t=>t));{const n=this.children_.getIteratorFrom(t.name,Br.Wrap);let r=n.peek();for(;null!=r&&e.compare(r,t)<0;)n.getNext(),r=n.peek();return n}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,e){const n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,(t=>t));{const n=this.children_.getReverseIteratorFrom(t.name,Br.Wrap);let r=n.peek();for(;null!=r&&e.compare(r,t)>0;)n.getNext(),r=n.peek();return n}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===pi?-1:0}withIndex(t){if(t===Vr||this.indexMap_.hasIndex(t))return this;{const e=this.indexMap_.addIndex(t,this.children_);return new fi(this.children_,this.priorityNode_,e)}}isIndexed(t){return t===Vr||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){const t=this.getIterator(oi),n=e.getIterator(oi);let r=t.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=t.getNext(),i=n.getNext()}return null===r&&null===i}return!1}return!1}}resolveIndex_(t){return t===Vr?null:this.indexMap_.get(t.toString())}}fi.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const pi=new class extends fi{constructor(){super(new Kr(Qr),fi.EMPTY_NODE,hi.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return fi.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(Br,{MIN:{value:new Br(zn,fi.EMPTY_NODE)},MAX:{value:new Br(Bn,pi)}}),Hr.__EMPTY_NODE=fi.EMPTY_NODE,ii.__childrenNodeConstructor=fi,Jr=pi,function(t){ri=t}(pi);function _i(t,e=null){if(null===t)return fi.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),Zt(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t){return new ii(t,_i(e))}if(t instanceof Array){let n=fi.EMPTY_NODE;return Yn(t,((e,r)=>{if(_e(t,e)&&"."!==e.substring(0,1)){const t=_i(r);!t.isLeafNode()&&t.isEmpty()||(n=n.updateImmediateChild(e,t))}})),n.updatePriority(_i(e))}{const n=[];let r=!1;if(Yn(t,((t,e)=>{if("."!==t.substring(0,1)){const i=_i(e);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new Br(t,i)))}})),0===n.length)return fi.EMPTY_NODE;const i=li(n,Xr,(t=>t.name),Qr);if(r){const t=li(n,oi.getCompare());return new fi(i,_i(e),new hi({".priority":t},{".priority":oi}))}return new fi(i,_i(e),hi.Default)}}!function(t){ni=t}(_i);
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class gi extends Ur{constructor(t){super(),this.indexPath_=t,Zt(!Mr(t)&&".priority"!==Er(t),"Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){const n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?Un(t.name,e.name):i}makePost(t,e){const n=_i(t),r=fi.EMPTY_NODE.updateChild(this.indexPath_,n);return new Br(e,r)}maxPost(){const t=fi.EMPTY_NODE.updateChild(this.indexPath_,pi);return new Br(Bn,t)}toString(){return Tr(this.indexPath_,0).join("/")}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const mi=new class extends Ur{compare(t,e){const n=t.node.compareTo(e.node);return 0===n?Un(t.name,e.name):n}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return Br.MIN}maxPost(){return Br.MAX}makePost(t,e){const n=_i(t);return new Br(e,n)}toString(){return".value"}};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function vi(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function yi(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function wi(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class bi{constructor(t){this.index_=t}updateChild(t,e,n,r,i,o){Zt(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");const s=t.getImmediateChild(e);return s.getChild(r).equals(n.getChild(r))&&s.isEmpty()===n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(yi(e,s)):Zt(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?o.trackChildChange(vi(e,n)):o.trackChildChange(wi(e,n,s))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))}updateFullNode(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(oi,((t,r)=>{e.hasChild(t)||n.trackChildChange(yi(t,r))})),e.isLeafNode()||e.forEachChild(oi,((e,r)=>{if(t.hasChild(e)){const i=t.getImmediateChild(e);i.equals(r)||n.trackChildChange(wi(e,r,i))}else n.trackChildChange(vi(e,r))}))),e.withIndex(this.index_)}updatePriority(t,e){return t.isEmpty()?fi.EMPTY_NODE:t.updatePriority(e)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ci{constructor(t){this.indexedFilter_=new bi(t.getIndex()),this.index_=t.getIndex(),this.startPost_=Ci.getStartPost_(t),this.endPost_=Ci.getEndPost_(t)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0}updateChild(t,e,n,r,i,o){return this.matches(new Br(e,n))||(n=fi.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)}updateFullNode(t,e,n){e.isLeafNode()&&(e=fi.EMPTY_NODE);let r=e.withIndex(this.index_);r=r.updatePriority(fi.EMPTY_NODE);const i=this;return e.forEachChild(oi,((t,e)=>{i.matches(new Br(t,e))||(r=r.updateImmediateChild(t,fi.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(t,r,n)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(t){if(t.hasStart()){const e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()}static getEndPost_(t){if(t.hasEnd()){const e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class xi{constructor(t){this.rangedFilter_=new Ci(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}updateChild(t,e,n,r,i,o){return this.rangedFilter_.matches(new Br(e,n))||(n=fi.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)}updateFullNode(t,e,n){let r;if(e.isLeafNode()||e.isEmpty())r=fi.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){let t;r=fi.EMPTY_NODE.withIndex(this.index_),t=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;t.hasNext()&&n<this.limit_;){const e=t.getNext();let i;if(i=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),e)<=0:this.index_.compare(e,this.rangedFilter_.getEndPost())<=0,!i)break;r=r.updateImmediateChild(e.name,e.node),n++}}else{let t,n,i,o;if(r=e.withIndex(this.index_),r=r.updatePriority(fi.EMPTY_NODE),this.reverse_){o=r.getReverseIterator(this.index_),t=this.rangedFilter_.getEndPost(),n=this.rangedFilter_.getStartPost();const e=this.index_.getCompare();i=(t,n)=>e(n,t)}else o=r.getIterator(this.index_),t=this.rangedFilter_.getStartPost(),n=this.rangedFilter_.getEndPost(),i=this.index_.getCompare();let s=0,a=!1;for(;o.hasNext();){const e=o.getNext();!a&&i(t,e)<=0&&(a=!0);a&&s<this.limit_&&i(e,n)<=0?s++:r=r.updateImmediateChild(e.name,fi.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(t,e,n,r,i){let o;if(this.reverse_){const t=this.index_.getCompare();o=(e,n)=>t(n,e)}else o=this.index_.getCompare();const s=t;Zt(s.numChildren()===this.limit_,"");const a=new Br(e,n),l=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),c=this.rangedFilter_.matches(a);if(s.hasChild(e)){const t=s.getImmediateChild(e);let u=r.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=u&&(u.name===e||s.hasChild(u.name));)u=r.getChildAfterChild(this.index_,u,this.reverse_);const h=null==u?1:o(u,a);if(c&&!n.isEmpty()&&h>=0)return null!=i&&i.trackChildChange(wi(e,n,t)),s.updateImmediateChild(e,n);{null!=i&&i.trackChildChange(yi(e,t));const n=s.updateImmediateChild(e,fi.EMPTY_NODE);return null!=u&&this.rangedFilter_.matches(u)?(null!=i&&i.trackChildChange(vi(u.name,u.node)),n.updateImmediateChild(u.name,u.node)):n}}return n.isEmpty()?t:c&&o(l,a)>=0?(null!=i&&(i.trackChildChange(yi(l.name,l.node)),i.trackChildChange(vi(e,n))),s.updateImmediateChild(e,n).updateImmediateChild(l.name,fi.EMPTY_NODE)):t}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class ki{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=oi}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return Zt(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Zt(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:zn}hasEnd(){return this.endSet_}getIndexEndValue(){return Zt(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Zt(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Bn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return Zt(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===oi}copy(){const t=new ki;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function Ei(t){const e={};if(t.isDefault())return e;let n;return t.index_===oi?n="$priority":t.index_===mi?n="$value":t.index_===Vr?n="$key":(Zt(t.index_ instanceof gi,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=fe(n),t.startSet_&&(e.startAt=fe(t.indexStartValue_),t.startNameSet_&&(e.startAt+=","+fe(t.indexStartName_))),t.endSet_&&(e.endAt=fe(t.indexEndValue_),t.endNameSet_&&(e.endAt+=","+fe(t.indexEndName_))),t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function Ii(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_)),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_)),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;""===n&&(n=t.isViewFromLeft()?"l":"r"),e.vf=n}return t.index_!==oi&&(e.i=t.index_.toString()),e}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Si extends wr{constructor(t,e,n,r){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=Ln("p:rest:"),this.listens_={}}reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,e){return void 0!==e?"tag$"+e:(Zt(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}listen(t,e,n,r){const i=t._path.toString();this.log_("Listen called for "+i+" "+t._queryIdentifier);const o=Si.getListenId_(t,n),s={};this.listens_[o]=s;const a=Ei(t._queryParams);this.restRequest_(i+".json",a,((t,e)=>{let a=e;if(404===t&&(a=null,t=null),null===t&&this.onDataUpdate_(i,a,!1,n),ge(this.listens_,o)===s){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",r(e,null)}}))}unlisten(t,e){const n=Si.getListenId_(t,e);delete this.listens_[n]}get(t){const e=Ei(t._queryParams),n=t._path.toString(),r=new se;return this.restRequest_(n+".json",e,((t,e)=>{let i=e;404===t&&(i=null,t=null),null===t?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(new Error(i))})),r.promise}refreshAuthToken(t){}restRequest_(t,e={},n){return e.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([r,i])=>{r&&r.accessToken&&(e.auth=r.accessToken),i&&i.token&&(e.ac=i.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+function(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach((t=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}(e);this.log_("Sending REST request for "+o);const s=new XMLHttpRequest;s.onreadystatechange=()=>{if(n&&4===s.readyState){this.log_("REST Response for "+o+" received. status:",s.status,"response:",s.responseText);let t=null;if(s.status>=200&&s.status<300){try{t=de(s.responseText)}catch(t){qn("Failed to parse JSON response for "+o+": "+s.responseText)}n(null,t)}else 401!==s.status&&404!==s.status&&qn("Got unsuccessful REST response for "+o+" Status: "+s.status),n(s.status);n=null}},s.open("GET",o,!0),s.send()}))}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ni{constructor(){this.rootNode_=fi.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Ti(){return{value:null,children:new Map}}function Ri(t,e,n){if(Mr(e))t.value=n,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(e,n);else{const r=Er(e);t.children.has(r)||t.children.set(r,Ti());Ri(t.children.get(r),e=Sr(e),n)}}function Pi(t,e,n){null!==t.value?n(e,t.value):function(t,e){t.children.forEach(((t,n)=>{e(n,t)}))}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(t,((t,r)=>{Pi(r,new xr(e.toString()+"/"+t),n)}))}class Mi{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),e=Object.assign({},t);return this.last_&&Yn(this.last_,((t,n)=>{e[t]=e[t]-n})),this.last_=t,e}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ai{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new Mi(t);const n=1e4+2e4*Math.random();Zn(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const t=this.statsListener_.get(),e={};let n=!1;Yn(t,((t,r)=>{r>0&&_e(this.statsToReport_,t)&&(e[t]=r,n=!0)})),n&&this.server_.reportStats(e),Zn(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var Oi;function Di(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */!function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Oi||(Oi={}));class Li{constructor(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Oi.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(t){if(Mr(this.path)){if(null!=this.affectedTree.value)return Zt(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const e=this.affectedTree.subtree(new xr(t));return new Li(kr(),e,this.revert)}}return Zt(Er(this.path)===t,"operationForChild called for unrelated child."),new Li(Sr(this.path),this.affectedTree,this.revert)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Fi{constructor(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Oi.OVERWRITE}operationForChild(t){return Mr(this.path)?new Fi(this.source,kr(),this.snap.getImmediateChild(t)):new Fi(this.source,Sr(this.path),this.snap)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class $i{constructor(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Oi.MERGE}operationForChild(t){if(Mr(this.path)){const e=this.children.subtree(new xr(t));return e.isEmpty()?null:e.value?new Fi(this.source,kr(),e.value):new $i(this.source,kr(),e)}return Zt(Er(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new $i(this.source,Sr(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class qi{constructor(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(Mr(t))return this.isFullyInitialized()&&!this.filtered_;const e=Er(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class ji{constructor(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()}}function zi(t,e,n,r,i,o){const s=r.filter((t=>t.type===n));s.sort(((e,n)=>function(t,e,n){if(null==e.childName||null==n.childName)throw te("Should only compare child_ events.");const r=new Br(e.childName,e.snapshotNode),i=new Br(n.childName,n.snapshotNode);return t.index_.compare(r,i)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(t,e,n))),s.forEach((n=>{const r=function(t,e,n){return"value"===e.type||"child_removed"===e.type||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}(t,n,o);i.forEach((i=>{i.respondsTo(n.type)&&e.push(i.createEvent(r,t.query_))}))}))}function Bi(t,e){return{eventCache:t,serverCache:e}}function Ui(t,e,n,r){return Bi(new qi(e,n,r),t.serverCache)}function Wi(t,e,n,r){return Bi(t.eventCache,new qi(e,n,r))}function Hi(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Vi(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */let Gi;class Yi{constructor(t,e=(()=>(Gi||(Gi=new Kr(Wn)),Gi))()){this.value=t,this.children=e}static fromObject(t){let e=new Yi(null);return Yn(t,((t,n)=>{e=e.set(new xr(t),n)})),e}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(null!=this.value&&e(this.value))return{path:kr(),value:this.value};if(Mr(t))return null;{const n=Er(t),r=this.children.get(n);if(null!==r){const i=r.findRootMostMatchingPathAndValue(Sr(t),e);if(null!=i){return{path:Pr(new xr(n),i.path),value:i.value}}return null}return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,(()=>!0))}subtree(t){if(Mr(t))return this;{const e=Er(t),n=this.children.get(e);return null!==n?n.subtree(Sr(t)):new Yi(null)}}set(t,e){if(Mr(t))return new Yi(e,this.children);{const n=Er(t),r=(this.children.get(n)||new Yi(null)).set(Sr(t),e),i=this.children.insert(n,r);return new Yi(this.value,i)}}remove(t){if(Mr(t))return this.children.isEmpty()?new Yi(null):new Yi(null,this.children);{const e=Er(t),n=this.children.get(e);if(n){const r=n.remove(Sr(t));let i;return i=r.isEmpty()?this.children.remove(e):this.children.insert(e,r),null===this.value&&i.isEmpty()?new Yi(null):new Yi(this.value,i)}return this}}get(t){if(Mr(t))return this.value;{const e=Er(t),n=this.children.get(e);return n?n.get(Sr(t)):null}}setTree(t,e){if(Mr(t))return e;{const n=Er(t),r=(this.children.get(n)||new Yi(null)).setTree(Sr(t),e);let i;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new Yi(this.value,i)}}fold(t){return this.fold_(kr(),t)}fold_(t,e){const n={};return this.children.inorderTraversal(((r,i)=>{n[r]=i.fold_(Pr(t,r),e)})),e(t,this.value,n)}findOnPath(t,e){return this.findOnPath_(t,kr(),e)}findOnPath_(t,e,n){const r=!!this.value&&n(e,this.value);if(r)return r;if(Mr(t))return null;{const r=Er(t),i=this.children.get(r);return i?i.findOnPath_(Sr(t),Pr(e,r),n):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,kr(),e)}foreachOnPath_(t,e,n){if(Mr(t))return this;{this.value&&n(e,this.value);const r=Er(t),i=this.children.get(r);return i?i.foreachOnPath_(Sr(t),Pr(e,r),n):new Yi(null)}}foreach(t){this.foreach_(kr(),t)}foreach_(t,e){this.children.inorderTraversal(((n,r)=>{r.foreach_(Pr(t,n),e)})),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal(((e,n)=>{n.value&&t(e,n.value)}))}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ki{constructor(t){this.writeTree_=t}static empty(){return new Ki(new Yi(null))}}function Xi(t,e,n){if(Mr(e))return new Ki(new Yi(n));{const r=t.writeTree_.findRootMostValueAndPath(e);if(null!=r){const i=r.path;let o=r.value;const s=Ar(i,e);return o=o.updateChild(s,n),new Ki(t.writeTree_.set(i,o))}{const r=new Yi(n),i=t.writeTree_.setTree(e,r);return new Ki(i)}}}function Qi(t,e,n){let r=t;return Yn(n,((t,n)=>{r=Xi(r,Pr(e,t),n)})),r}function Ji(t,e){if(Mr(e))return Ki.empty();{const n=t.writeTree_.setTree(e,new Yi(null));return new Ki(n)}}function Zi(t,e){return null!=to(t,e)}function to(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return null!=n?t.writeTree_.get(n.path).getChild(Ar(n.path,e)):null}function eo(t){const e=[],n=t.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(oi,((t,n)=>{e.push(new Br(t,n))})):t.writeTree_.children.inorderTraversal(((t,n)=>{null!=n.value&&e.push(new Br(t,n.value))})),e}function no(t,e){if(Mr(e))return t;{const n=to(t,e);return new Ki(null!=n?new Yi(n):t.writeTree_.subtree(e))}}function ro(t){return t.writeTree_.isEmpty()}function io(t,e){return oo(kr(),t.writeTree_,e)}function oo(t,e,n){if(null!=e.value)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal(((e,i)=>{".priority"===e?(Zt(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=oo(Pr(t,e),i,n)})),n.getChild(t).isEmpty()||null===r||(n=n.updateChild(Pr(t,".priority"),r)),n}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function so(t,e){return wo(e,t)}function ao(t,e){const n=t.allWrites.findIndex((t=>t.writeId===e));Zt(n>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[n];t.allWrites.splice(n,1);let i=r.visible,o=!1,s=t.allWrites.length-1;for(;i&&s>=0;){const e=t.allWrites[s];e.visible&&(s>=n&&lo(e,r.path)?i=!1:Dr(r.path,e.path)&&(o=!0)),s--}if(i){if(o)return function(t){t.visibleWrites=uo(t.allWrites,co,kr()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}(t),!0;if(r.snap)t.visibleWrites=Ji(t.visibleWrites,r.path);else{Yn(r.children,(e=>{t.visibleWrites=Ji(t.visibleWrites,Pr(r.path,e))}))}return!0}return!1}function lo(t,e){if(t.snap)return Dr(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&Dr(Pr(t.path,n),e))return!0;return!1}function co(t){return t.visible}function uo(t,e,n){let r=Ki.empty();for(let i=0;i<t.length;++i){const o=t[i];if(e(o)){const t=o.path;let e;if(o.snap)Dr(n,t)?(e=Ar(n,t),r=Xi(r,e,o.snap)):Dr(t,n)&&(e=Ar(t,n),r=Xi(r,kr(),o.snap.getChild(e)));else{if(!o.children)throw te("WriteRecord should have .snap or .children");if(Dr(n,t))e=Ar(n,t),r=Qi(r,e,o.children);else if(Dr(t,n))if(e=Ar(t,n),Mr(e))r=Qi(r,kr(),o.children);else{const t=ge(o.children,Er(e));if(t){const n=t.getChild(Sr(e));r=Xi(r,kr(),n)}}}}}return r}function ho(t,e,n,r,i){if(r||i){const o=no(t.visibleWrites,e);if(!i&&ro(o))return n;if(i||null!=n||Zi(o,kr())){const o=function(t){return(t.visible||i)&&(!r||!~r.indexOf(t.writeId))&&(Dr(t.path,e)||Dr(e,t.path))};return io(uo(t.allWrites,o,e),n||fi.EMPTY_NODE)}return null}{const r=to(t.visibleWrites,e);if(null!=r)return r;{const r=no(t.visibleWrites,e);if(ro(r))return n;if(null!=n||Zi(r,kr())){return io(r,n||fi.EMPTY_NODE)}return null}}}function fo(t,e,n,r){return ho(t.writeTree,t.treePath,e,n,r)}function po(t,e){return function(t,e,n){let r=fi.EMPTY_NODE;const i=to(t.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(oi,((t,e)=>{r=r.updateImmediateChild(t,e)})),r;if(n){const i=no(t.visibleWrites,e);return n.forEachChild(oi,((t,e)=>{const n=io(no(i,new xr(t)),e);r=r.updateImmediateChild(t,n)})),eo(i).forEach((t=>{r=r.updateImmediateChild(t.name,t.node)})),r}return eo(no(t.visibleWrites,e)).forEach((t=>{r=r.updateImmediateChild(t.name,t.node)})),r}(t.writeTree,t.treePath,e)}function _o(t,e,n,r){return function(t,e,n,r,i){Zt(r||i,"Either existingEventSnap or existingServerSnap must exist");const o=Pr(e,n);if(Zi(t.visibleWrites,o))return null;{const e=no(t.visibleWrites,o);return ro(e)?i.getChild(n):io(e,i.getChild(n))}}(t.writeTree,t.treePath,e,n,r)}function go(t,e){return function(t,e){return to(t.visibleWrites,e)}(t.writeTree,Pr(t.treePath,e))}function mo(t,e,n,r,i,o){return function(t,e,n,r,i,o,s){let a;const l=no(t.visibleWrites,e),c=to(l,kr());if(null!=c)a=c;else{if(null==n)return[];a=io(l,n)}if(a=a.withIndex(s),a.isEmpty()||a.isLeafNode())return[];{const t=[],e=s.getCompare(),n=o?a.getReverseIteratorFrom(r,s):a.getIteratorFrom(r,s);let l=n.getNext();for(;l&&t.length<i;)0!==e(l,r)&&t.push(l),l=n.getNext();return t}}(t.writeTree,t.treePath,e,n,r,i,o)}function vo(t,e,n){return function(t,e,n,r){const i=Pr(e,n),o=to(t.visibleWrites,i);if(null!=o)return o;if(r.isCompleteForChild(n))return io(no(t.visibleWrites,i),r.getNode().getImmediateChild(n));return null}(t.writeTree,t.treePath,e,n)}function yo(t,e){return wo(Pr(t.treePath,e),t.writeTree)}function wo(t,e){return{treePath:t,writeTree:e}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class bo{constructor(){this.changeMap=new Map}trackChildChange(t){const e=t.type,n=t.childName;Zt("child_added"===e||"child_changed"===e||"child_removed"===e,"Only child changes supported for tracking"),Zt(".priority"!==n,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const i=r.type;if("child_added"===e&&"child_removed"===i)this.changeMap.set(n,wi(n,t.snapshotNode,r.snapshotNode));else if("child_removed"===e&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===e&&"child_changed"===i)this.changeMap.set(n,yi(n,r.oldSnap));else if("child_changed"===e&&"child_added"===i)this.changeMap.set(n,vi(n,t.snapshotNode));else{if("child_changed"!==e||"child_changed"!==i)throw te("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,wi(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)}getChanges(){return Array.from(this.changeMap.values())}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Co=new class{getCompleteChild(t){return null}getChildAfterChild(t,e,n){return null}};class xo{constructor(t,e,n=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}getCompleteChild(t){const e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{const e=null!=this.optCompleteServerCache_?new qi(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return vo(this.writes_,t,e)}}getChildAfterChild(t,e,n){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Vi(this.viewCache_),i=mo(this.writes_,r,e,1,n,t);return 0===i.length?null:i[0]}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function ko(t,e,n,r,i){const o=new bo;let s,a;if(n.type===Oi.OVERWRITE){const l=n;l.source.fromUser?s=So(t,e,l.path,l.snap,r,i,o):(Zt(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered()&&!Mr(l.path),s=Io(t,e,l.path,l.snap,r,i,a,o))}else if(n.type===Oi.MERGE){const l=n;l.source.fromUser?s=function(t,e,n,r,i,o,s){let a=e;return r.foreach(((r,l)=>{const c=Pr(n,r);No(e,Er(c))&&(a=So(t,a,c,l,i,o,s))})),r.foreach(((r,l)=>{const c=Pr(n,r);No(e,Er(c))||(a=So(t,a,c,l,i,o,s))})),a}(t,e,l.path,l.children,r,i,o):(Zt(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered(),s=Ro(t,e,l.path,l.children,r,i,a,o))}else if(n.type===Oi.ACK_USER_WRITE){const a=n;s=a.revert?function(t,e,n,r,i,o){let s;if(null!=go(r,n))return e;{const a=new xo(r,e,i),l=e.eventCache.getNode();let c;if(Mr(n)||".priority"===Er(n)){let n;if(e.serverCache.isFullyInitialized())n=fo(r,Vi(e));else{const t=e.serverCache.getNode();Zt(t instanceof fi,"serverChildren would be complete if leaf node"),n=po(r,t)}n=n,c=t.filter.updateFullNode(l,n,o)}else{const i=Er(n);let u=vo(r,i,e.serverCache);null==u&&e.serverCache.isCompleteForChild(i)&&(u=l.getImmediateChild(i)),c=null!=u?t.filter.updateChild(l,i,u,Sr(n),a,o):e.eventCache.getNode().hasChild(i)?t.filter.updateChild(l,i,fi.EMPTY_NODE,Sr(n),a,o):l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(s=fo(r,Vi(e)),s.isLeafNode()&&(c=t.filter.updateFullNode(c,s,o)))}return s=e.serverCache.isFullyInitialized()||null!=go(r,kr()),Ui(e,c,s,t.filter.filtersNodes())}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(t,e,a.path,r,i,o):function(t,e,n,r,i,o,s){if(null!=go(i,n))return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(null!=r.value){if(Mr(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return Io(t,e,n,l.getNode().getChild(n),i,o,a,s);if(Mr(n)){let r=new Yi(null);return l.getNode().forEachChild(Vr,((t,e)=>{r=r.set(new xr(t),e)})),Ro(t,e,n,r,i,o,a,s)}return e}{let c=new Yi(null);return r.foreach(((t,e)=>{const r=Pr(n,t);l.isCompleteForPath(r)&&(c=c.set(t,l.getNode().getChild(r)))})),Ro(t,e,n,c,i,o,a,s)}}(t,e,a.path,a.affectedTree,r,i,o)}else{if(n.type!==Oi.LISTEN_COMPLETE)throw te("Unknown operation type: "+n.type);s=function(t,e,n,r,i){const o=e.serverCache,s=Wi(e,o.getNode(),o.isFullyInitialized()||Mr(n),o.isFiltered());return Eo(t,s,n,r,Co,i)}(t,e,n.path,r,o)}const l=o.getChanges();return function(t,e,n){const r=e.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=Hi(t);(n.length>0||!t.eventCache.isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push({type:"value",snapshotNode:Hi(e)})}}(e,s,l),{viewCache:s,changes:l}}function Eo(t,e,n,r,i,o){const s=e.eventCache;if(null!=go(r,n))return e;{let a,l;if(Mr(n))if(Zt(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const n=Vi(e),i=po(r,n instanceof fi?n:fi.EMPTY_NODE);a=t.filter.updateFullNode(e.eventCache.getNode(),i,o)}else{const n=fo(r,Vi(e));a=t.filter.updateFullNode(e.eventCache.getNode(),n,o)}else{const c=Er(n);if(".priority"===c){Zt(1===Ir(n),"Can't have a priority with additional path components");const i=s.getNode();l=e.serverCache.getNode();const o=_o(r,n,i,l);a=null!=o?t.filter.updatePriority(i,o):s.getNode()}else{const u=Sr(n);let h;if(s.isCompleteForChild(c)){l=e.serverCache.getNode();const t=_o(r,n,s.getNode(),l);h=null!=t?s.getNode().getImmediateChild(c).updateChild(u,t):s.getNode().getImmediateChild(c)}else h=vo(r,c,e.serverCache);a=null!=h?t.filter.updateChild(s.getNode(),c,h,u,i,o):s.getNode()}}return Ui(e,a,s.isFullyInitialized()||Mr(n),t.filter.filtersNodes())}}function Io(t,e,n,r,i,o,s,a){const l=e.serverCache;let c;const u=s?t.filter:t.filter.getIndexedFilter();if(Mr(n))c=u.updateFullNode(l.getNode(),r,null);else if(u.filtersNodes()&&!l.isFiltered()){const t=l.getNode().updateChild(n,r);c=u.updateFullNode(l.getNode(),t,null)}else{const t=Er(n);if(!l.isCompleteForPath(n)&&Ir(n)>1)return e;const i=Sr(n),o=l.getNode().getImmediateChild(t).updateChild(i,r);c=".priority"===t?u.updatePriority(l.getNode(),o):u.updateChild(l.getNode(),t,o,i,Co,null)}const h=Wi(e,c,l.isFullyInitialized()||Mr(n),u.filtersNodes());return Eo(t,h,n,i,new xo(i,h,o),a)}function So(t,e,n,r,i,o,s){const a=e.eventCache;let l,c;const u=new xo(i,e,o);if(Mr(n))c=t.filter.updateFullNode(e.eventCache.getNode(),r,s),l=Ui(e,c,!0,t.filter.filtersNodes());else{const i=Er(n);if(".priority"===i)c=t.filter.updatePriority(e.eventCache.getNode(),r),l=Ui(e,c,a.isFullyInitialized(),a.isFiltered());else{const o=Sr(n),c=a.getNode().getImmediateChild(i);let h;if(Mr(o))h=r;else{const t=u.getCompleteChild(i);h=null!=t?".priority"===Nr(o)&&t.getChild(Rr(o)).isEmpty()?t:t.updateChild(o,r):fi.EMPTY_NODE}if(c.equals(h))l=e;else{l=Ui(e,t.filter.updateChild(a.getNode(),i,h,o,u,s),a.isFullyInitialized(),t.filter.filtersNodes())}}}return l}function No(t,e){return t.eventCache.isCompleteForChild(e)}function To(t,e,n){return n.foreach(((t,n)=>{e=e.updateChild(t,n)})),e}function Ro(t,e,n,r,i,o,s,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l,c=e;l=Mr(n)?r:new Yi(null).setTree(n,r);const u=e.serverCache.getNode();return l.children.inorderTraversal(((n,r)=>{if(u.hasChild(n)){const l=To(0,e.serverCache.getNode().getImmediateChild(n),r);c=Io(t,c,new xr(n),l,i,o,s,a)}})),l.children.inorderTraversal(((n,r)=>{const l=!e.serverCache.isCompleteForChild(n)&&void 0===r.value;if(!u.hasChild(n)&&!l){const l=To(0,e.serverCache.getNode().getImmediateChild(n),r);c=Io(t,c,new xr(n),l,i,o,s,a)}})),c}class Po{constructor(t,e){this.query_=t,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new bi(n.getIndex()),i=(o=n).loadsAllData()?new bi(o.getIndex()):o.hasLimit()?new xi(o):new Ci(o);var o;this.processor_=function(t){return{filter:t}}(i);const s=e.serverCache,a=e.eventCache,l=r.updateFullNode(fi.EMPTY_NODE,s.getNode(),null),c=i.updateFullNode(fi.EMPTY_NODE,a.getNode(),null),u=new qi(l,s.isFullyInitialized(),r.filtersNodes()),h=new qi(c,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=Bi(h,u),this.eventGenerator_=new ji(this.query_)}get query(){return this.query_}}function Mo(t,e){const n=Vi(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!Mr(e)&&!n.getImmediateChild(Er(e)).isEmpty())?n.getChild(e):null}function Ao(t,e,n,r){e.type===Oi.MERGE&&null!==e.source.queryId&&(Zt(Vi(t.viewCache_),"We should always have a full cache before handling merges"),Zt(Hi(t.viewCache_),"Missing event cache, even though we have a server cache"));const i=t.viewCache_,o=ko(t.processor_,i,e,n,r);var s,a;return s=t.processor_,a=o.viewCache,Zt(a.eventCache.getNode().isIndexed(s.filter.getIndex()),"Event snap not indexed"),Zt(a.serverCache.getNode().isIndexed(s.filter.getIndex()),"Server snap not indexed"),Zt(o.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=o.viewCache,function(t,e,n,r){const i=r?[r]:t.eventRegistrations_;return function(t,e,n,r){const i=[],o=[];return e.forEach((e=>{var n;"child_changed"===e.type&&t.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&o.push((n=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:n}))})),zi(t,i,"child_removed",e,r,n),zi(t,i,"child_added",e,r,n),zi(t,i,"child_moved",o,r,n),zi(t,i,"child_changed",e,r,n),zi(t,i,"value",e,r,n),i}(t.eventGenerator_,e,n,i)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(t,o.changes,o.viewCache.eventCache.getNode(),null)}let Oo,Do;class Lo{constructor(){this.views=new Map}}function Fo(t,e,n,r){const i=e.source.queryId;if(null!==i){const o=t.views.get(i);return Zt(null!=o,"SyncTree gave us an op for an invalid query."),Ao(o,e,n,r)}{let i=[];for(const o of t.views.values())i=i.concat(Ao(o,e,n,r));return i}}function $o(t,e){let n=null;for(const r of t.views.values())n=n||Mo(r,e);return n}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class qo{constructor(t){this.listenProvider_=t,this.syncPointTree_=new Yi(null),this.pendingWriteTree_={visibleWrites:Ki.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function jo(t,e,n,r,i){return function(t,e,n,r,i){Zt(r>t.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:i}),i&&(t.visibleWrites=Xi(t.visibleWrites,e,n)),t.lastWriteId=r}(t.pendingWriteTree_,e,n,r,i),i?Ho(t,new Fi({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,n)):[]}function zo(t,e,n=!1){const r=function(t,e){for(let n=0;n<t.allWrites.length;n++){const r=t.allWrites[n];if(r.writeId===e)return r}return null}(t.pendingWriteTree_,e);if(ao(t.pendingWriteTree_,e)){let e=new Yi(null);return null!=r.snap?e=e.set(kr(),!0):Yn(r.children,(t=>{e=e.set(new xr(t),!0)})),Ho(t,new Li(r.path,e,n))}return[]}function Bo(t,e,n){return Ho(t,new Fi({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,n))}function Uo(t,e,n){const r=t.pendingWriteTree_,i=t.syncPointTree_.findOnPath(e,((t,n)=>{const r=$o(n,Ar(t,e));if(r)return r}));return ho(r,e,i,n,!0)}function Wo(t,e){const n=e._path;let r=null;t.syncPointTree_.foreachOnPath(n,((t,e)=>{const i=Ar(t,n);r=r||$o(e,i)}));let i=t.syncPointTree_.get(n);i?r=r||$o(i,kr()):(i=new Lo,t.syncPointTree_=t.syncPointTree_.set(n,i));const o=null!=r,s=o?new qi(r,!0,!1):null,a=function(t,e,n,r,i){const o=e._queryIdentifier,s=t.views.get(o);if(!s){let t=fo(n,i?r:null),o=!1;t?o=!0:r instanceof fi?(t=po(n,r),o=!1):(t=fi.EMPTY_NODE,o=!1);const s=Bi(new qi(t,o,!1),new qi(r,i,!1));return new Po(e,s)}return s}(i,e,so(t.pendingWriteTree_,e._path),o?s.getNode():fi.EMPTY_NODE,o);return function(t){return Hi(t.viewCache_)}(a)}function Ho(t,e){return Vo(e,t.syncPointTree_,null,so(t.pendingWriteTree_,kr()))}function Vo(t,e,n,r){if(Mr(t.path))return Go(t,e,n,r);{const i=e.get(kr());null==n&&null!=i&&(n=$o(i,kr()));let o=[];const s=Er(t.path),a=t.operationForChild(s),l=e.children.get(s);if(l&&a){const t=n?n.getImmediateChild(s):null,e=yo(r,s);o=o.concat(Vo(a,l,t,e))}return i&&(o=o.concat(Fo(i,t,r,n))),o}}function Go(t,e,n,r){const i=e.get(kr());null==n&&null!=i&&(n=$o(i,kr()));let o=[];return e.children.inorderTraversal(((e,i)=>{const s=n?n.getImmediateChild(e):null,a=yo(r,e),l=t.operationForChild(e);l&&(o=o.concat(Go(l,i,s,a)))})),i&&(o=o.concat(Fo(i,t,r,n))),o}function Yo(t,e){return t.tagToQueryMap.get(e)}function Ko(t){const e=t.indexOf("$");return Zt(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new xr(t.substr(0,e))}}function Xo(t,e,n){const r=t.syncPointTree_.get(e);Zt(r,"Missing sync point for query tag that we're tracking");return Fo(r,n,so(t.pendingWriteTree_,e),null)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Qo{constructor(t){this.node_=t}getImmediateChild(t){const e=this.node_.getImmediateChild(t);return new Qo(e)}node(){return this.node_}}class Jo{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){const e=Pr(this.path_,t);return new Jo(this.syncTree_,e)}node(){return Uo(this.syncTree_,this.path_)}}const Zo=function(t,e,n){return t&&"object"==typeof t?(Zt(".sv"in t,"Unexpected leaf node or priority contents"),"string"==typeof t[".sv"]?ts(t[".sv"],e,n):"object"==typeof t[".sv"]?es(t[".sv"],e):void Zt(!1,"Unexpected server value: "+JSON.stringify(t,null,2))):t},ts=function(t,e,n){if("timestamp"===t)return n.timestamp;Zt(!1,"Unexpected server value: "+t)},es=function(t,e,n){t.hasOwnProperty("increment")||Zt(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;"number"!=typeof r&&Zt(!1,"Unexpected increment value: "+r);const i=e.node();if(Zt(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const o=i.getValue();return"number"!=typeof o?r:o+r},ns=function(t,e,n){return rs(t,new Qo(e),n)};function rs(t,e,n){const r=t.getPriority().val(),i=Zo(r,e.getImmediateChild(".priority"),n);let o;if(t.isLeafNode()){const r=t,o=Zo(r.getValue(),e,n);return o!==r.getValue()||i!==r.getPriority().val()?new ii(o,_i(i)):t}{const r=t;return o=r,i!==r.getPriority().val()&&(o=o.updatePriority(new ii(i))),r.forEachChild(oi,((t,r)=>{const i=rs(r,e.getImmediateChild(t),n);i!==r&&(o=o.updateImmediateChild(t,i))})),o}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class is{constructor(t="",e=null,n={children:{},childCount:0}){this.name=t,this.parent=e,this.node=n}}function os(t,e){let n=e instanceof xr?e:new xr(e),r=t,i=Er(n);for(;null!==i;){const t=ge(r.node.children,i)||{children:{},childCount:0};r=new is(i,r,t),n=Sr(n),i=Er(n)}return r}function ss(t){return t.node.value}function as(t,e){t.node.value=e,ds(t)}function ls(t){return t.node.childCount>0}function cs(t,e){Yn(t.node.children,((n,r)=>{e(new is(n,t,r))}))}function us(t,e,n,r){n&&!r&&e(t),cs(t,(t=>{us(t,e,!0,r)})),n&&r&&e(t)}function hs(t){return new xr(null===t.parent?t.name:hs(t.parent)+"/"+t.name)}function ds(t){null!==t.parent&&function(t,e,n){const r=function(t){return void 0===ss(t)&&!ls(t)}(n),i=_e(t.node.children,e);r&&i?(delete t.node.children[e],t.node.childCount--,ds(t)):r||i||(t.node.children[e]=n.node,t.node.childCount++,ds(t))}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(t.parent,t.name,t)}const fs=/[\[\].#$\/\u0000-\u001F\u007F]/,ps=/[\[\].#$\u0000-\u001F\u007F]/,_s=10485760,gs=function(t){return"string"==typeof t&&0!==t.length&&!fs.test(t)},ms=function(t){return"string"==typeof t&&0!==t.length&&!ps.test(t)},vs=function(t,e,n){const r=n instanceof xr?new Lr(n,t):n;if(void 0===e)throw new Error(t+"contains undefined "+$r(r));if("function"==typeof e)throw new Error(t+"contains a function "+$r(r)+" with contents = "+e.toString());if(jn(e))throw new Error(t+"contains "+e.toString()+" "+$r(r));if("string"==typeof e&&e.length>_s/3&&xe(e)>_s)throw new Error(t+"contains a string greater than "+"10485760 utf8 bytes "+$r(r)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let n=!1,i=!1;if(Yn(e,((e,o)=>{if(".value"===e)n=!0;else if(".priority"!==e&&".sv"!==e&&(i=!0,!gs(e)))throw new Error(t+" contains an invalid key ("+e+") "+$r(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=xe(e),Fr(t)}(r,e),vs(t,o,r),function(t){const e=t.parts_.pop();t.byteLength_-=xe(e),t.parts_.length>0&&(t.byteLength_-=1)}(r)})),n&&i)throw new Error(t+' contains ".value" child '+$r(r)+" in addition to actual children.")}},ys=function(t,e,n,r){if(!(r&&void 0===n||ms(n)))throw new Error(Ce(t,e)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},ws=function(t,e){const n=e.path.toString();if("string"!=typeof e.repoInfo.host||0===e.repoInfo.host.length||!gs(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==n.length&&!function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),ms(t)}(n))throw new Error(Ce(t,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class bs{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Cs(t,e){let n=null;for(let r=0;r<e.length;r++){const i=e[r],o=i.getPath();null===n||Or(o,n.path)||(t.eventLists_.push(n),n=null),null===n&&(n={events:[],path:o}),n.events.push(i)}n&&t.eventLists_.push(n)}function xs(t,e,n){Cs(t,n),ks(t,(t=>Dr(t,e)||Dr(e,t)))}function ks(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){const i=t.eventLists_[r];if(i){e(i.path)?(Es(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function Es(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(null!==n){t.events[e]=null;const r=n.getEventRunner();An&&Dn("event: "+n.toString()),Jn(r)}}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Is{constructor(t,e,n,r){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new bs,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Ti(),this.transactionQueueTree_=new is,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Ss(t,e,n){if(t.stats_=hr(t.repoInfo_),t.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)t.server_=new Si(t.repoInfo_,((e,n,r,i)=>{Rs(t,e,n,r,i)}),t.authTokenProvider_,t.appCheckProvider_),setTimeout((()=>Ps(t,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{fe(n)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}t.persistentConnection_=new zr(t.repoInfo_,e,((e,n,r,i)=>{Rs(t,e,n,r,i)}),(e=>{Ps(t,e)}),(e=>{!function(t,e){Yn(e,((e,n)=>{Ms(t,e,n)}))}(t,e)}),t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener((e=>{t.server_.refreshAuthToken(e)})),t.appCheckProvider_.addTokenChangeListener((e=>{t.server_.refreshAppCheckToken(e.token)})),t.statsReporter_=function(t,e){const n=t.toString();return ur[n]||(ur[n]=e()),ur[n]}(t.repoInfo_,(()=>new Ai(t.stats_,t.server_))),t.infoData_=new Ni,t.infoSyncTree_=new qo({startListening:(e,n,r,i)=>{let o=[];const s=t.infoData_.getNode(e._path);return s.isEmpty()||(o=Bo(t.infoSyncTree_,e._path,s),setTimeout((()=>{i("ok")}),0)),o},stopListening:()=>{}}),Ms(t,"connected",!1),t.serverSyncTree_=new qo({startListening:(e,n,r,i)=>(t.server_.listen(e,r,n,((n,r)=>{const o=i(n,r);xs(t.eventQueue_,e._path,o)})),[]),stopListening:(e,n)=>{t.server_.unlisten(e,n)}})}function Ns(t){const e=t.infoData_.getNode(new xr(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e}function Ts(t){return(e=(e={timestamp:Ns(t)})||{}).timestamp=e.timestamp||(new Date).getTime(),e;var e}function Rs(t,e,n,r,i){t.dataUpdateCount++;const o=new xr(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let s=[];if(i)if(r){const e=ve(n,(t=>_i(t)));s=function(t,e,n,r){const i=Yo(t,r);if(i){const r=Ko(i),o=r.path,s=r.queryId,a=Ar(o,e),l=Yi.fromObject(n);return Xo(t,o,new $i(Di(s),a,l))}return[]}(t.serverSyncTree_,o,e,i)}else{const e=_i(n);s=function(t,e,n,r){const i=Yo(t,r);if(null!=i){const r=Ko(i),o=r.path,s=r.queryId,a=Ar(o,e);return Xo(t,o,new Fi(Di(s),a,n))}return[]}(t.serverSyncTree_,o,e,i)}else if(r){const e=ve(n,(t=>_i(t)));s=function(t,e,n){const r=Yi.fromObject(n);return Ho(t,new $i({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,r))}(t.serverSyncTree_,o,e)}else{const e=_i(n);s=Bo(t.serverSyncTree_,o,e)}let a=o;s.length>0&&(a=qs(t,o)),xs(t.eventQueue_,a,s)}function Ps(t,e){Ms(t,"connected",e),!1===e&&function(t){Ls(t,"onDisconnectEvents");const e=Ts(t),n=Ti();Pi(t.onDisconnect_,kr(),((r,i)=>{const o=function(t,e,n,r){return rs(e,new Jo(n,t),r)}(r,i,t.serverSyncTree_,e);Ri(n,r,o)}));let r=[];Pi(n,kr(),((e,n)=>{r=r.concat(Bo(t.serverSyncTree_,e,n));const i=Ws(t,e);qs(t,i)})),t.onDisconnect_=Ti(),xs(t.eventQueue_,kr(),r)}(t)}function Ms(t,e,n){const r=new xr("/.info/"+e),i=_i(n);t.infoData_.updateSnapshot(r,i);const o=Bo(t.infoSyncTree_,r,i);xs(t.eventQueue_,r,o)}function As(t){return t.nextWriteId_++}function Os(t,e){const n=Wo(t.serverSyncTree_,e);return null!=n?Promise.resolve(n):t.server_.get(e).then((n=>{const r=_i(n).withIndex(e._queryParams.getIndex()),i=Bo(t.serverSyncTree_,e._path,r);var o,s;return o=t.eventQueue_,s=e._path,Cs(o,i),ks(o,(t=>Or(t,s))),Promise.resolve(r)}),(n=>(Ls(t,"get for query "+fe(e)+" failed: "+n),Promise.reject(new Error(n)))))}function Ds(t,e,n,r,i){Ls(t,"set",{path:e.toString(),value:n,priority:r});const o=Ts(t),s=_i(n,r),a=Uo(t.serverSyncTree_,e),l=ns(s,a,o),c=As(t),u=jo(t.serverSyncTree_,e,l,c,!0);Cs(t.eventQueue_,u),t.server_.put(e.toString(),s.val(!0),((n,r)=>{const o="ok"===n;o||qn("set at "+e+" failed: "+n);const s=zo(t.serverSyncTree_,c,!o);xs(t.eventQueue_,e,s),function(t,e,n,r){e&&Jn((()=>{if("ok"===n)e(null);else{const t=(n||"error").toUpperCase();let i=t;r&&(i+=": "+r);const o=new Error(i);o.code=t,e(o)}}))}(0,i,n,r)}));const h=Ws(t,e);qs(t,h),xs(t.eventQueue_,h,[])}function Ls(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),Dn(n,...e)}function Fs(t,e,n){return Uo(t.serverSyncTree_,e,n)||fi.EMPTY_NODE}function $s(t,e=t.transactionQueueTree_){if(e||Us(t,e),ss(e)){const n=zs(t,e);Zt(n.length>0,"Sending zero length transaction queue");n.every((t=>0===t.status))&&function(t,e,n){const r=n.map((t=>t.currentWriteId)),i=Fs(t,e,r);let o=i;const s=i.hash();for(let t=0;t<n.length;t++){const r=n[t];Zt(0===r.status,"tryToSendTransactionQueue_: items in queue should all be run."),r.status=1,r.retryCount++;const i=Ar(e,r.path);o=o.updateChild(i,r.currentOutputSnapshotRaw)}const a=o.val(!0),l=e;t.server_.put(l.toString(),a,(r=>{Ls(t,"transaction put response",{path:l.toString(),status:r});let i=[];if("ok"===r){const r=[];for(let e=0;e<n.length;e++)n[e].status=2,i=i.concat(zo(t.serverSyncTree_,n[e].currentWriteId)),n[e].onComplete&&r.push((()=>n[e].onComplete(null,!0,n[e].currentOutputSnapshotResolved))),n[e].unwatcher();Us(t,os(t.transactionQueueTree_,e)),$s(t,t.transactionQueueTree_),xs(t.eventQueue_,e,i);for(let t=0;t<r.length;t++)Jn(r[t])}else{if("datastale"===r)for(let t=0;t<n.length;t++)3===n[t].status?n[t].status=4:n[t].status=0;else{qn("transaction at "+l.toString()+" failed: "+r);for(let t=0;t<n.length;t++)n[t].status=4,n[t].abortReason=r}qs(t,e)}}),s)}(t,hs(e),n)}else ls(e)&&cs(e,(e=>{$s(t,e)}))}function qs(t,e){const n=js(t,e),r=hs(n);return function(t,e,n){if(0===e.length)return;const r=[];let i=[];const o=e.filter((t=>0===t.status)).map((t=>t.currentWriteId));for(let a=0;a<e.length;a++){const l=e[a],c=Ar(n,l.path);let u,h=!1;if(Zt(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)h=!0,u=l.abortReason,i=i.concat(zo(t.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=25)h=!0,u="maxretry",i=i.concat(zo(t.serverSyncTree_,l.currentWriteId,!0));else{const n=Fs(t,l.path,o);l.currentInputSnapshot=n;const r=e[a].update(n.val());if(void 0!==r){vs("transaction failed: Data returned ",r,l.path);let e=_i(r);"object"==typeof r&&null!=r&&_e(r,".priority")||(e=e.updatePriority(n.getPriority()));const s=l.currentWriteId,a=Ts(t),c=ns(e,n,a);l.currentOutputSnapshotRaw=e,l.currentOutputSnapshotResolved=c,l.currentWriteId=As(t),o.splice(o.indexOf(s),1),i=i.concat(jo(t.serverSyncTree_,l.path,c,l.currentWriteId,l.applyLocally)),i=i.concat(zo(t.serverSyncTree_,s,!0))}else h=!0,u="nodata",i=i.concat(zo(t.serverSyncTree_,l.currentWriteId,!0))}xs(t.eventQueue_,n,i),i=[],h&&(e[a].status=2,s=e[a].unwatcher,setTimeout(s,Math.floor(0)),e[a].onComplete&&("nodata"===u?r.push((()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot))):r.push((()=>e[a].onComplete(new Error(u),!1,null)))))}var s;Us(t,t.transactionQueueTree_);for(let t=0;t<r.length;t++)Jn(r[t]);$s(t,t.transactionQueueTree_)}(t,zs(t,n),r),r}function js(t,e){let n,r=t.transactionQueueTree_;for(n=Er(e);null!==n&&void 0===ss(r);)r=os(r,n),n=Er(e=Sr(e));return r}function zs(t,e){const n=[];return Bs(t,e,n),n.sort(((t,e)=>t.order-e.order)),n}function Bs(t,e,n){const r=ss(e);if(r)for(let t=0;t<r.length;t++)n.push(r[t]);cs(e,(e=>{Bs(t,e,n)}))}function Us(t,e){const n=ss(e);if(n){let t=0;for(let e=0;e<n.length;e++)2!==n[e].status&&(n[t]=n[e],t++);n.length=t,as(e,n.length>0?n:void 0)}cs(e,(e=>{Us(t,e)}))}function Ws(t,e){const n=hs(js(t,e)),r=os(t.transactionQueueTree_,e);return function(t,e,n){let r=n?t:t.parent;for(;null!==r;){if(e(r))return!0;r=r.parent}}(r,(e=>{Hs(t,e)})),Hs(t,r),us(r,(e=>{Hs(t,e)})),n}function Hs(t,e){const n=ss(e);if(n){const r=[];let i=[],o=-1;for(let e=0;e<n.length;e++)3===n[e].status||(1===n[e].status?(Zt(o===e-1,"All SENT items should be at beginning of queue."),o=e,n[e].status=3,n[e].abortReason="set"):(Zt(0===n[e].status,"Unexpected transaction status in abort"),n[e].unwatcher(),i=i.concat(zo(t.serverSyncTree_,n[e].currentWriteId,!0)),n[e].onComplete&&r.push(n[e].onComplete.bind(null,new Error("set"),!1,null))));-1===o?as(e,void 0):n.length=o+1,xs(t.eventQueue_,hs(e),i);for(let t=0;t<r.length;t++)Jn(r[t])}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Vs=function(t,e){const n=Gs(t),r=n.namespace;"firebase.com"===n.domain&&$n(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||$n("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&qn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new sr(n.host,n.secure,r,e,i,"",r!==n.subdomain),path:new xr(n.pathString)}},Gs=function(t){let e="",n="",r="",i="",o="",s=!0,a="https",l=443;if("string"==typeof t){let c=t.indexOf("//");c>=0&&(a=t.substring(0,c-1),t=t.substring(c+2));let u=t.indexOf("/");-1===u&&(u=t.length);let h=t.indexOf("?");-1===h&&(h=t.length),e=t.substring(0,Math.min(u,h)),u<h&&(i=function(t){let e="";const n=t.split("/");for(let t=0;t<n.length;t++)if(n[t].length>0){let r=n[t];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch(t){}e+="/"+r}return e}(t.substring(u,h)));const d=function(t){const e={};"?"===t.charAt(0)&&(t=t.substring(1));for(const n of t.split("&")){if(0===n.length)continue;const r=n.split("=");2===r.length?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):qn(`Invalid query segment '${n}' in query '${t}'`)}return e}(t.substring(Math.min(t.length,h)));c=e.indexOf(":"),c>=0?(s="https"===a||"wss"===a,l=parseInt(e.substring(c+1),10)):c=e.length;const f=e.slice(0,c);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{const t=e.indexOf(".");r=e.substring(0,t).toLowerCase(),n=e.substring(t+1),o=r}"ns"in d&&(o=d.ns)}return{host:e,port:l,domain:n,subdomain:r,secure:s,scheme:a,pathString:i,namespace:o}};
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Ys{constructor(t,e,n,r){this._repo=t,this._path=e,this._queryParams=n,this._orderByCalled=r}get key(){return Mr(this._path)?null:Nr(this._path)}get ref(){return new Ks(this._repo,this._path)}get _queryIdentifier(){const t=Ii(this._queryParams),e=Vn(t);return"{}"===e?"default":e}get _queryObject(){return Ii(this._queryParams)}isEqual(t){if(!((t=ke(t))instanceof Ys))return!1;const e=this._repo===t._repo,n=Or(this._path,t._path),r=this._queryIdentifier===t._queryIdentifier;return e&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)""!==t.pieces_[n]&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}(this._path)}}class Ks extends Ys{constructor(t,e){super(t,e,new ki,!1)}get parent(){const t=Rr(this._path);return null===t?null:new Ks(this._repo,t)}get root(){let t=this;for(;null!==t.parent;)t=t.parent;return t}}class Xs{constructor(t,e,n){this._node=t,this.ref=e,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(t){const e=new xr(t),n=Js(this.ref,t);return new Xs(this._node.getChild(e),n,oi)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(t){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,((e,n)=>t(new Xs(n,Js(this.ref,e),oi))))}hasChild(t){const e=new xr(t);return!this._node.getChild(e).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Qs(t,e){return(t=ke(t))._checkNotDeleted("ref"),void 0!==e?Js(t._root,e):t._root}function Js(t,e){var n,r,i,o;return null===Er((t=ke(t))._path)?(n="child",r="path",o=!1,(i=e)&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),ys(n,r,i,o)):ys("child","path",e,!1),new Ks(t._repo,Pr(t._path,e))}function Zs(t,e){(function(t,e){if(".info"===Er(e))throw new Error(t+" failed = Can't modify data under /.info/")})("set",(t=ke(t))._path),function(t,e,n,r){r&&void 0===e||vs(Ce(t,"value"),e,n)}("set",e,t._path,!1);const n=new se;return Ds(t._repo,t._path,e,null,n.wrapCallback((()=>{}))),n.promise}!function(t){Zt(!Oo,"__referenceConstructor has already been defined"),Oo=t}(Ks),function(t){Zt(!Do,"__referenceConstructor has already been defined"),Do=t}(Ks);
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const ta={};function ea(t,e,n,r,i){let o=r||t.options.databaseURL;void 0===o&&(t.options.projectId||$n("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Dn("Using default host for project ",t.options.projectId),o=`${t.options.projectId}-default-rtdb.firebaseio.com`);let s,a,l=Vs(o,i),c=l.repoInfo;"undefined"!=typeof process&&(a=process.env.FIREBASE_DATABASE_EMULATOR_HOST),a?(s=!0,o=`http://${a}?ns=${c.namespace}`,l=Vs(o,i),c=l.repoInfo):s=!l.repoInfo.secure;const u=i&&s?new nr(nr.OWNER):new er(t.name,t.options,e);ws("Invalid Firebase Database URL",l),Mr(l.path)||$n("Database URL must point to the root of a Firebase Database (not including a child path).");const h=function(t,e,n,r){let i=ta[e.name];i||(i={},ta[e.name]=i);let o=i[t.toURLString()];o&&$n("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return o=new Is(t,false,n,r),i[t.toURLString()]=o,o}(c,t,u,new tr(t.name,n));return new na(h,t)}class na{constructor(t,e){this._repoInternal=t,this.app=e,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Ss(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ks(this._repo,kr())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(t,e){const n=ta[e];n&&n[t.key]===t||$n(`Database ${e}(${t.repoInfo_}) has already been deleted.`),function(t){t.persistentConnection_&&t.persistentConnection_.interrupt("repo_interrupt")}(t),delete n[t.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){null===this._rootInternal&&$n("Cannot call "+t+" on a deleted database.")}}zr.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},zr.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)},
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function(t){!function(t){xn=t}(Ye),We(new Ee("database",((t,{instanceIdentifier:e})=>ea(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"),t.getProvider("app-check-internal"),e)),"PUBLIC").setMultipleInstances(!0)),Xe(bn,Cn,t),Xe(bn,Cn,"esm2017")}();const ra=function(t,e={}){if("object"!=typeof e){e={name:e}}const n=Object.assign({name:qe,automaticDataCollectionEnabled:!1},e),r=n.name;if("string"!=typeof r||!r)throw Ve.create("bad-app-name",{appName:String(r)});const i=ze.get(r);if(i){if(ye(t,i.options)&&ye(n,i.config))return i;throw Ve.create("duplicate-app",{appName:r})}const o=new Te(r);for(const t of Be.values())o.addComponent(t);const s=new Ge(t,n,o);return ze.set(r,s),s}({apiKey:"AIzaSyCFE8TqTBWCDSBee0CuT9HXLnNNRtSA4S8",authDomain:"eye-tracking-8adeb.firebaseapp.com",databaseURL:"https://eye-tracking-8adeb-default-rtdb.firebaseio.com",projectId:"eye-tracking-8adeb",storageBucket:"eye-tracking-8adeb.appspot.com",messagingSenderId:"214459503975",appId:"1:214459503975:web:ff62018ff95cb21cfe8bc2",measurementId:"G-55T3T75PPR"}),ia=function(t=Ke(),e){return He(t,"database").getImmediate({identifier:e})}(ra);async function oa(t){try{let n=await(e=Js(Qs(ia),t),Os((e=ke(e))._repo,e).then((t=>new Xs(t,new Ks(e._repo,e._path),e._queryParams.getIndex()))));return n.exists()?n.val():null}catch(t){console.error(t)}var e}async function sa(t,e){try{return await Zs(Qs(ia,t),e),"db write done"}catch(t){console.error(t)}}function aa(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function la(t){let e=t,n=t,r=t;function i(t,e,i=0,o=t.length){if(i<o){if(0!==n(e,e))return o;do{const n=i+o>>>1;r(t[n],e)<0?i=n+1:o=n}while(i<o)}return i}return 2!==t.length&&(e=(e,n)=>t(e)-n,n=aa,r=(e,n)=>aa(t(e),n)),{left:i,center:function(t,n,r=0,o=t.length){const s=i(t,n,r,o-1);return s>r&&e(t[s-1],n)>-e(t[s],n)?s-1:s},right:function(t,e,i=0,o=t.length){if(i<o){if(0!==n(e,e))return o;do{const n=i+o>>>1;r(t[n],e)<=0?i=n+1:o=n}while(i<o)}return i}}}!function(t=Ke(),e){He(t=ke(t),yn).getImmediate({identifier:e})}(ra);const ca=la(aa).right;la((function(t){return null===t?NaN:+t})).center;var ua=ca;class ha{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const e=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const i=e[r],o=t+i,s=Math.abs(t)<Math.abs(i)?t-(o-i):i-(o-t);s&&(e[n++]=s),t=o}return e[n]=t,this._n=n+1,this}valueOf(){const t=this._partials;let e,n,r,i=this._n,o=0;if(i>0){for(o=t[--i];i>0&&(e=o,n=t[--i],o=e+n,r=n-(o-e),!r););i>0&&(r<0&&t[i-1]<0||r>0&&t[i-1]>0)&&(n=2*r,e=o+n,n==e-o&&(o=e))}return o}}var da=Math.sqrt(50),fa=Math.sqrt(10),pa=Math.sqrt(2);function _a(t,e,n){var r,i,o,s,a=-1;if(n=+n,(t=+t)===(e=+e)&&n>0)return[t];if((r=e<t)&&(i=t,t=e,e=i),0===(s=ga(t,e,n))||!isFinite(s))return[];if(s>0){let n=Math.round(t/s),r=Math.round(e/s);for(n*s<t&&++n,r*s>e&&--r,o=new Array(i=r-n+1);++a<i;)o[a]=(n+a)*s}else{s=-s;let n=Math.round(t*s),r=Math.round(e*s);for(n/s<t&&++n,r/s>e&&--r,o=new Array(i=r-n+1);++a<i;)o[a]=(n+a)/s}return r&&o.reverse(),o}function ga(t,e,n){var r=(e-t)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=da?10:o>=fa?5:o>=pa?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=da?10:o>=fa?5:o>=pa?2:1)}function ma(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=da?i*=10:o>=fa?i*=5:o>=pa&&(i*=2),e<t?-i:i}function va(t){return Math.ceil(Math.log(function(t,e){let n=0;if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&++n;else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(i=+i)>=i&&++n}return n}(t))/Math.LN2)+1}function ya(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n<e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}var wa={value:()=>{}};function ba(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new Ca(r)}function Ca(t){this._=t}function xa(t,e){return t.trim().split(/^|\s+/).map((function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))}function ka(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function Ea(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=wa,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}Ca.prototype=ba.prototype={constructor:Ca,on:function(t,e){var n,r=this._,i=xa(t+"",r),o=-1,s=i.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<s;)if(n=(t=i[o]).type)r[n]=Ea(r[n],t.name,e);else if(null==e)for(n in r)r[n]=Ea(r[n],t.name,null);return this}for(;++o<s;)if((n=(t=i[o]).type)&&(n=ka(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Ca(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(r=this._[t]).length;o<n;++o)r[o].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};var Ia="http://www.w3.org/1999/xhtml",Sa={svg:"http://www.w3.org/2000/svg",xhtml:Ia,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Na(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),Sa.hasOwnProperty(e)?{space:Sa[e],local:t}:t}function Ta(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Ia&&e.documentElement.namespaceURI===Ia?e.createElement(t):e.createElementNS(n,t)}}function Ra(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Pa(t){var e=Na(t);return(e.local?Ra:Ta)(e)}function Ma(){}function Aa(t){return null==t?Ma:function(){return this.querySelector(t)}}function Oa(t){return null==t?[]:Array.isArray(t)?t:Array.from(t)}function Da(){return[]}function La(t){return null==t?Da:function(){return this.querySelectorAll(t)}}function Fa(t){return function(){return this.matches(t)}}function $a(t){return function(e){return e.matches(t)}}var qa=Array.prototype.find;function ja(){return this.firstElementChild}var za=Array.prototype.filter;function Ba(){return Array.from(this.children)}function Ua(t){return new Array(t.length)}function Wa(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function Ha(t){return function(){return t}}function Va(t,e,n,r,i,o){for(var s,a=0,l=e.length,c=o.length;a<c;++a)(s=e[a])?(s.__data__=o[a],r[a]=s):n[a]=new Wa(t,o[a]);for(;a<l;++a)(s=e[a])&&(i[a]=s)}function Ga(t,e,n,r,i,o,s){var a,l,c,u=new Map,h=e.length,d=o.length,f=new Array(h);for(a=0;a<h;++a)(l=e[a])&&(f[a]=c=s.call(l,l.__data__,a,e)+"",u.has(c)?i[a]=l:u.set(c,l));for(a=0;a<d;++a)c=s.call(t,o[a],a,o)+"",(l=u.get(c))?(r[a]=l,l.__data__=o[a],u.delete(c)):n[a]=new Wa(t,o[a]);for(a=0;a<h;++a)(l=e[a])&&u.get(f[a])===l&&(i[a]=l)}function Ya(t){return t.__data__}function Ka(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function Xa(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Qa(t){return function(){this.removeAttribute(t)}}function Ja(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Za(t,e){return function(){this.setAttribute(t,e)}}function tl(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function el(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function nl(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function rl(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function il(t){return function(){this.style.removeProperty(t)}}function ol(t,e,n){return function(){this.style.setProperty(t,e,n)}}function sl(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function al(t,e){return t.style.getPropertyValue(e)||rl(t).getComputedStyle(t,null).getPropertyValue(e)}function ll(t){return function(){delete this[t]}}function cl(t,e){return function(){this[t]=e}}function ul(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function hl(t){return t.trim().split(/^|\s+/)}function dl(t){return t.classList||new fl(t)}function fl(t){this._node=t,this._names=hl(t.getAttribute("class")||"")}function pl(t,e){for(var n=dl(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function _l(t,e){for(var n=dl(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function gl(t){return function(){pl(this,t)}}function ml(t){return function(){_l(this,t)}}function vl(t,e){return function(){(e.apply(this,arguments)?pl:_l)(this,t)}}function yl(){this.textContent=""}function wl(t){return function(){this.textContent=t}}function bl(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function Cl(){this.innerHTML=""}function xl(t){return function(){this.innerHTML=t}}function kl(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function El(){this.nextSibling&&this.parentNode.appendChild(this)}function Il(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Sl(){return null}function Nl(){var t=this.parentNode;t&&t.removeChild(this)}function Tl(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Rl(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Pl(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function Ml(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,o=e.length;r<o;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?e.length=i:delete this.__on}}}function Al(t,e,n){return function(){var r,i=this.__on,o=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(i)for(var s=0,a=i.length;s<a;++s)if((r=i[s]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=n),void(r.value=e);this.addEventListener(t.type,o,n),r={type:t.type,name:t.name,value:e,listener:o,options:n},i?i.push(r):this.__on=[r]}}function Ol(t,e,n){var r=rl(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function Dl(t,e){return function(){return Ol(this,t,e)}}function Ll(t,e){return function(){return Ol(this,t,e.apply(this,arguments))}}Wa.prototype={constructor:Wa,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},fl.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var Fl=[null];function $l(t,e){this._groups=t,this._parents=e}function ql(){return new $l([[document.documentElement]],Fl)}function jl(t){return"string"==typeof t?new $l([[document.querySelector(t)]],[document.documentElement]):new $l([[t]],Fl)}function zl(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Bl(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Ul(){}$l.prototype=ql.prototype={constructor:$l,select:function(t){"function"!=typeof t&&(t=Aa(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,s,a=e[i],l=a.length,c=r[i]=new Array(l),u=0;u<l;++u)(o=a[u])&&(s=t.call(o,o.__data__,u,a))&&("__data__"in o&&(s.__data__=o.__data__),c[u]=s);return new $l(r,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return Oa(t.apply(this,arguments))}}(t):La(t);for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var s,a=e[o],l=a.length,c=0;c<l;++c)(s=a[c])&&(r.push(t.call(s,s.__data__,c,a)),i.push(s));return new $l(r,i)},selectChild:function(t){return this.select(null==t?ja:function(t){return function(){return qa.call(this.children,t)}}("function"==typeof t?t:$a(t)))},selectChildren:function(t){return this.selectAll(null==t?Ba:function(t){return function(){return za.call(this.children,t)}}("function"==typeof t?t:$a(t)))},filter:function(t){"function"!=typeof t&&(t=Fa(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,s=e[i],a=s.length,l=r[i]=[],c=0;c<a;++c)(o=s[c])&&t.call(o,o.__data__,c,s)&&l.push(o);return new $l(r,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,Ya);var n=e?Ga:Va,r=this._parents,i=this._groups;"function"!=typeof t&&(t=Ha(t));for(var o=i.length,s=new Array(o),a=new Array(o),l=new Array(o),c=0;c<o;++c){var u=r[c],h=i[c],d=h.length,f=Ka(t.call(u,u&&u.__data__,c,r)),p=f.length,_=a[c]=new Array(p),g=s[c]=new Array(p),m=l[c]=new Array(d);n(u,h,_,g,m,f,e);for(var v,y,w=0,b=0;w<p;++w)if(v=_[w]){for(w>=b&&(b=w+1);!(y=g[b])&&++b<p;);v._next=y||null}}return(s=new $l(s,r))._enter=a,s._exit=l,s},enter:function(){return new $l(this._enter||this._groups.map(Ua),this._parents)},exit:function(){return new $l(this._exit||this._groups.map(Ua),this._parents)},join:function(t,e,n){var r=this.enter(),i=this,o=this.exit();return"function"==typeof t?(r=t(r))&&(r=r.selection()):r=r.append(t+""),null!=e&&(i=e(i))&&(i=i.selection()),null==n?o.remove():n(o),r&&i?r.merge(i).order():i},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,o=r.length,s=Math.min(i,o),a=new Array(i),l=0;l<s;++l)for(var c,u=n[l],h=r[l],d=u.length,f=a[l]=new Array(d),p=0;p<d;++p)(c=u[p]||h[p])&&(f[p]=c);for(;l<i;++l)a[l]=n[l];return new $l(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],o=i.length-1,s=i[o];--o>=0;)(r=i[o])&&(s&&4^r.compareDocumentPosition(s)&&s.parentNode.insertBefore(r,s),s=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=Xa);for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var s,a=n[o],l=a.length,c=i[o]=new Array(l),u=0;u<l;++u)(s=a[u])&&(c[u]=s);c.sort(e)}return new $l(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var s=r[i];if(s)return s}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,o=e[n],s=0,a=o.length;s<a;++s)(i=o[s])&&t.call(i,i.__data__,s,o);return this},attr:function(t,e){var n=Na(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?Ja:Qa:"function"==typeof e?n.local?nl:el:n.local?tl:Za)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?il:"function"==typeof e?sl:ol)(t,e,null==n?"":n)):al(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?ll:"function"==typeof e?ul:cl)(t,e)):this.node()[t]},classed:function(t,e){var n=hl(t+"");if(arguments.length<2){for(var r=dl(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?vl:e?gl:ml)(n,e))},text:function(t){return arguments.length?this.each(null==t?yl:("function"==typeof t?bl:wl)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?Cl:("function"==typeof t?kl:xl)(t)):this.node().innerHTML},raise:function(){return this.each(El)},lower:function(){return this.each(Il)},append:function(t){var e="function"==typeof t?t:Pa(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:Pa(t),r=null==e?Sl:"function"==typeof e?e:Aa(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(Nl)},clone:function(t){return this.select(t?Rl:Tl)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,o=Pl(t+""),s=o.length;if(!(arguments.length<2)){for(a=e?Al:Ml,r=0;r<s;++r)this.each(a(o[r],e,n));return this}var a=this.node().__on;if(a)for(var l,c=0,u=a.length;c<u;++c)for(r=0,l=a[c];r<s;++r)if((i=o[r]).type===l.type&&i.name===l.name)return l.value},dispatch:function(t,e){return this.each(("function"==typeof e?Ll:Dl)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r,i=t[e],o=0,s=i.length;o<s;++o)(r=i[o])&&(yield r)}};var Wl=.7,Hl=1/Wl,Vl="\\s*([+-]?\\d+)\\s*",Gl="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Yl="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Kl=/^#([0-9a-f]{3,8})$/,Xl=new RegExp("^rgb\\("+[Vl,Vl,Vl]+"\\)$"),Ql=new RegExp("^rgb\\("+[Yl,Yl,Yl]+"\\)$"),Jl=new RegExp("^rgba\\("+[Vl,Vl,Vl,Gl]+"\\)$"),Zl=new RegExp("^rgba\\("+[Yl,Yl,Yl,Gl]+"\\)$"),tc=new RegExp("^hsl\\("+[Gl,Yl,Yl]+"\\)$"),ec=new RegExp("^hsla\\("+[Gl,Yl,Yl,Gl]+"\\)$"),nc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function rc(){return this.rgb().formatHex()}function ic(){return this.rgb().formatRgb()}function oc(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Kl.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?sc(e):3===n?new uc(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?ac(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?ac(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Xl.exec(t))?new uc(e[1],e[2],e[3],1):(e=Ql.exec(t))?new uc(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Jl.exec(t))?ac(e[1],e[2],e[3],e[4]):(e=Zl.exec(t))?ac(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=tc.exec(t))?pc(e[1],e[2]/100,e[3]/100,1):(e=ec.exec(t))?pc(e[1],e[2]/100,e[3]/100,e[4]):nc.hasOwnProperty(t)?sc(nc[t]):"transparent"===t?new uc(NaN,NaN,NaN,0):null}function sc(t){return new uc(t>>16&255,t>>8&255,255&t,1)}function ac(t,e,n,r){return r<=0&&(t=e=n=NaN),new uc(t,e,n,r)}function lc(t){return t instanceof Ul||(t=oc(t)),t?new uc((t=t.rgb()).r,t.g,t.b,t.opacity):new uc}function cc(t,e,n,r){return 1===arguments.length?lc(t):new uc(t,e,n,null==r?1:r)}function uc(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function hc(){return"#"+fc(this.r)+fc(this.g)+fc(this.b)}function dc(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function fc(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function pc(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new gc(t,e,n,r)}function _c(t){if(t instanceof gc)return new gc(t.h,t.s,t.l,t.opacity);if(t instanceof Ul||(t=oc(t)),!t)return new gc;if(t instanceof gc)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),s=NaN,a=o-i,l=(o+i)/2;return a?(s=e===o?(n-r)/a+6*(n<r):n===o?(r-e)/a+2:(e-n)/a+4,a/=l<.5?o+i:2-o-i,s*=60):a=l>0&&l<1?0:s,new gc(s,a,l,t.opacity)}function gc(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function mc(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}zl(Ul,oc,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:rc,formatHex:rc,formatHsl:function(){return _c(this).formatHsl()},formatRgb:ic,toString:ic}),zl(uc,cc,Bl(Ul,{brighter:function(t){return t=null==t?Hl:Math.pow(Hl,t),new uc(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?Wl:Math.pow(Wl,t),new uc(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:hc,formatHex:hc,formatRgb:dc,toString:dc})),zl(gc,(function(t,e,n,r){return 1===arguments.length?_c(t):new gc(t,e,n,null==r?1:r)}),Bl(Ul,{brighter:function(t){return t=null==t?Hl:Math.pow(Hl,t),new gc(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?Wl:Math.pow(Wl,t),new gc(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new uc(mc(t>=240?t-240:t+120,i,r),mc(t,i,r),mc(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var vc=t=>()=>t;function yc(t){return 1==(t=+t)?wc:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):vc(isNaN(e)?n:e)}}function wc(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):vc(isNaN(t)?e:t)}var bc=function t(e){var n=yc(e);function r(t,e){var r=n((t=cc(t)).r,(e=cc(e)).r),i=n(t.g,e.g),o=n(t.b,e.b),s=wc(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=o(e),t.opacity=s(e),t+""}}return r.gamma=t,r}(1);function Cc(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,i=e.slice();return function(o){for(n=0;n<r;++n)i[n]=t[n]*(1-o)+e[n]*o;return i}}function xc(t,e){var n,r=e?e.length:0,i=t?Math.min(r,t.length):0,o=new Array(i),s=new Array(r);for(n=0;n<i;++n)o[n]=Rc(t[n],e[n]);for(;n<r;++n)s[n]=e[n];return function(t){for(n=0;n<i;++n)s[n]=o[n](t);return s}}function kc(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Ec(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Ic(t,e){var n,r={},i={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=Rc(t[n],e[n]):i[n]=e[n];return function(t){for(n in r)i[n]=r[n](t);return i}}var Sc=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Nc=new RegExp(Sc.source,"g");function Tc(t,e){var n,r,i,o=Sc.lastIndex=Nc.lastIndex=0,s=-1,a=[],l=[];for(t+="",e+="";(n=Sc.exec(t))&&(r=Nc.exec(e));)(i=r.index)>o&&(i=e.slice(o,i),a[s]?a[s]+=i:a[++s]=i),(n=n[0])===(r=r[0])?a[s]?a[s]+=r:a[++s]=r:(a[++s]=null,l.push({i:s,x:Ec(n,r)})),o=Nc.lastIndex;return o<e.length&&(i=e.slice(o),a[s]?a[s]+=i:a[++s]=i),a.length<2?l[0]?function(t){return function(e){return t(e)+""}}(l[0].x):function(t){return function(){return t}}(e):(e=l.length,function(t){for(var n,r=0;r<e;++r)a[(n=l[r]).i]=n.x(t);return a.join("")})}function Rc(t,e){var n,r,i=typeof e;return null==e||"boolean"===i?vc(e):("number"===i?Ec:"string"===i?(n=oc(e))?(e=n,bc):Tc:e instanceof oc?bc:e instanceof Date?kc:(r=e,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(e)?xc:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?Ic:Ec:Cc))(t,e)}function Pc(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var Mc,Ac=180/Math.PI,Oc={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Dc(t,e,n,r,i,o){var s,a,l;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(l=t*n+e*r)&&(n-=t*l,r-=e*l),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,l/=a),t*r<e*n&&(t=-t,e=-e,l=-l,s=-s),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*Ac,skewX:Math.atan(l)*Ac,scaleX:s,scaleY:a}}function Lc(t,e,n,r){function i(t){return t.length?t.pop()+" ":""}return function(o,s){var a=[],l=[];return o=t(o),s=t(s),function(t,r,i,o,s,a){if(t!==i||r!==o){var l=s.push("translate(",null,e,null,n);a.push({i:l-4,x:Ec(t,i)},{i:l-2,x:Ec(r,o)})}else(i||o)&&s.push("translate("+i+e+o+n)}(o.translateX,o.translateY,s.translateX,s.translateY,a,l),function(t,e,n,o){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),o.push({i:n.push(i(n)+"rotate(",null,r)-2,x:Ec(t,e)})):e&&n.push(i(n)+"rotate("+e+r)}(o.rotate,s.rotate,a,l),function(t,e,n,o){t!==e?o.push({i:n.push(i(n)+"skewX(",null,r)-2,x:Ec(t,e)}):e&&n.push(i(n)+"skewX("+e+r)}(o.skewX,s.skewX,a,l),function(t,e,n,r,o,s){if(t!==n||e!==r){var a=o.push(i(o)+"scale(",null,",",null,")");s.push({i:a-4,x:Ec(t,n)},{i:a-2,x:Ec(e,r)})}else 1===n&&1===r||o.push(i(o)+"scale("+n+","+r+")")}(o.scaleX,o.scaleY,s.scaleX,s.scaleY,a,l),o=s=null,function(t){for(var e,n=-1,r=l.length;++n<r;)a[(e=l[n]).i]=e.x(t);return a.join("")}}}var Fc,$c,qc=Lc((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Oc:Dc(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),jc=Lc((function(t){return null==t?Oc:(Mc||(Mc=document.createElementNS("http://www.w3.org/2000/svg","g")),Mc.setAttribute("transform",t),(t=Mc.transform.baseVal.consolidate())?Dc((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):Oc)}),", ",")",")"),zc=0,Bc=0,Uc=0,Wc=0,Hc=0,Vc=0,Gc="object"==typeof performance&&performance.now?performance:Date,Yc="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Kc(){return Hc||(Yc(Xc),Hc=Gc.now()+Vc)}function Xc(){Hc=0}function Qc(){this._call=this._time=this._next=null}function Jc(t,e,n){var r=new Qc;return r.restart(t,e,n),r}function Zc(){Hc=(Wc=Gc.now())+Vc,zc=Bc=0;try{!function(){Kc(),++zc;for(var t,e=Fc;e;)(t=Hc-e._time)>=0&&e._call.call(void 0,t),e=e._next;--zc}()}finally{zc=0,function(){var t,e,n=Fc,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:Fc=e);$c=t,eu(r)}(),Hc=0}}function tu(){var t=Gc.now(),e=t-Wc;e>1e3&&(Vc-=e,Wc=t)}function eu(t){zc||(Bc&&(Bc=clearTimeout(Bc)),t-Hc>24?(t<1/0&&(Bc=setTimeout(Zc,t-Gc.now()-Vc)),Uc&&(Uc=clearInterval(Uc))):(Uc||(Wc=Gc.now(),Uc=setInterval(tu,1e3)),zc=1,Yc(Zc)))}function nu(t,e,n){var r=new Qc;return e=null==e?0:+e,r.restart((n=>{r.stop(),t(n+e)}),e,n),r}Qc.prototype=Jc.prototype={constructor:Qc,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?Kc():+n)+(null==e?0:+e),this._next||$c===this||($c?$c._next=this:Fc=this,$c=this),this._call=t,this._time=n,eu()},stop:function(){this._call&&(this._call=null,this._time=1/0,eu())}};var ru=ba("start","end","cancel","interrupt"),iu=[];function ou(t,e,n,r,i,o){var s=t.__transition;if(s){if(n in s)return}else t.__transition={};!function(t,e,n){var r,i=t.__transition;function o(t){n.state=1,n.timer.restart(s,n.delay,n.time),n.delay<=t&&s(t-n.delay)}function s(o){var c,u,h,d;if(1!==n.state)return l();for(c in i)if((d=i[c]).name===n.name){if(3===d.state)return nu(s);4===d.state?(d.state=6,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete i[c]):+c<e&&(d.state=6,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete i[c])}if(nu((function(){3===n.state&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(o))})),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(h=n.tween.length),c=0,u=-1;c<h;++c)(d=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(r[++u]=d);r.length=u+1}}function a(e){for(var i=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(l),n.state=5,1),o=-1,s=r.length;++o<s;)r[o].call(t,i);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),l())}function l(){for(var r in n.state=6,n.timer.stop(),delete i[e],i)return;delete t.__transition}i[e]=n,n.timer=Jc(o,0,n.time)}(t,n,{name:e,index:r,group:i,on:ru,tween:iu,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:0})}function su(t,e){var n=lu(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function au(t,e){var n=lu(t,e);if(n.state>3)throw new Error("too late; already running");return n}function lu(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function cu(t,e){var n,r;return function(){var i=au(this,t),o=i.tween;if(o!==n)for(var s=0,a=(r=n=o).length;s<a;++s)if(r[s].name===e){(r=r.slice()).splice(s,1);break}i.tween=r}}function uu(t,e,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var o=au(this,t),s=o.tween;if(s!==r){i=(r=s).slice();for(var a={name:e,value:n},l=0,c=i.length;l<c;++l)if(i[l].name===e){i[l]=a;break}l===c&&i.push(a)}o.tween=i}}function hu(t,e,n){var r=t._id;return t.each((function(){var t=au(this,r);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return lu(t,r).value[e]}}function du(t,e){var n;return("number"==typeof e?Ec:e instanceof oc?bc:(n=oc(e))?(e=n,bc):Tc)(t,e)}function fu(t){return function(){this.removeAttribute(t)}}function pu(t){return function(){this.removeAttributeNS(t.space,t.local)}}function _u(t,e,n){var r,i,o=n+"";return function(){var s=this.getAttribute(t);return s===o?null:s===r?i:i=e(r=s,n)}}function gu(t,e,n){var r,i,o=n+"";return function(){var s=this.getAttributeNS(t.space,t.local);return s===o?null:s===r?i:i=e(r=s,n)}}function mu(t,e,n){var r,i,o;return function(){var s,a,l=n(this);if(null!=l)return(s=this.getAttribute(t))===(a=l+"")?null:s===r&&a===i?o:(i=a,o=e(r=s,l));this.removeAttribute(t)}}function vu(t,e,n){var r,i,o;return function(){var s,a,l=n(this);if(null!=l)return(s=this.getAttributeNS(t.space,t.local))===(a=l+"")?null:s===r&&a===i?o:(i=a,o=e(r=s,l));this.removeAttributeNS(t.space,t.local)}}function yu(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function wu(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function bu(t,e){var n,r;function i(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&wu(t,i)),n}return i._value=e,i}function Cu(t,e){var n,r;function i(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&yu(t,i)),n}return i._value=e,i}function xu(t,e){return function(){su(this,t).delay=+e.apply(this,arguments)}}function ku(t,e){return e=+e,function(){su(this,t).delay=e}}function Eu(t,e){return function(){au(this,t).duration=+e.apply(this,arguments)}}function Iu(t,e){return e=+e,function(){au(this,t).duration=e}}function Su(t,e){if("function"!=typeof e)throw new Error;return function(){au(this,t).ease=e}}function Nu(t,e,n){var r,i,o=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?su:au;return function(){var s=o(this,t),a=s.on;a!==r&&(i=(r=a).copy()).on(e,n),s.on=i}}var Tu=ql.prototype.constructor;function Ru(t){return function(){this.style.removeProperty(t)}}function Pu(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function Mu(t,e,n){var r,i;function o(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&Pu(t,o,n)),r}return o._value=e,o}function Au(t){return function(e){this.textContent=t.call(this,e)}}function Ou(t){var e,n;function r(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&Au(r)),e}return r._value=t,r}var Du=0;function Lu(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Fu(){return++Du}var $u=ql.prototype;Lu.prototype={constructor:Lu,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Aa(t));for(var r=this._groups,i=r.length,o=new Array(i),s=0;s<i;++s)for(var a,l,c=r[s],u=c.length,h=o[s]=new Array(u),d=0;d<u;++d)(a=c[d])&&(l=t.call(a,a.__data__,d,c))&&("__data__"in a&&(l.__data__=a.__data__),h[d]=l,ou(h[d],e,n,d,h,lu(a,n)));return new Lu(o,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=La(t));for(var r=this._groups,i=r.length,o=[],s=[],a=0;a<i;++a)for(var l,c=r[a],u=c.length,h=0;h<u;++h)if(l=c[h]){for(var d,f=t.call(l,l.__data__,h,c),p=lu(l,n),_=0,g=f.length;_<g;++_)(d=f[_])&&ou(d,e,n,_,f,p);o.push(f),s.push(l)}return new Lu(o,s,e,n)},selectChild:$u.selectChild,selectChildren:$u.selectChildren,filter:function(t){"function"!=typeof t&&(t=Fa(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,s=e[i],a=s.length,l=r[i]=[],c=0;c<a;++c)(o=s[c])&&t.call(o,o.__data__,c,s)&&l.push(o);return new Lu(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),s=new Array(r),a=0;a<o;++a)for(var l,c=e[a],u=n[a],h=c.length,d=s[a]=new Array(h),f=0;f<h;++f)(l=c[f]||u[f])&&(d[f]=l);for(;a<r;++a)s[a]=e[a];return new Lu(s,this._parents,this._name,this._id)},selection:function(){return new Tu(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=Fu(),r=this._groups,i=r.length,o=0;o<i;++o)for(var s,a=r[o],l=a.length,c=0;c<l;++c)if(s=a[c]){var u=lu(s,e);ou(s,t,n,c,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Lu(r,this._parents,t,n)},call:$u.call,nodes:$u.nodes,node:$u.node,size:$u.size,empty:$u.empty,each:$u.each,on:function(t,e){var n=this._id;return arguments.length<2?lu(this.node(),n).on.on(t):this.each(Nu(n,t,e))},attr:function(t,e){var n=Na(t),r="transform"===n?jc:du;return this.attrTween(t,"function"==typeof e?(n.local?vu:mu)(n,r,hu(this,"attr."+t,e)):null==e?(n.local?pu:fu)(n):(n.local?gu:_u)(n,r,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var r=Na(t);return this.tween(n,(r.local?bu:Cu)(r,e))},style:function(t,e,n){var r="transform"==(t+="")?qc:du;return null==e?this.styleTween(t,function(t,e){var n,r,i;return function(){var o=al(this,t),s=(this.style.removeProperty(t),al(this,t));return o===s?null:o===n&&s===r?i:i=e(n=o,r=s)}}(t,r)).on("end.style."+t,Ru(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var r,i,o;return function(){var s=al(this,t),a=n(this),l=a+"";return null==a&&(this.style.removeProperty(t),l=a=al(this,t)),s===l?null:s===r&&l===i?o:(i=l,o=e(r=s,a))}}(t,r,hu(this,"style."+t,e))).each(function(t,e){var n,r,i,o,s="style."+e,a="end."+s;return function(){var l=au(this,t),c=l.on,u=null==l.value[s]?o||(o=Ru(e)):void 0;c===n&&i===u||(r=(n=c).copy()).on(a,i=u),l.on=r}}(this._id,t)):this.styleTween(t,function(t,e,n){var r,i,o=n+"";return function(){var s=al(this,t);return s===o?null:s===r?i:i=e(r=s,n)}}(t,r,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;return this.tween(r,Mu(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(hu(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,Ou(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r,i=lu(this.node(),n).tween,o=0,s=i.length;o<s;++o)if((r=i[o]).name===t)return r.value;return null}return this.each((null==e?cu:uu)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?xu:ku)(e,t)):lu(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?Eu:Iu)(e,t)):lu(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(Su(e,t)):lu(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;au(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,r=n._id,i=n.size();return new Promise((function(o,s){var a={value:s},l={value:function(){0==--i&&o()}};n.each((function(){var n=au(this,r),i=n.on;i!==t&&((e=(t=i).copy())._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),n.on=e})),0===i&&o()}))},[Symbol.iterator]:$u[Symbol.iterator]};var qu={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function ju(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}ql.prototype.interrupt=function(t){return this.each((function(){!function(t,e){var n,r,i,o=t.__transition,s=!0;if(o){for(i in e=null==e?null:e+"",o)(n=o[i]).name===e?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete o[i]):s=!1;s&&delete t.__transition}}(this,t)}))},ql.prototype.transition=function(t){var e,n;t instanceof Lu?(e=t._id,t=t._name):(e=Fu(),(n=qu).time=Kc(),t=null==t?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var s,a=r[o],l=a.length,c=0;c<l;++c)(s=a[c])&&ou(s,t,e,c,a,n||ju(s,e));return new Lu(r,this._parents,t,e)};var zu=Array.prototype.slice;function Bu(t,e){return t-e}var Uu=t=>()=>t;function Wu(t,e){for(var n,r=-1,i=e.length;++r<i;)if(n=Hu(t,e[r]))return n;return 0}function Hu(t,e){for(var n=e[0],r=e[1],i=-1,o=0,s=t.length,a=s-1;o<s;a=o++){var l=t[o],c=l[0],u=l[1],h=t[a],d=h[0],f=h[1];if(Vu(l,h,e))return 0;u>r!=f>r&&n<(d-c)*(r-u)/(f-u)+c&&(i=-i)}return i}function Vu(t,e,n){var r,i,o,s;return function(t,e,n){return(e[0]-t[0])*(n[1]-t[1])==(n[0]-t[0])*(e[1]-t[1])}(t,e,n)&&(i=t[r=+(t[0]===e[0])],o=n[r],s=e[r],i<=o&&o<=s||s<=o&&o<=i)}function Gu(){}var Yu=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function Ku(){var t=1,e=1,n=va,r=a;function i(t){var e=n(t);if(Array.isArray(e))e=e.slice().sort(Bu);else{const n=function(t,e){let n,r;if(void 0===e)for(const e of t)null!=e&&(void 0===n?e>=e&&(n=r=e):(n>e&&(n=e),r<e&&(r=e)));else{let i=-1;for(let o of t)null!=(o=e(o,++i,t))&&(void 0===n?o>=o&&(n=r=o):(n>o&&(n=o),r<o&&(r=o)))}return[n,r]}(t),r=ma(n[0],n[1],e);e=_a(Math.floor(n[0]/r)*r,Math.floor(n[1]/r-1)*r,e)}return e.map((e=>o(t,e)))}function o(n,i){var o=[],a=[];return function(n,r,i){var o,a,l,c,u,h,d=new Array,f=new Array;o=a=-1,c=n[0]>=r,Yu[c<<1].forEach(p);for(;++o<t-1;)l=c,c=n[o+1]>=r,Yu[l|c<<1].forEach(p);Yu[c<<0].forEach(p);for(;++a<e-1;){for(o=-1,c=n[a*t+t]>=r,u=n[a*t]>=r,Yu[c<<1|u<<2].forEach(p);++o<t-1;)l=c,c=n[a*t+t+o+1]>=r,h=u,u=n[a*t+o+1]>=r,Yu[l|c<<1|u<<2|h<<3].forEach(p);Yu[c|u<<3].forEach(p)}o=-1,u=n[a*t]>=r,Yu[u<<2].forEach(p);for(;++o<t-1;)h=u,u=n[a*t+o+1]>=r,Yu[u<<2|h<<3].forEach(p);function p(t){var e,n,r=[t[0][0]+o,t[0][1]+a],l=[t[1][0]+o,t[1][1]+a],c=s(r),u=s(l);(e=f[c])?(n=d[u])?(delete f[e.end],delete d[n.start],e===n?(e.ring.push(l),i(e.ring)):d[e.start]=f[n.end]={start:e.start,end:n.end,ring:e.ring.concat(n.ring)}):(delete f[e.end],e.ring.push(l),f[e.end=u]=e):(e=d[u])?(n=f[c])?(delete d[e.start],delete f[n.end],e===n?(e.ring.push(l),i(e.ring)):d[n.start]=f[e.end]={start:n.start,end:e.end,ring:n.ring.concat(e.ring)}):(delete d[e.start],e.ring.unshift(r),d[e.start=c]=e):d[c]=f[u]={start:c,end:u,ring:[r,l]}}Yu[u<<3].forEach(p)}(n,i,(function(t){r(t,n,i),function(t){for(var e=0,n=t.length,r=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++e<n;)r+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return r}(t)>0?o.push([t]):a.push(t)})),a.forEach((function(t){for(var e,n=0,r=o.length;n<r;++n)if(-1!==Wu((e=o[n])[0],t))return void e.push(t)})),{type:"MultiPolygon",value:i,coordinates:o}}function s(e){return 2*e[0]+e[1]*(t+1)*4}function a(n,r,i){n.forEach((function(n){var o,s=n[0],a=n[1],l=0|s,c=0|a,u=r[c*t+l];s>0&&s<t&&l===s&&(o=r[c*t+l-1],n[0]=s+(i-o)/(u-o)-.5),a>0&&a<e&&c===a&&(o=r[(c-1)*t+l],n[1]=a+(i-o)/(u-o)-.5)}))}return i.contour=o,i.size=function(n){if(!arguments.length)return[t,e];var r=Math.floor(n[0]),o=Math.floor(n[1]);if(!(r>=0&&o>=0))throw new Error("invalid size");return t=r,e=o,i},i.thresholds=function(t){return arguments.length?(n="function"==typeof t?t:Array.isArray(t)?Uu(zu.call(t)):Uu(t),i):n},i.smooth=function(t){return arguments.length?(r=t?a:Gu,i):r===a},i}function Xu(t,e,n){for(var r=t.width,i=t.height,o=1+(n<<1),s=0;s<i;++s)for(var a=0,l=0;a<r+n;++a)a<r&&(l+=t.data[a+s*r]),a>=n&&(a>=o&&(l-=t.data[a-o+s*r]),e.data[a-n+s*r]=l/Math.min(a+1,r-1+o-a,o))}function Qu(t,e,n){for(var r=t.width,i=t.height,o=1+(n<<1),s=0;s<r;++s)for(var a=0,l=0;a<i+n;++a)a<i&&(l+=t.data[s+a*r]),a>=n&&(a>=o&&(l-=t.data[s+(a-o)*r]),e.data[s+(a-n)*r]=l/Math.min(a+1,i-1+o-a,o))}function Ju(t){return t[0]}function Zu(t){return t[1]}function th(){return 1}function eh(){var t=Ju,e=Zu,n=th,r=960,i=500,o=20,s=2,a=3*o,l=r+2*a>>s,c=i+2*a>>s,u=Uu(20);function h(r){var i=new Float32Array(l*c),h=new Float32Array(l*c),f=Math.pow(2,-s);r.forEach((function(r,o,s){var u=(t(r,o,s)+a)*f,h=(e(r,o,s)+a)*f,d=+n(r,o,s);if(u>=0&&u<l&&h>=0&&h<c){var p=Math.floor(u),_=Math.floor(h),g=u-p-.5,m=h-_-.5;i[p+_*l]+=(1-g)*(1-m)*d,i[p+1+_*l]+=g*(1-m)*d,i[p+1+(_+1)*l]+=g*m*d,i[p+(_+1)*l]+=(1-g)*m*d}})),Xu({width:l,height:c,data:i},{width:l,height:c,data:h},o>>s),Qu({width:l,height:c,data:h},{width:l,height:c,data:i},o>>s),Xu({width:l,height:c,data:i},{width:l,height:c,data:h},o>>s),Qu({width:l,height:c,data:h},{width:l,height:c,data:i},o>>s),Xu({width:l,height:c,data:i},{width:l,height:c,data:h},o>>s),Qu({width:l,height:c,data:h},{width:l,height:c,data:i},o>>s);var p=u(i);if(!Array.isArray(p)){var _=ya(i);p=ma(0,_,p),p=function(t,e,n){t=+t,e=+e,n=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((e-t)/n)),o=new Array(i);++r<i;)o[r]=t+r*n;return o}(0,Math.floor(_/p)*p,p),p.shift()}return Ku().thresholds(p).size([l,c])(i).map(d)}function d(t){return t.value*=Math.pow(2,-2*s),t.coordinates.forEach(f),t}function f(t){t.forEach(p)}function p(t){t.forEach(_)}function _(t){t[0]=t[0]*Math.pow(2,s)-a,t[1]=t[1]*Math.pow(2,s)-a}function g(){return l=r+2*(a=3*o)>>s,c=i+2*a>>s,h}return h.x=function(e){return arguments.length?(t="function"==typeof e?e:Uu(+e),h):t},h.y=function(t){return arguments.length?(e="function"==typeof t?t:Uu(+t),h):e},h.weight=function(t){return arguments.length?(n="function"==typeof t?t:Uu(+t),h):n},h.size=function(t){if(!arguments.length)return[r,i];var e=+t[0],n=+t[1];if(!(e>=0&&n>=0))throw new Error("invalid size");return r=e,i=n,g()},h.cellSize=function(t){if(!arguments.length)return 1<<s;if(!((t=+t)>=1))throw new Error("invalid cell size");return s=Math.floor(Math.log(t)/Math.LN2),g()},h.thresholds=function(t){return arguments.length?(u="function"==typeof t?t:Array.isArray(t)?Uu(zu.call(t)):Uu(t),h):u},h.bandwidth=function(t){if(!arguments.length)return Math.sqrt(o*(o+1));if(!((t=+t)>=0))throw new Error("invalid bandwidth");return o=Math.round((Math.sqrt(4*t*t+1)-1)/2),g()},h}function nh(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function rh(t){return(t=nh(Math.abs(t)))?t[1]:NaN}var ih,oh=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function sh(t){if(!(e=oh.exec(t)))throw new Error("invalid format: "+t);var e;return new ah({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function ah(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function lh(t,e){var n=nh(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}sh.prototype=ah.prototype,ah.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var ch={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>lh(100*t,e),r:lh,s:function(t,e){var n=nh(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(ih=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,s=r.length;return o===s?r:o>s?r+new Array(o-s+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+nh(t,Math.max(0,e+o-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function uh(t){return t}var hh,dh,fh,ph=Array.prototype.map,_h=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function gh(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?uh:(e=ph.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var i=t.length,o=[],s=0,a=e[0],l=0;i>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),o.push(t.substring(i-=a,i+a)),!((l+=a+1)>r));)a=e[s=(s+1)%e.length];return o.reverse().join(n)}),i=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",s=void 0===t.decimal?".":t.decimal+"",a=void 0===t.numerals?uh:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(ph.call(t.numerals,String)),l=void 0===t.percent?"%":t.percent+"",c=void 0===t.minus?"":t.minus+"",u=void 0===t.nan?"NaN":t.nan+"";function h(t){var e=(t=sh(t)).fill,n=t.align,h=t.sign,d=t.symbol,f=t.zero,p=t.width,_=t.comma,g=t.precision,m=t.trim,v=t.type;"n"===v?(_=!0,v="g"):ch[v]||(void 0===g&&(g=12),m=!0,v="g"),(f||"0"===e&&"="===n)&&(f=!0,e="0",n="=");var y="$"===d?i:"#"===d&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",w="$"===d?o:/[%p]/.test(v)?l:"",b=ch[v],C=/[defgprs%]/.test(v);function x(t){var i,o,l,d=y,x=w;if("c"===v)x=b(t)+x,t="";else{var k=(t=+t)<0||1/t<0;if(t=isNaN(t)?u:b(Math.abs(t),g),m&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),k&&0==+t&&"+"!==h&&(k=!1),d=(k?"("===h?h:c:"-"===h||"("===h?"":h)+d,x=("s"===v?_h[8+ih/3]:"")+x+(k&&"("===h?")":""),C)for(i=-1,o=t.length;++i<o;)if(48>(l=t.charCodeAt(i))||l>57){x=(46===l?s+t.slice(i+1):t.slice(i))+x,t=t.slice(0,i);break}}_&&!f&&(t=r(t,1/0));var E=d.length+t.length+x.length,I=E<p?new Array(p-E+1).join(e):"";switch(_&&f&&(t=r(I+t,I.length?p-x.length:1/0),I=""),n){case"<":t=d+t+x+I;break;case"=":t=d+I+t+x;break;case"^":t=I.slice(0,E=I.length>>1)+d+t+x+I.slice(E);break;default:t=I+d+t+x}return a(t)}return g=void 0===g?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),x.toString=function(){return t+""},x}return{format:h,formatPrefix:function(t,e){var n=h(((t=sh(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(rh(e)/3))),i=Math.pow(10,-r),o=_h[8+r/3];return function(t){return n(i*t)+o}}}}hh=gh({thousands:",",grouping:[3],currency:["$",""]}),dh=hh.format,fh=hh.formatPrefix;var mh=2*Math.PI,vh=Math.abs,yh=Math.sqrt;function wh(){}function bh(t,e){t&&xh.hasOwnProperty(t.type)&&xh[t.type](t,e)}var Ch={Feature:function(t,e){bh(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)bh(n[r].geometry,e)}},xh={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){kh(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)kh(n[r],e,0)},Polygon:function(t,e){Eh(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)Eh(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)bh(n[r],e)}};function kh(t,e,n){var r,i=-1,o=t.length-n;for(e.lineStart();++i<o;)r=t[i],e.point(r[0],r[1],r[2]);e.lineEnd()}function Eh(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)kh(t[n],e,1);e.polygonEnd()}function Ih(t,e){t&&Ch.hasOwnProperty(t.type)?Ch[t.type](t,e):bh(t,e)}var Sh,Nh,Th,Rh,Ph=t=>t,Mh=new ha,Ah=new ha,Oh={point:wh,lineStart:wh,lineEnd:wh,polygonStart:function(){Oh.lineStart=Dh,Oh.lineEnd=$h},polygonEnd:function(){Oh.lineStart=Oh.lineEnd=Oh.point=wh,Mh.add(vh(Ah)),Ah=new ha},result:function(){var t=Mh/2;return Mh=new ha,t}};function Dh(){Oh.point=Lh}function Lh(t,e){Oh.point=Fh,Sh=Th=t,Nh=Rh=e}function Fh(t,e){Ah.add(Rh*t-Th*e),Th=t,Rh=e}function $h(){Fh(Sh,Nh)}var qh=Oh,jh=1/0,zh=jh,Bh=-jh,Uh=Bh;var Wh,Hh,Vh,Gh,Yh={point:function(t,e){t<jh&&(jh=t);t>Bh&&(Bh=t);e<zh&&(zh=e);e>Uh&&(Uh=e)},lineStart:wh,lineEnd:wh,polygonStart:wh,polygonEnd:wh,result:function(){var t=[[jh,zh],[Bh,Uh]];return Bh=Uh=-(zh=jh=1/0),t}},Kh=0,Xh=0,Qh=0,Jh=0,Zh=0,td=0,ed=0,nd=0,rd=0,id={point:od,lineStart:sd,lineEnd:cd,polygonStart:function(){id.lineStart=ud,id.lineEnd=hd},polygonEnd:function(){id.point=od,id.lineStart=sd,id.lineEnd=cd},result:function(){var t=rd?[ed/rd,nd/rd]:td?[Jh/td,Zh/td]:Qh?[Kh/Qh,Xh/Qh]:[NaN,NaN];return Kh=Xh=Qh=Jh=Zh=td=ed=nd=rd=0,t}};function od(t,e){Kh+=t,Xh+=e,++Qh}function sd(){id.point=ad}function ad(t,e){id.point=ld,od(Vh=t,Gh=e)}function ld(t,e){var n=t-Vh,r=e-Gh,i=yh(n*n+r*r);Jh+=i*(Vh+t)/2,Zh+=i*(Gh+e)/2,td+=i,od(Vh=t,Gh=e)}function cd(){id.point=od}function ud(){id.point=dd}function hd(){fd(Wh,Hh)}function dd(t,e){id.point=fd,od(Wh=Vh=t,Hh=Gh=e)}function fd(t,e){var n=t-Vh,r=e-Gh,i=yh(n*n+r*r);Jh+=i*(Vh+t)/2,Zh+=i*(Gh+e)/2,td+=i,ed+=(i=Gh*t-Vh*e)*(Vh+t),nd+=i*(Gh+e),rd+=3*i,od(Vh=t,Gh=e)}var pd=id;function _d(t){this._context=t}_d.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._context.moveTo(t,e),this._point=1;break;case 1:this._context.lineTo(t,e);break;default:this._context.moveTo(t+this._radius,e),this._context.arc(t,e,this._radius,0,mh)}},result:wh};var gd,md,vd,yd,wd,bd=new ha,Cd={point:wh,lineStart:function(){Cd.point=xd},lineEnd:function(){gd&&kd(md,vd),Cd.point=wh},polygonStart:function(){gd=!0},polygonEnd:function(){gd=null},result:function(){var t=+bd;return bd=new ha,t}};function xd(t,e){Cd.point=kd,md=yd=t,vd=wd=e}function kd(t,e){yd-=t,wd-=e,bd.add(yh(yd*yd+wd*wd)),yd=t,wd=e}var Ed=Cd;function Id(){this._string=[]}function Sd(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function Nd(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function Td(t){return+t}Id.prototype={_radius:4.5,_circle:Sd(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,e){switch(this._point){case 0:this._string.push("M",t,",",e),this._point=1;break;case 1:this._string.push("L",t,",",e);break;default:null==this._circle&&(this._circle=Sd(this._radius)),this._string.push("M",t,",",e,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}};var Rd=[0,1];function Pd(t){return t}function Md(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function Ad(t,e,n){var r=t[0],i=t[1],o=e[0],s=e[1];return i<r?(r=Md(i,r),o=n(s,o)):(r=Md(r,i),o=n(o,s)),function(t){return o(r(t))}}function Od(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),o=new Array(r),s=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<r;)i[s]=Md(t[s],t[s+1]),o[s]=n(e[s],e[s+1]);return function(e){var n=ua(t,e,1,r)-1;return o[n](i[n](e))}}function Dd(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Ld(){var t,e,n,r,i,o,s=Rd,a=Rd,l=Rc,c=Pd;function u(){var t,e,n,l=Math.min(s.length,a.length);return c!==Pd&&(t=s[0],e=s[l-1],t>e&&(n=t,t=e,e=n),c=function(n){return Math.max(t,Math.min(e,n))}),r=l>2?Od:Ad,i=o=null,h}function h(e){return null==e||isNaN(e=+e)?n:(i||(i=r(s.map(t),a,l)))(t(c(e)))}return h.invert=function(n){return c(e((o||(o=r(a,s.map(t),Ec)))(n)))},h.domain=function(t){return arguments.length?(s=Array.from(t,Td),u()):s.slice()},h.range=function(t){return arguments.length?(a=Array.from(t),u()):a.slice()},h.rangeRound=function(t){return a=Array.from(t),l=Pc,u()},h.clamp=function(t){return arguments.length?(c=!!t||Pd,u()):c!==Pd},h.interpolate=function(t){return arguments.length?(l=t,u()):l},h.unknown=function(t){return arguments.length?(n=t,h):n},function(n,r){return t=n,e=r,u()}}function Fd(){return Ld()(Pd,Pd)}function $d(t,e,n,r){var i,o=ma(t,e,n);switch((r=sh(null==r?",f":r)).type){case"s":var s=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(i=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(rh(e)/3)))-rh(Math.abs(t)))}(o,s))||(r.precision=i),fh(r,s);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,rh(e)-rh(t))+1}(o,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(t){return Math.max(0,-rh(Math.abs(t)))}(o))||(r.precision=i-2*("%"===r.type))}return dh(r)}function qd(t){var e=t.domain;return t.ticks=function(t){var n=e();return _a(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return $d(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,i,o=e(),s=0,a=o.length-1,l=o[s],c=o[a],u=10;for(c<l&&(i=l,l=c,c=i,i=s,s=a,a=i);u-- >0;){if((i=ga(l,c,n))===r)return o[s]=l,o[a]=c,e(o);if(i>0)l=Math.floor(l/i)*i,c=Math.ceil(c/i)*i;else{if(!(i<0))break;l=Math.ceil(l*i)/i,c=Math.floor(c*i)/i}r=i}return t},t}function jd(){var t=Fd();return t.copy=function(){return Dd(t,jd())},Nd.apply(t,arguments),qd(t)}async function zd(t,e,n,r){let i=jl(e).node().getBoundingClientRect().width,o=.705*i,s=jl(n),a=jd().domain([0,100]).range([30,i-30]),l=jd().domain([0,100]).range([30,o-30]),c=eh().x((t=>a(t.xPct))).y((t=>l(t.yPct))).size([i,o]).bandwidth(25).thresholds(20)(t),u=function(t,e){let n;if(void 0===e)for(const e of t)null!=e&&(n>e||void 0===n&&e>=e)&&(n=e);else{let r=-1;for(let i of t)null!=(i=e(i,++r,t))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}(c,(t=>t.value)),h=ya(c,(t=>t.value)),d=jd().domain([h,.75*h,,h/2,h/3,u]).range([0,.5,.75,1,8]),f=jd().domain([h,u]).range([1,1]);s.selectAll(".clipPathGroup").data(c,(t=>t.coordinates[0])).join("g").attr("class","clipPathGroup"),s.selectAll(".clipPathGroup").append("clipPath").attr("id",((t,e)=>"path-"+e)).append("path").attr("stroke-linejoin","round").attr("d",function(t,e){var n,r,i=4.5;function o(t){return t&&("function"==typeof i&&r.pointRadius(+i.apply(this,arguments)),Ih(t,n(r))),r.result()}return o.area=function(t){return Ih(t,n(qh)),qh.result()},o.measure=function(t){return Ih(t,n(Ed)),Ed.result()},o.bounds=function(t){return Ih(t,n(Yh)),Yh.result()},o.centroid=function(t){return Ih(t,n(pd)),pd.result()},o.projection=function(e){return arguments.length?(n=null==e?(t=null,Ph):(t=e).stream,o):t},o.context=function(t){return arguments.length?(r=null==t?(e=null,new Id):new _d(e=t),"function"!=typeof i&&r.pointRadius(i),o):e},o.pointRadius=function(t){return arguments.length?(i="function"==typeof t?t:(r.pointRadius(+t),+t),o):i},o.projection(t).context(e)}()),s.selectAll(".clipPathGroup").append("image").attr("clip-path",((t,e)=>`url(#path-${e})`)).attr("width","100%").attr("height","100%").attr("xlink:href",r).style("filter",(t=>`opacity(${f(t.value)}) blur(${d(t.value)}px)`))}function Bd(e){let n,r;return{c(){n=I("div"),r=S(e[2]),P(n,"class","tooltip svelte-txget2"),O(n,"top",e[0]+20+"px"),O(n,"left",e[1]+"px")},m(t,e){x(t,n,e),w(n,r)},p(t,[e]){4&e&&M(r,t[2]),1&e&&O(n,"top",t[0]+20+"px"),2&e&&O(n,"left",t[1]+"px")},i:t,o:t,d(t){t&&k(n)}}}function Ud(t,e,n){let r,i,o;return d(t,qt,(t=>n(0,r=t))),d(t,$t,(t=>n(1,i=t))),d(t,Ft,(t=>n(2,o=t))),[r,i,o]}class Wd extends mt{constructor(t){super(),gt(this,t,Ud,Bd,a,{})}}function Hd(t,e,n){n||t||e?($t.set(t),qt.set(e),n&&Ft.set(n)):Ft.set(null)}function Vd(t,e,n){const r=t.slice();return r[42]=e[n],r}function Gd(t,e,n){const r=t.slice();return r[45]=e[n],r}function Yd(t){let e,n,r,i;return n=new Wd({}),{c(){e=I("div"),dt(n.$$.fragment)},m(t,r){x(t,e,r),ft(n,e,null),i=!0},i(t){i||(at(n.$$.fragment,t),X((()=>{r||(r=ut(e,Ut,{duration:200},!0)),r.run(1)})),i=!0)},o(t){lt(n.$$.fragment,t),r||(r=ut(e,Ut,{duration:200},!1)),r.run(0),i=!1},d(t){t&&k(e),pt(n),t&&r&&r.end()}}}function Kd(t){let e,n,r,i=t[4][t[45]].name+"";return{c(){e=I("option"),n=S(i),e.__value=r=t[45],e.value=e.__value},m(t,r){x(t,e,r),w(e,n)},p(t,o){4112&o[0]&&i!==(i=t[4][t[45]].name+"")&&M(n,i),4096&o[0]&&r!==(r=t[45])&&(e.__value=r,e.value=e.__value)},d(t){t&&k(e)}}}function Xd(e){let n,r,i;return{c(){n=I("span"),n.textContent="pause",P(n,"class","material-icons-round md-14 clickable svelte-10ii4i")},m(t,o){x(t,n,o),r||(i=R(n,"click",e[25]),r=!0)},p:t,d(t){t&&k(n),r=!1,i()}}}function Qd(e){let n,r,i;return{c(){n=I("span"),n.textContent="play_arrow",P(n,"class","material-icons-round md-14 clickable svelte-10ii4i")},m(t,o){x(t,n,o),r||(i=R(n,"click",e[24]),r=!0)},p:t,d(t){t&&k(n),r=!1,i()}}}function Jd(t){let e,n=t[7],r=[];for(let e=0;e<n.length;e+=1)r[e]=Zd(Vd(t,n,e));return{c(){e=I("div");for(let t=0;t<r.length;t+=1)r[t].c()},m(n,i){x(n,e,i);for(let t=0;t<r.length;t+=1)r[t].m(e,null);t[32](e)},p(t,i){if(129&i[0]){let o;for(n=t[7],o=0;o<n.length;o+=1){const s=Vd(t,n,o);r[o]?r[o].p(s,i):(r[o]=Zd(s),r[o].c(),r[o].m(e,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}},d(n){n&&k(e),E(r,n),t[32](null)}}}function Zd(t){let e,n;return{c(){e=I("img"),P(e,"class","clip svelte-10ii4i"),O(e,"clip-path","circle("+t[42].r+"% at "+t[42].ctrx+"% "+t[42].ctry+"%)"),O(e,"filter","blur("+t[42].blur+"px)"),O(e,"opacity","$"+t[42].opacity),c(e.src,n=t[0].url)||P(e,"src",n)},m(t,n){x(t,e,n)},p(t,r){128&r[0]&&O(e,"clip-path","circle("+t[42].r+"% at "+t[42].ctrx+"% "+t[42].ctry+"%)"),128&r[0]&&O(e,"filter","blur("+t[42].blur+"px)"),128&r[0]&&O(e,"opacity","$"+t[42].opacity),1&r[0]&&!c(e.src,n=t[0].url)&&P(e,"src",n)},d(t){t&&k(e)}}}function tf(t){let e,n,r,i,s,a,l,u,h,d,f,p,_,g,m,v,y,b,C,T,F,$,q,j,z,B,U,W,H,V,G,Y,K,Q,J,Z,tt,et,nt,rt,it,ct,ut,ht,dt,ft,pt,_t,gt=t[0].artist+"",mt=t[0].title+"",vt=t[15]&&Yd(),yt=t[12],wt=[];for(let e=0;e<yt.length;e+=1)wt[e]=Kd(Gd(t,yt,e));function bt(t,e){return"pause"==t[6]?Qd:Xd}let Ct=bt(t),xt=Ct(t),kt="slice"==t[5]&&Jd(t);return{c(){vt&&vt.c(),e=N(),n=I("div"),r=I("h2"),i=I("div"),i.textContent="Gaze Collection",s=N(),a=I("div"),l=S(gt),u=S(", "),h=I("i"),d=S(mt),f=N(),p=I("div"),_=I("div"),g=I("div"),g.innerHTML='<span class="material-icons-round md-14 svelte-10ii4i">people</span> \n        <span>Viewer</span>',m=N(),v=I("div"),y=I("div"),b=I("span"),b.textContent="chevron_left",C=N(),T=I("span"),T.textContent="chevron_right",F=N(),$=I("select");for(let t=0;t<wt.length;t+=1)wt[t].c();q=N(),j=I("div"),j.textContent="Add Gaze",z=N(),B=I("div"),U=I("div"),U.innerHTML='<span class="material-icons-round md-14 svelte-10ii4i">layers</span> \n        <span>Visual</span>',W=N(),H=I("div"),V=I("div"),xt.c(),G=N(),Y=I("span"),K=I("input"),Q=N(),J=I("div"),J.textContent="Aggregate",Z=N(),tt=I("div"),et=I("div"),nt=I("img"),it=N(),ct=function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}("svg"),ht=N(),kt&&kt.c(),O(i,"font-weight","400"),O(i,"color","rgb(126 123 123)"),O(i,"margin-right","15px"),P(h,"class","svelte-10ii4i"),O(r,"display","flex"),O(r,"align-items","center"),P(r,"class","svelte-10ii4i"),P(g,"class","label svelte-10ii4i"),P(b,"class","material-icons-round md-18 nav clickable svelte-10ii4i"),L(b,"disabled",0==t[13]),P(T,"class","material-icons-round md-18 nav clickable svelte-10ii4i"),L(T,"disabled",t[13]==t[12].length-1),P($,"class","clickable svelte-10ii4i"),void 0===t[1]&&X((()=>t[19].call($))),P(y,"class","filter selected svelte-10ii4i"),P(j,"class","filter clickable svelte-10ii4i"),P(v,"class","filter-options svelte-10ii4i"),P(_,"class","viewer-filter filter-group svelte-10ii4i"),P(U,"class","label svelte-10ii4i"),P(K,"type","range"),P(K,"id","slider"),P(K,"name","slider"),P(K,"min","0"),P(K,"max",t[14]),P(K,"step","1"),P(K,"class","svelte-10ii4i"),P(Y,"id","slider-holder"),P(Y,"class","svelte-10ii4i"),P(V,"class","filter time svelte-10ii4i"),L(V,"selected","slice"==t[5]),P(J,"class","filter clickable svelte-10ii4i"),L(J,"selected","aggregate"==t[5]),P(H,"class","filter-options svelte-10ii4i"),P(B,"class","visual-filter filter-group svelte-10ii4i"),P(p,"class","card-filters svelte-10ii4i"),c(nt.src,rt=t[0].url)||P(nt,"src",rt),P(nt,"style",t[11]),P(nt,"class","svelte-10ii4i"),L(nt,"slice","slice"==t[5]),L(nt,"agg","aggregate"==t[5]),P(ct,"class","contour svelte-10ii4i"),P(ct,"id",ut=t[0].key+"-contour"),O(ct,"width","100%"),O(ct,"height","100%"),O(ct,"position","absolute"),O(ct,"top","0"),O(ct,"left","0"),O(ct,"z-index","10"),L(ct,"active","aggregate"==t[5]),P(et,"class","img-holder svelte-10ii4i"),O(et,"width",t[9]),O(et,"height",t[10]),O(et,"max-width",t[0].width+"px"),O(et,"max-height",t[0].height+"px"),P(tt,"class","center svelte-10ii4i"),P(n,"class","card-outer svelte-10ii4i"),P(n,"id",dt=t[0].key),L(n,"active",t[0].key==t[16])},m(o,c){vt&&vt.m(o,c),x(o,e,c),x(o,n,c),w(n,r),w(r,i),w(r,s),w(r,a),w(a,l),w(a,u),w(a,h),w(h,d),w(n,f),w(n,p),w(p,_),w(_,g),w(_,m),w(_,v),w(v,y),w(y,b),w(y,C),w(y,T),w(y,F),w(y,$);for(let t=0;t<wt.length;t+=1)wt[t].m($,null);D($,t[1]),w(v,q),w(v,j),w(p,z),w(p,B),w(B,U),w(B,W),w(B,H),w(H,V),xt.m(V,null),w(V,G),w(V,Y),w(Y,K),A(K,t[3]),w(H,Q),w(H,J),w(n,Z),w(n,tt),w(tt,et),w(et,nt),w(et,it),w(et,ct),w(et,ht),kt&&kt.m(et,null),ft=!0,pt||(_t=[R(b,"click",t[17]),R(T,"click",t[18]),R($,"change",t[19]),R(j,"mouseover",t[20]),R(j,"mousemove",t[21]),R(j,"mouseleave",t[22]),R(j,"click",t[23]),R(K,"input",t[26]),R(K,"change",t[27]),R(K,"input",t[27]),R(J,"mouseover",t[28]),R(J,"mousemove",t[29]),R(J,"mouseleave",t[30]),R(J,"click",t[31])],pt=!0)},p(t,r){if(t[15]?vt?32768&r[0]&&at(vt,1):(vt=Yd(),vt.c(),at(vt,1),vt.m(e.parentNode,e)):vt&&(ot(),lt(vt,1,1,(()=>{vt=null})),st()),(!ft||1&r[0])&&gt!==(gt=t[0].artist+"")&&M(l,gt),(!ft||1&r[0])&&mt!==(mt=t[0].title+"")&&M(d,mt),8192&r[0]&&L(b,"disabled",0==t[13]),12288&r[0]&&L(T,"disabled",t[13]==t[12].length-1),4112&r[0]){let e;for(yt=t[12],e=0;e<yt.length;e+=1){const n=Gd(t,yt,e);wt[e]?wt[e].p(n,r):(wt[e]=Kd(n),wt[e].c(),wt[e].m($,null))}for(;e<wt.length;e+=1)wt[e].d(1);wt.length=yt.length}4098&r[0]&&D($,t[1]),Ct===(Ct=bt(t))&&xt?xt.p(t,r):(xt.d(1),xt=Ct(t),xt&&(xt.c(),xt.m(V,G))),(!ft||16384&r[0])&&P(K,"max",t[14]),8&r[0]&&A(K,t[3]),32&r[0]&&L(V,"selected","slice"==t[5]),32&r[0]&&L(J,"selected","aggregate"==t[5]),(!ft||1&r[0]&&!c(nt.src,rt=t[0].url))&&P(nt,"src",rt),(!ft||2048&r[0])&&P(nt,"style",t[11]),32&r[0]&&L(nt,"slice","slice"==t[5]),32&r[0]&&L(nt,"agg","aggregate"==t[5]),(!ft||1&r[0]&&ut!==(ut=t[0].key+"-contour"))&&P(ct,"id",ut),32&r[0]&&L(ct,"active","aggregate"==t[5]),"slice"==t[5]?kt?kt.p(t,r):(kt=Jd(t),kt.c(),kt.m(et,null)):kt&&(kt.d(1),kt=null),(!ft||512&r[0])&&O(et,"width",t[9]),(!ft||1024&r[0])&&O(et,"height",t[10]),(!ft||1&r[0])&&O(et,"max-width",t[0].width+"px"),(!ft||1&r[0])&&O(et,"max-height",t[0].height+"px"),(!ft||1&r[0]&&dt!==(dt=t[0].key))&&P(n,"id",dt),65537&r[0]&&L(n,"active",t[0].key==t[16])},i(t){ft||(at(vt),ft=!0)},o(t){lt(vt),ft=!1},d(t){vt&&vt.d(t),t&&k(e),t&&k(n),E(wt,t),xt.d(),kt&&kt.d(),pt=!1,o(_t)}}}function ef(t,e,n){let r,i,o,s;d(t,Ot,(t=>n(35,r=t))),d(t,At,(t=>n(36,i=t))),d(t,Ft,(t=>n(15,o=t))),d(t,Dt,(t=>n(16,s=t)));let a,l,{data:c}=e,u=Math.min(i-500,1e3),h=Math.max(r-300,500),f="auto",p="auto",_="";c.dimWidthToHt<1?(p=h+"px",_="height: 100%"):(f=u+"px",_="width: 100%");let g=0,m=[];c.sessionData&&(m=c.sessionData);let v=[];m&&(v=Object.keys(m));let y=v.length-1;async function w(t){n(2,l=await oa("sessionData/"+t)),console.log(c,l),function(){n(7,I=[]);let t=10,e=10,r=(20-e)/t,i=6/t,o=1/t;for(let n=t;n>0;n--){let s=r*n+e,a=i*n,u=o*(t-n);I.push({class:"clip",r:s,ctrx:l[0].xPct,ctry:l[0].yPct,blur:a,opacity:u,src:c.url})}}(),l&&n(3,g=0)}a=v[y];let b,C,x=100,k="slice",E="pause",I=[];return t.$$set=t=>{"data"in t&&n(0,c=t.data)},t.$$.update=()=>{var e,r;18&t.$$.dirty[0]&&w(a),37&t.$$.dirty[0]&&(l&&n(14,x=l.length),"aggregate"==k&&zd(l,`#${c.key} .img-holder`,`#${c.key}-contour`,c.url)),76&t.$$.dirty[0]&&("play"==E&&g<l.length-1?setTimeout((()=>{n(3,g++,g)}),50):"play"==E&&g==l.length-1&&n(6,E="pause")),12&t.$$.dirty[0]&&l&&(e=l[g].xPct,r=l[g].yPct,C.forEach((t=>{let n=t.style["clip-path"].split("at ")[0],i=`at ${e}% ${r}%)`;t.style["clip-path"]=n+i}))),256&t.$$.dirty[0]&&b&&(C=b.childNodes),t.$$.dirty[0]},[c,a,l,g,m,k,E,I,b,f,p,_,v,y,x,o,s,()=>{n(13,y--,y),n(1,a=v[y])},()=>{n(13,y++,y),n(1,a=v[y])},function(){a=function(t){const e=t.querySelector(":checked")||t.options[0];return e&&e.__value}(this),n(1,a),n(12,v)},t=>{Hd(t.x,t.y,"Add your gaze to the collection")},t=>{Hd(t.x,t.y)},t=>{Hd()},()=>{Ct.set(c),wt.set("record")},()=>{n(5,k="slice"),g==l.length-1&&n(3,g=0),n(6,E="play")},()=>{n(6,E="pause")},()=>{n(5,k="slice")},function(){var t;t=this.value,g=""===t?null:+t,n(3,g),n(6,E),n(2,l)},t=>{Hd(t.x,t.y,"View a summary of personX gaze. The image is blurred out in portions where the viewer paid less attention.")},t=>{Hd(t.x,t.y)},t=>{Hd()},()=>{n(6,E="pause"),n(5,k="aggregate"),zd(l,`#${c.key} .img-holder`,`#${c.key}-contour`,c.url)},function(t){H[t?"unshift":"push"]((()=>{b=t,n(8,b)}))}]}class nf extends mt{constructor(t){super(),gt(this,t,ef,tf,a,{data:0},null,[-1,-1])}}let rf=yt(null),of=yt(null);var sf={$:t=>"string"==typeof t?document.querySelector(t):t,extend:(...t)=>Object.assign(...t),cumulativeOffset(t){let e=0,n=0;do{e+=t.offsetTop||0,n+=t.offsetLeft||0,t=t.offsetParent}while(t);return{top:e,left:n}},directScroll:t=>t&&t!==document&&t!==document.body,scrollTop(t,e){let n=void 0!==e;return this.directScroll(t)?n?t.scrollTop=e:t.scrollTop:n?document.documentElement.scrollTop=document.body.scrollTop=e:window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},scrollLeft(t,e){let n=void 0!==e;return this.directScroll(t)?n?t.scrollLeft=e:t.scrollLeft:n?document.documentElement.scrollLeft=document.body.scrollLeft=e:window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0}};const af={container:"body",duration:500,delay:0,offset:0,easing:function(t){return t<.5?4*t*t*t:.5*Math.pow(2*t-2,3)+1},onStart:t,onDone:t,onAborting:t,scrollX:!1,scrollY:!0},lf=t=>{let{offset:e,duration:n,delay:r,easing:i,x:o=0,y:s=0,scrollX:a,scrollY:l,onStart:c,onDone:u,container:h,onAborting:d,element:f}=t;"function"==typeof e&&(e=e());var p=sf.cumulativeOffset(h),g=f?sf.cumulativeOffset(f):{top:s,left:o},m=sf.scrollLeft(h),v=sf.scrollTop(h),w=g.left-p.left+e,b=g.top-p.top+e,C=w-m,x=b-v;let k=!0,E=!1,I=_()+r,S=I+n;function N(t){t||(E=!0,c(f,{x:o,y:s}))}function T(t){!function(t,e,n){a&&sf.scrollLeft(t,n),l&&sf.scrollTop(t,e)}(h,v+x*t,m+C*t)}function R(){k=!1}return y((t=>{if(!E&&t>=I&&N(!1),E&&t>=S&&(T(1),R(),u(f,{x:o,y:s})),!k)return d(f,{x:o,y:s}),!1;if(E){T(0+1*i((t-I)/n))}return!0})),N(r),T(0),R},cf=t=>lf((t=>{let e=sf.extend({},af,t);return e.container=sf.$(e.container),e.element=sf.$(e.element),e})(t));var uf;uf={offset:-80},sf.extend(af,uf||{});var hf=t=>{let e=document.querySelector("#"+t);cf({element:e})};function df(t,e,n){const r=t.slice();return r[5]=e[n],r}function ff(t){let e,n;return e=new nf({props:{data:t[5]}}),{c(){dt(e.$$.fragment)},m(t,r){ft(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.data=t[5]),e.$set(r)},i(t){n||(at(e.$$.fragment,t),n=!0)},o(t){lt(e.$$.fragment,t),n=!1},d(t){pt(e,t)}}}function pf(t){let e,n,r=t[0],i=[];for(let e=0;e<r.length;e+=1)i[e]=ff(df(t,r,e));const o=t=>lt(i[t],1,1,(()=>{i[t]=null}));return{c(){e=I("div");for(let t=0;t<i.length;t+=1)i[t].c();P(e,"class","card-holder svelte-q1jwsq")},m(t,r){x(t,e,r);for(let t=0;t<i.length;t+=1)i[t].m(e,null);n=!0},p(t,[n]){if(1&n){let s;for(r=t[0],s=0;s<r.length;s+=1){const o=df(t,r,s);i[s]?(i[s].p(o,n),at(i[s],1)):(i[s]=ff(o),i[s].c(),at(i[s],1),i[s].m(e,null))}for(ot(),s=r.length;s<i.length;s+=1)o(s);st()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)at(i[t]);n=!0}},o(t){i=i.filter(Boolean);for(let t=0;t<i.length;t+=1)lt(i[t]);n=!1},d(t){t&&k(e),E(i,t)}}}function _f(t,e,n){let r;d(t,Lt,(t=>n(1,r=t)));let i=[],o=[];return async function(){await async function(){let t=await oa("works");t&&(n(0,i=Object.values(t)),o=Object.keys(t),rf.set(o),of.set(i),Dt.set(o[0])),document.querySelector("body").className=""}(),window.addEventListener("scroll",(t=>{let e=window.innerHeight/2;document.querySelectorAll(".card-outer").forEach((t=>{let n=t.getBoundingClientRect();e>=n.top&&e<n.height+n.top&&Dt.set(t.id)}))}))}(),t.$$.update=()=>{2&t.$$.dirty&&hf(r)},[i,r]}class gf extends mt{constructor(t){super(),gt(this,t,_f,pf,a,{})}}var mf="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function vf(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets option of @rollup/plugin-commonjs appropriately for this require call to behave properly.')}
/*!
        localForage -- Offline Storage, Improved
        Version 1.10.0
        https://localforage.github.io/localForage
        (c) 2013-2017 Mozilla, Apache License 2.0
    */var yf,wf,bf=(yf=function(t,e){t.exports=function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){if(!a&&vf)return vf(s);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};e[s][0].call(c.exports,(function(t){var n=e[s][1][t];return i(n||t)}),c,c.exports,t,e,n,r)}return n[s].exports}for(var o=vf,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){(function(t){var n,r,i=t.MutationObserver||t.WebKitMutationObserver;if(i){var o=0,s=new i(u),a=t.document.createTextNode("");s.observe(a,{characterData:!0}),n=function(){a.data=o=++o%2}}else if(t.setImmediate||void 0===t.MessageChannel)n="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){u(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var l=new t.MessageChannel;l.port1.onmessage=u,n=function(){l.port2.postMessage(0)}}var c=[];function u(){var t,e;r=!0;for(var n=c.length;n;){for(e=c,c=[],t=-1;++t<n;)e[t]();n=c.length}r=!1}function h(t){1!==c.push(t)||r||n()}e.exports=h}).call(this,void 0!==mf?mf:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,n){var r=t(1);function i(){}var o={},s=["REJECTED"],a=["FULFILLED"],l=["PENDING"];function c(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,t!==i&&f(this,t)}function u(t,e,n){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function h(t,e,n){r((function(){var r;try{r=e(n)}catch(e){return o.reject(t,e)}r===t?o.reject(t,new TypeError("Cannot resolve promise with itself")):o.resolve(t,r)}))}function d(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function f(t,e){var n=!1;function r(e){n||(n=!0,o.reject(t,e))}function i(e){n||(n=!0,o.resolve(t,e))}function s(){e(i,r)}var a=p(s);"error"===a.status&&r(a.value)}function p(t,e){var n={};try{n.value=t(e),n.status="success"}catch(t){n.status="error",n.value=t}return n}function _(t){return t instanceof this?t:o.resolve(new this(i),t)}function g(t){var e=new this(i);return o.reject(e,t)}function m(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,r=!1;if(!n)return this.resolve([]);for(var s=new Array(n),a=0,l=-1,c=new this(i);++l<n;)u(t[l],l);return c;function u(t,i){function l(t){s[i]=t,++a!==n||r||(r=!0,o.resolve(c,s))}e.resolve(t).then(l,(function(t){r||(r=!0,o.reject(c,t))}))}}function v(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,r=!1;if(!n)return this.resolve([]);for(var s=-1,a=new this(i);++s<n;)l(t[s]);return a;function l(t){e.resolve(t).then((function(t){r||(r=!0,o.resolve(a,t))}),(function(t){r||(r=!0,o.reject(a,t))}))}}e.exports=c,c.prototype.catch=function(t){return this.then(null,t)},c.prototype.then=function(t,e){if("function"!=typeof t&&this.state===a||"function"!=typeof e&&this.state===s)return this;var n=new this.constructor(i);return this.state!==l?h(n,this.state===a?t:e,this.outcome):this.queue.push(new u(n,t,e)),n},u.prototype.callFulfilled=function(t){o.resolve(this.promise,t)},u.prototype.otherCallFulfilled=function(t){h(this.promise,this.onFulfilled,t)},u.prototype.callRejected=function(t){o.reject(this.promise,t)},u.prototype.otherCallRejected=function(t){h(this.promise,this.onRejected,t)},o.resolve=function(t,e){var n=p(d,e);if("error"===n.status)return o.reject(t,n.value);var r=n.value;if(r)f(t,r);else{t.state=a,t.outcome=e;for(var i=-1,s=t.queue.length;++i<s;)t.queue[i].callFulfilled(e)}return t},o.reject=function(t,e){t.state=s,t.outcome=e;for(var n=-1,r=t.queue.length;++n<r;)t.queue[n].callRejected(e);return t},c.resolve=_,c.reject=g,c.all=m,c.race=v},{1:1}],3:[function(t,e,n){(function(e){"function"!=typeof e.Promise&&(e.Promise=t(2))}).call(this,void 0!==mf?mf:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(t,e,n){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){return}}var s=o();function a(){try{if(!s||!s.open)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return!1}}function l(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<t.length;r+=1)n.append(t[r]);return n.getBlob(e.type)}}"undefined"==typeof Promise&&t(3);var c=Promise;function u(t,e){e&&t.then((function(t){e(null,t)}),(function(t){e(t)}))}function h(t,e,n){"function"==typeof e&&t.then(e),"function"==typeof n&&t.catch(n)}function d(t){return"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t)),t}function f(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var p="local-forage-detect-blob-support",_=void 0,g={},m=Object.prototype.toString,v="readonly",y="readwrite";function w(t){for(var e=t.length,n=new ArrayBuffer(e),r=new Uint8Array(n),i=0;i<e;i++)r[i]=t.charCodeAt(i);return n}function b(t){return new c((function(e){var n=t.transaction(p,y),r=l([""]);n.objectStore(p).put(r,"key"),n.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},n.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);e(n||!t||parseInt(t[1],10)>=43)}})).catch((function(){return!1}))}function C(t){return"boolean"==typeof _?c.resolve(_):b(t).then((function(t){return _=t}))}function x(t){var e=g[t.name],n={};n.promise=new c((function(t,e){n.resolve=t,n.reject=e})),e.deferredOperations.push(n),e.dbReady?e.dbReady=e.dbReady.then((function(){return n.promise})):e.dbReady=n.promise}function k(t){var e=g[t.name].deferredOperations.pop();if(e)return e.resolve(),e.promise}function E(t,e){var n=g[t.name].deferredOperations.pop();if(n)return n.reject(e),n.promise}function I(t,e){return new c((function(n,r){if(g[t.name]=g[t.name]||L(),t.db){if(!e)return n(t.db);x(t),t.db.close()}var i=[t.name];e&&i.push(t.version);var o=s.open.apply(s,i);e&&(o.onupgradeneeded=function(e){var n=o.result;try{n.createObjectStore(t.storeName),e.oldVersion<=1&&n.createObjectStore(p)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+t.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+t.storeName+'" already exists.')}}),o.onerror=function(t){t.preventDefault(),r(o.error)},o.onsuccess=function(){var e=o.result;e.onversionchange=function(t){t.target.close()},n(e),k(t)}}))}function S(t){return I(t,!1)}function N(t){return I(t,!0)}function T(t,e){if(!t.db)return!0;var n=!t.db.objectStoreNames.contains(t.storeName),r=t.version<t.db.version,i=t.version>t.db.version;if(r&&(t.version!==e&&console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),i||n){if(n){var o=t.db.version+1;o>t.version&&(t.version=o)}return!0}return!1}function R(t){return new c((function(e,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:t.type})},r.readAsBinaryString(t)}))}function P(t){return l([w(atob(t.data))],{type:t.type})}function M(t){return t&&t.__local_forage_encoded_blob}function A(t){var e=this,n=e._initReady().then((function(){var t=g[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady}));return h(n,t,t),n}function O(t){x(t);for(var e=g[t.name],n=e.forages,r=0;r<n.length;r++){var i=n[r];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return t.db=null,S(t).then((function(e){return t.db=e,T(t)?N(t):e})).then((function(r){t.db=e.db=r;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=r})).catch((function(e){throw E(t,e),e}))}function D(t,e,n,r){void 0===r&&(r=1);try{var i=t.db.transaction(t.storeName,e);n(null,i)}catch(i){if(r>0&&(!t.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return c.resolve().then((function(){if(!t.db||"NotFoundError"===i.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),N(t)})).then((function(){return O(t).then((function(){D(t,e,n,r-1)}))})).catch(n);n(i)}}function L(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function F(t){var e=this,n={db:null};if(t)for(var r in t)n[r]=t[r];var i=g[n.name];i||(i=L(),g[n.name]=i),i.forages.push(e),e._initReady||(e._initReady=e.ready,e.ready=A);var o=[];function s(){return c.resolve()}for(var a=0;a<i.forages.length;a++){var l=i.forages[a];l!==e&&o.push(l._initReady().catch(s))}var u=i.forages.slice(0);return c.all(o).then((function(){return n.db=i.db,S(n)})).then((function(t){return n.db=t,T(n,e._defaultConfig.version)?N(n):t})).then((function(t){n.db=i.db=t,e._dbInfo=n;for(var r=0;r<u.length;r++){var o=u[r];o!==e&&(o._dbInfo.db=n.db,o._dbInfo.version=n.version)}}))}function $(t,e){var n=this;t=d(t);var r=new c((function(e,r){n.ready().then((function(){D(n._dbInfo,v,(function(i,o){if(i)return r(i);try{var s=o.objectStore(n._dbInfo.storeName).get(t);s.onsuccess=function(){var t=s.result;void 0===t&&(t=null),M(t)&&(t=P(t)),e(t)},s.onerror=function(){r(s.error)}}catch(t){r(t)}}))})).catch(r)}));return u(r,e),r}function q(t,e){var n=this,r=new c((function(e,r){n.ready().then((function(){D(n._dbInfo,v,(function(i,o){if(i)return r(i);try{var s=o.objectStore(n._dbInfo.storeName).openCursor(),a=1;s.onsuccess=function(){var n=s.result;if(n){var r=n.value;M(r)&&(r=P(r));var i=t(r,n.key,a++);void 0!==i?e(i):n.continue()}else e()},s.onerror=function(){r(s.error)}}catch(t){r(t)}}))})).catch(r)}));return u(r,e),r}function j(t,e,n){var r=this;t=d(t);var i=new c((function(n,i){var o;r.ready().then((function(){return o=r._dbInfo,"[object Blob]"===m.call(e)?C(o.db).then((function(t){return t?e:R(e)})):e})).then((function(e){D(r._dbInfo,y,(function(o,s){if(o)return i(o);try{var a=s.objectStore(r._dbInfo.storeName);null===e&&(e=void 0);var l=a.put(e,t);s.oncomplete=function(){void 0===e&&(e=null),n(e)},s.onabort=s.onerror=function(){var t=l.error?l.error:l.transaction.error;i(t)}}catch(t){i(t)}}))})).catch(i)}));return u(i,n),i}function z(t,e){var n=this;t=d(t);var r=new c((function(e,r){n.ready().then((function(){D(n._dbInfo,y,(function(i,o){if(i)return r(i);try{var s=o.objectStore(n._dbInfo.storeName).delete(t);o.oncomplete=function(){e()},o.onerror=function(){r(s.error)},o.onabort=function(){var t=s.error?s.error:s.transaction.error;r(t)}}catch(t){r(t)}}))})).catch(r)}));return u(r,e),r}function B(t){var e=this,n=new c((function(t,n){e.ready().then((function(){D(e._dbInfo,y,(function(r,i){if(r)return n(r);try{var o=i.objectStore(e._dbInfo.storeName).clear();i.oncomplete=function(){t()},i.onabort=i.onerror=function(){var t=o.error?o.error:o.transaction.error;n(t)}}catch(t){n(t)}}))})).catch(n)}));return u(n,t),n}function U(t){var e=this,n=new c((function(t,n){e.ready().then((function(){D(e._dbInfo,v,(function(r,i){if(r)return n(r);try{var o=i.objectStore(e._dbInfo.storeName).count();o.onsuccess=function(){t(o.result)},o.onerror=function(){n(o.error)}}catch(t){n(t)}}))})).catch(n)}));return u(n,t),n}function W(t,e){var n=this,r=new c((function(e,r){t<0?e(null):n.ready().then((function(){D(n._dbInfo,v,(function(i,o){if(i)return r(i);try{var s=o.objectStore(n._dbInfo.storeName),a=!1,l=s.openKeyCursor();l.onsuccess=function(){var n=l.result;n?0===t||a?e(n.key):(a=!0,n.advance(t)):e(null)},l.onerror=function(){r(l.error)}}catch(t){r(t)}}))})).catch(r)}));return u(r,e),r}function H(t){var e=this,n=new c((function(t,n){e.ready().then((function(){D(e._dbInfo,v,(function(r,i){if(r)return n(r);try{var o=i.objectStore(e._dbInfo.storeName).openKeyCursor(),s=[];o.onsuccess=function(){var e=o.result;e?(s.push(e.key),e.continue()):t(s)},o.onerror=function(){n(o.error)}}catch(t){n(t)}}))})).catch(n)}));return u(n,t),n}function V(t,e){e=f.apply(this,arguments);var n=this.config();(t="function"!=typeof t&&t||{}).name||(t.name=t.name||n.name,t.storeName=t.storeName||n.storeName);var r,i=this;if(t.name){var o=t.name===n.name&&i._dbInfo.db?c.resolve(i._dbInfo.db):S(t).then((function(e){var n=g[t.name],r=n.forages;n.db=e;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=e;return e}));r=t.storeName?o.then((function(e){if(e.objectStoreNames.contains(t.storeName)){var n=e.version+1;x(t);var r=g[t.name],i=r.forages;e.close();for(var o=0;o<i.length;o++){var a=i[o];a._dbInfo.db=null,a._dbInfo.version=n}var l=new c((function(e,r){var i=s.open(t.name,n);i.onerror=function(t){i.result.close(),r(t)},i.onupgradeneeded=function(){i.result.deleteObjectStore(t.storeName)},i.onsuccess=function(){var t=i.result;t.close(),e(t)}}));return l.then((function(t){r.db=t;for(var e=0;e<i.length;e++){var n=i[e];n._dbInfo.db=t,k(n._dbInfo)}})).catch((function(e){throw(E(t,e)||c.resolve()).catch((function(){})),e}))}})):o.then((function(e){x(t);var n=g[t.name],r=n.forages;e.close();for(var i=0;i<r.length;i++)r[i]._dbInfo.db=null;var o=new c((function(e,n){var r=s.deleteDatabase(t.name);r.onerror=function(){var t=r.result;t&&t.close(),n(r.error)},r.onblocked=function(){console.warn('dropInstance blocked for database "'+t.name+'" until all open connections are closed')},r.onsuccess=function(){var t=r.result;t&&t.close(),e(t)}}));return o.then((function(t){n.db=t;for(var e=0;e<r.length;e++)k(r[e]._dbInfo)})).catch((function(e){throw(E(t,e)||c.resolve()).catch((function(){})),e}))}))}else r=c.reject("Invalid arguments");return u(r,e),r}var G={_driver:"asyncStorage",_initStorage:F,_support:a(),iterate:q,getItem:$,setItem:j,removeItem:z,clear:B,length:U,key:W,keys:H,dropInstance:V};function Y(){return"function"==typeof openDatabase}var K="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",X="~~local_forage_type~",Q=/^~~local_forage_type~([^~]+)~/,J="__lfsc__:",Z=J.length,tt="arbf",et="blob",nt="si08",rt="ui08",it="uic8",ot="si16",st="si32",at="ur16",lt="ui32",ct="fl32",ut="fl64",ht=Z+tt.length,dt=Object.prototype.toString;function ft(t){var e,n,r,i,o,s=.75*t.length,a=t.length,l=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);var c=new ArrayBuffer(s),u=new Uint8Array(c);for(e=0;e<a;e+=4)n=K.indexOf(t[e]),r=K.indexOf(t[e+1]),i=K.indexOf(t[e+2]),o=K.indexOf(t[e+3]),u[l++]=n<<2|r>>4,u[l++]=(15&r)<<4|i>>2,u[l++]=(3&i)<<6|63&o;return c}function pt(t){var e,n=new Uint8Array(t),r="";for(e=0;e<n.length;e+=3)r+=K[n[e]>>2],r+=K[(3&n[e])<<4|n[e+1]>>4],r+=K[(15&n[e+1])<<2|n[e+2]>>6],r+=K[63&n[e+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function _t(t,e){var n="";if(t&&(n=dt.call(t)),t&&("[object ArrayBuffer]"===n||t.buffer&&"[object ArrayBuffer]"===dt.call(t.buffer))){var r,i=J;t instanceof ArrayBuffer?(r=t,i+=tt):(r=t.buffer,"[object Int8Array]"===n?i+=nt:"[object Uint8Array]"===n?i+=rt:"[object Uint8ClampedArray]"===n?i+=it:"[object Int16Array]"===n?i+=ot:"[object Uint16Array]"===n?i+=at:"[object Int32Array]"===n?i+=st:"[object Uint32Array]"===n?i+=lt:"[object Float32Array]"===n?i+=ct:"[object Float64Array]"===n?i+=ut:e(new Error("Failed to get type for BinaryArray"))),e(i+pt(r))}else if("[object Blob]"===n){var o=new FileReader;o.onload=function(){var n=X+t.type+"~"+pt(this.result);e(J+et+n)},o.readAsArrayBuffer(t)}else try{e(JSON.stringify(t))}catch(n){console.error("Couldn't convert value into a JSON string: ",t),e(null,n)}}function gt(t){if(t.substring(0,Z)!==J)return JSON.parse(t);var e,n=t.substring(ht),r=t.substring(Z,ht);if(r===et&&Q.test(n)){var i=n.match(Q);e=i[1],n=n.substring(i[0].length)}var o=ft(n);switch(r){case tt:return o;case et:return l([o],{type:e});case nt:return new Int8Array(o);case rt:return new Uint8Array(o);case it:return new Uint8ClampedArray(o);case ot:return new Int16Array(o);case at:return new Uint16Array(o);case st:return new Int32Array(o);case lt:return new Uint32Array(o);case ct:return new Float32Array(o);case ut:return new Float64Array(o);default:throw new Error("Unkown type: "+r)}}var mt={serialize:_t,deserialize:gt,stringToBuffer:ft,bufferToString:pt};function vt(t,e,n,r){t.executeSql("CREATE TABLE IF NOT EXISTS "+e.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function yt(t){var e=this,n={db:null};if(t)for(var r in t)n[r]="string"!=typeof t[r]?t[r].toString():t[r];var i=new c((function(t,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(t){return r(t)}n.db.transaction((function(i){vt(i,n,(function(){e._dbInfo=n,t()}),(function(t,e){r(e)}))}),r)}));return n.serializer=mt,i}function wt(t,e,n,r,i,o){t.executeSql(n,r,i,(function(t,s){s.code===s.SYNTAX_ERR?t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[e.storeName],(function(t,a){a.rows.length?o(t,s):vt(t,e,(function(){t.executeSql(n,r,i,o)}),o)}),o):o(t,s)}),o)}function bt(t,e){var n=this;t=d(t);var r=new c((function(e,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){wt(n,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[t],(function(t,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=i.serializer.deserialize(r)),e(r)}),(function(t,e){r(e)}))}))})).catch(r)}));return u(r,e),r}function Ct(t,e){var n=this,r=new c((function(e,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){wt(n,i,"SELECT * FROM "+i.storeName,[],(function(n,r){for(var o=r.rows,s=o.length,a=0;a<s;a++){var l=o.item(a),c=l.value;if(c&&(c=i.serializer.deserialize(c)),void 0!==(c=t(c,l.key,a+1)))return void e(c)}e()}),(function(t,e){r(e)}))}))})).catch(r)}));return u(r,e),r}function xt(t,e,n,r){var i=this;t=d(t);var o=new c((function(o,s){i.ready().then((function(){void 0===e&&(e=null);var a=e,l=i._dbInfo;l.serializer.serialize(e,(function(e,c){c?s(c):l.db.transaction((function(n){wt(n,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[t,e],(function(){o(a)}),(function(t,e){s(e)}))}),(function(e){if(e.code===e.QUOTA_ERR){if(r>0)return void o(xt.apply(i,[t,a,n,r-1]));s(e)}}))}))})).catch(s)}));return u(o,n),o}function kt(t,e,n){return xt.apply(this,[t,e,n,1])}function Et(t,e){var n=this;t=d(t);var r=new c((function(e,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){wt(n,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[t],(function(){e()}),(function(t,e){r(e)}))}))})).catch(r)}));return u(r,e),r}function It(t){var e=this,n=new c((function(t,n){e.ready().then((function(){var r=e._dbInfo;r.db.transaction((function(e){wt(e,r,"DELETE FROM "+r.storeName,[],(function(){t()}),(function(t,e){n(e)}))}))})).catch(n)}));return u(n,t),n}function St(t){var e=this,n=new c((function(t,n){e.ready().then((function(){var r=e._dbInfo;r.db.transaction((function(e){wt(e,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(e,n){var r=n.rows.item(0).c;t(r)}),(function(t,e){n(e)}))}))})).catch(n)}));return u(n,t),n}function Nt(t,e){var n=this,r=new c((function(e,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){wt(n,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[t+1],(function(t,n){var r=n.rows.length?n.rows.item(0).key:null;e(r)}),(function(t,e){r(e)}))}))})).catch(r)}));return u(r,e),r}function Tt(t){var e=this,n=new c((function(t,n){e.ready().then((function(){var r=e._dbInfo;r.db.transaction((function(e){wt(e,r,"SELECT key FROM "+r.storeName,[],(function(e,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);t(r)}),(function(t,e){n(e)}))}))})).catch(n)}));return u(n,t),n}function Rt(t){return new c((function(e,n){t.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var i=[],o=0;o<r.rows.length;o++)i.push(r.rows.item(o).name);e({db:t,storeNames:i})}),(function(t,e){n(e)}))}),(function(t){n(t)}))}))}function Pt(t,e){e=f.apply(this,arguments);var n=this.config();(t="function"!=typeof t&&t||{}).name||(t.name=t.name||n.name,t.storeName=t.storeName||n.storeName);var r,i=this;return r=t.name?new c((function(e){var r;r=t.name===n.name?i._dbInfo.db:openDatabase(t.name,"","",0),t.storeName?e({db:r,storeNames:[t.storeName]}):e(Rt(r))})).then((function(t){return new c((function(e,n){t.db.transaction((function(r){function i(t){return new c((function(e,n){r.executeSql("DROP TABLE IF EXISTS "+t,[],(function(){e()}),(function(t,e){n(e)}))}))}for(var o=[],s=0,a=t.storeNames.length;s<a;s++)o.push(i(t.storeNames[s]));c.all(o).then((function(){e()})).catch((function(t){n(t)}))}),(function(t){n(t)}))}))})):c.reject("Invalid arguments"),u(r,e),r}var Mt={_driver:"webSQLStorage",_initStorage:yt,_support:Y(),iterate:Ct,getItem:bt,setItem:kt,removeItem:Et,clear:It,length:St,key:Nt,keys:Tt,dropInstance:Pt};function At(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(t){return!1}}function Ot(t,e){var n=t.name+"/";return t.storeName!==e.storeName&&(n+=t.storeName+"/"),n}function Dt(){var t="_localforage_support_test";try{return localStorage.setItem(t,!0),localStorage.removeItem(t),!1}catch(t){return!0}}function Lt(){return!Dt()||localStorage.length>0}function Ft(t){var e=this,n={};if(t)for(var r in t)n[r]=t[r];return n.keyPrefix=Ot(t,e._defaultConfig),Lt()?(e._dbInfo=n,n.serializer=mt,c.resolve()):c.reject()}function $t(t){var e=this,n=e.ready().then((function(){for(var t=e._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(t)&&localStorage.removeItem(r)}}));return u(n,t),n}function qt(t,e){var n=this;t=d(t);var r=n.ready().then((function(){var e=n._dbInfo,r=localStorage.getItem(e.keyPrefix+t);return r&&(r=e.serializer.deserialize(r)),r}));return u(r,e),r}function jt(t,e){var n=this,r=n.ready().then((function(){for(var e=n._dbInfo,r=e.keyPrefix,i=r.length,o=localStorage.length,s=1,a=0;a<o;a++){var l=localStorage.key(a);if(0===l.indexOf(r)){var c=localStorage.getItem(l);if(c&&(c=e.serializer.deserialize(c)),void 0!==(c=t(c,l.substring(i),s++)))return c}}}));return u(r,e),r}function zt(t,e){var n=this,r=n.ready().then((function(){var e,r=n._dbInfo;try{e=localStorage.key(t)}catch(t){e=null}return e&&(e=e.substring(r.keyPrefix.length)),e}));return u(r,e),r}function Bt(t){var e=this,n=e.ready().then((function(){for(var t=e._dbInfo,n=localStorage.length,r=[],i=0;i<n;i++){var o=localStorage.key(i);0===o.indexOf(t.keyPrefix)&&r.push(o.substring(t.keyPrefix.length))}return r}));return u(n,t),n}function Ut(t){var e=this.keys().then((function(t){return t.length}));return u(e,t),e}function Wt(t,e){var n=this;t=d(t);var r=n.ready().then((function(){var e=n._dbInfo;localStorage.removeItem(e.keyPrefix+t)}));return u(r,e),r}function Ht(t,e,n){var r=this;t=d(t);var i=r.ready().then((function(){void 0===e&&(e=null);var n=e;return new c((function(i,o){var s=r._dbInfo;s.serializer.serialize(e,(function(e,r){if(r)o(r);else try{localStorage.setItem(s.keyPrefix+t,e),i(n)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||o(t),o(t)}}))}))}));return u(i,n),i}function Vt(t,e){if(e=f.apply(this,arguments),!(t="function"!=typeof t&&t||{}).name){var n=this.config();t.name=t.name||n.name,t.storeName=t.storeName||n.storeName}var r,i=this;return r=t.name?new c((function(e){t.storeName?e(Ot(t,i._defaultConfig)):e(t.name+"/")})).then((function(t){for(var e=localStorage.length-1;e>=0;e--){var n=localStorage.key(e);0===n.indexOf(t)&&localStorage.removeItem(n)}})):c.reject("Invalid arguments"),u(r,e),r}var Gt={_driver:"localStorageWrapper",_initStorage:Ft,_support:At(),iterate:jt,getItem:qt,setItem:Ht,removeItem:Wt,clear:$t,length:Ut,key:zt,keys:Bt,dropInstance:Vt},Yt=function(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)},Kt=function(t,e){for(var n=t.length,r=0;r<n;){if(Yt(t[r],e))return!0;r++}return!1},Xt=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},Qt={},Jt={},Zt={INDEXEDDB:G,WEBSQL:Mt,LOCALSTORAGE:Gt},te=[Zt.INDEXEDDB._driver,Zt.WEBSQL._driver,Zt.LOCALSTORAGE._driver],ee=["dropInstance"],ne=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ee),re={description:"",driver:te.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ie(t,e){t[e]=function(){var n=arguments;return t.ready().then((function(){return t[e].apply(t,n)}))}}function oe(){for(var t=1;t<arguments.length;t++){var e=arguments[t];if(e)for(var n in e)e.hasOwnProperty(n)&&(Xt(e[n])?arguments[0][n]=e[n].slice():arguments[0][n]=e[n])}return arguments[0]}var se=function(){function t(e){for(var n in i(this,t),Zt)if(Zt.hasOwnProperty(n)){var r=Zt[n],o=r._driver;this[n]=o,Qt[o]||this.defineDriver(r)}this._defaultConfig=oe({},re),this._config=oe({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return t.prototype.config=function(t){if("object"===(void 0===t?"undefined":r(t))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e]}return!("driver"in t)||!t.driver||this.setDriver(this._config.driver)}return"string"==typeof t?this._config[t]:this._config},t.prototype.defineDriver=function(t,e,n){var r=new c((function(e,n){try{var r=t._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver)return void n(i);for(var o=ne.concat("_initStorage"),s=0,a=o.length;s<a;s++){var l=o[s];if((!Kt(ee,l)||t[l])&&"function"!=typeof t[l])return void n(i)}var h=function(){for(var e=function(t){return function(){var e=new Error("Method "+t+" is not implemented by the current driver"),n=c.reject(e);return u(n,arguments[arguments.length-1]),n}},n=0,r=ee.length;n<r;n++){var i=ee[n];t[i]||(t[i]=e(i))}};h();var d=function(n){Qt[r]&&console.info("Redefining LocalForage driver: "+r),Qt[r]=t,Jt[r]=n,e()};"_support"in t?t._support&&"function"==typeof t._support?t._support().then(d,n):d(!!t._support):d(!0)}catch(t){n(t)}}));return h(r,e,n),r},t.prototype.driver=function(){return this._driver||null},t.prototype.getDriver=function(t,e,n){var r=Qt[t]?c.resolve(Qt[t]):c.reject(new Error("Driver not found."));return h(r,e,n),r},t.prototype.getSerializer=function(t){var e=c.resolve(mt);return h(e,t),e},t.prototype.ready=function(t){var e=this,n=e._driverSet.then((function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready}));return h(n,t,t),n},t.prototype.setDriver=function(t,e,n){var r=this;Xt(t)||(t=[t]);var i=this._getSupportedDrivers(t);function o(){r._config.driver=r.driver()}function s(t){return r._extend(t),o(),r._ready=r._initStorage(r._config),r._ready}function a(t){return function(){var e=0;function n(){for(;e<t.length;){var i=t[e];return e++,r._dbInfo=null,r._ready=null,r.getDriver(i).then(s).catch(n)}o();var a=new Error("No available storage method found.");return r._driverSet=c.reject(a),r._driverSet}return n()}}var l=null!==this._driverSet?this._driverSet.catch((function(){return c.resolve()})):c.resolve();return this._driverSet=l.then((function(){var t=i[0];return r._dbInfo=null,r._ready=null,r.getDriver(t).then((function(t){r._driver=t._driver,o(),r._wrapLibraryMethodsWithReady(),r._initDriver=a(i)}))})).catch((function(){o();var t=new Error("No available storage method found.");return r._driverSet=c.reject(t),r._driverSet})),h(this._driverSet,e,n),this._driverSet},t.prototype.supports=function(t){return!!Jt[t]},t.prototype._extend=function(t){oe(this,t)},t.prototype._getSupportedDrivers=function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];this.supports(i)&&e.push(i)}return e},t.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,e=ne.length;t<e;t++)ie(this,ne[t])},t.prototype.createInstance=function(e){return new t(e)},t}(),ae=new se;e.exports=ae},{3:3}]},{},[4])(4)},yf(wf={exports:{}},wf.exports),wf.exports);async function Cf(){let t=await document.querySelector("#webgazerVideoContainer");return await document.querySelector("body").append(t),await webgazer.pause(),await webgazer.showVideo(!1)}async function xf(){if(webgazer.isReady()){console.log("gazer fully loaded"),webgazer.pause(),webgazer.setVideoViewerSize(300,300);let t=document.querySelector("#webgazerVideoContainer");document.querySelector(".container-body").append(t),It.set(!0),console.log("gazer initialized")}else await setTimeout(xf,100)}function kf(){webgazer.setGazeListener((function(t,e){if(null==t)return;let n=h(xt);n.push({x:t.x,y:t.y}),xt.set(n)})),setTimeout((()=>{webgazer.clearGazeListener(),function(){let t=document.querySelector(".center-dot").getBoundingClientRect(),e=0,n=h(xt);n.map((n=>{let r=n.x-t.x+t.width/2,i=n.y-t.y+t.height/2,o=Math.sqrt(i*i+r*r);return e+=o,o}));let r=100*(1-e/n.length/(document.querySelector(".container-body").getBoundingClientRect().width/2));console.log(r),bf.setItem("calibrationPct",Math.round(r)),Nt.set(Math.round(r))}()}),4e3)}function Ef(){webgazer.removeMouseEventListeners()}function If(t){let e;return{c(){e=I("span"),e.textContent="Gaze",P(e,"class","header-sub accent svelte-1incu58"),L(e,"active","record"===t[0])},m(t,n){x(t,e,n)},p(t,n){1&n&&L(e,"active","record"===t[0])},d(t){t&&k(e)}}}function Sf(t){let e;return{c(){e=I("span"),e.textContent="Gallery",P(e,"class","header-sub accent svelte-1incu58"),L(e,"active","gallery"===t[0])},m(t,n){x(t,e,n)},p(t,n){1&n&&L(e,"active","gallery"===t[0])},d(t){t&&k(e)}}}function Nf(e){let n,r,i,s,a,l,c,u,h,d,f,p,_,g;return{c(){n=I("nav"),r=I("div"),i=I("span"),i.textContent="navigate_before",s=N(),a=I("div"),l=I("span"),l.textContent="navigate_next",c=N(),u=I("div"),u.innerHTML='<span class="material-icons-round svelte-1incu58">view_module</span>',h=N(),d=I("div"),d.textContent="About",P(i,"class","material-icons-round svelte-1incu58"),P(r,"class","svelte-1incu58"),P(l,"class","material-icons-round svelte-1incu58"),P(a,"class","svelte-1incu58"),P(u,"class","svelte-1incu58"),P(n,"class","svelte-1incu58"),P(d,"class","btn clickable active btn-about svelte-1incu58")},m(t,o){x(t,n,o),w(n,r),w(r,i),w(n,s),w(n,a),w(a,l),w(n,c),w(n,u),x(t,h,o),x(t,d,o),p=!0,_||(g=[R(i,"click",e[4]),R(l,"click",e[5]),R(u,"click",e[6])],_=!0)},p:t,i(t){p||(X((()=>{f||(f=ut(d,Ut,{},!0)),f.run(1)})),p=!0)},o(t){f||(f=ut(d,Ut,{},!1)),f.run(0),p=!1},d(t){t&&k(n),t&&k(h),t&&k(d),t&&f&&f.end(),_=!1,o(g)}}}function Tf(t){let e,n,r,i,o,s,a,l,c,u,h,d,f,p,_;function g(t,e){return"gallery"==t[0]?Sf:If}let m=g(t),v=m(t),y="gallery"==t[0]&&Nf(t);return{c(){e=I("header"),n=I("div"),r=I("div"),i=I("span"),i.textContent="How We Gaze",o=N(),s=I("span"),s.textContent="-",a=N(),v.c(),l=N(),c=I("div"),y&&y.c(),u=N(),h=I("div"),h.innerHTML='<span class="material-icons-round svelte-1incu58">arrow_back</span> \n\n        <span>Back to Gallery</span>',P(s,"class","divider svelte-1incu58"),P(r,"class","header-left"),P(h,"class","btn clickable svelte-1incu58"),L(h,"active","record"===t[0]),P(c,"class","header-right svelte-1incu58"),P(n,"class","header-content svelte-1incu58"),P(e,"class","svelte-1incu58")},m(d,g){x(d,e,g),w(e,n),w(n,r),w(r,i),w(r,o),w(r,s),w(r,a),v.m(r,null),w(n,l),w(n,c),y&&y.m(c,null),w(c,u),w(c,h),f=!0,p||(_=R(h,"click",t[7]),p=!0)},p(t,[e]){m===(m=g(t))&&v?v.p(t,e):(v.d(1),v=m(t),v&&(v.c(),v.m(r,null))),"gallery"==t[0]?y?(y.p(t,e),1&e&&at(y,1)):(y=Nf(t),y.c(),at(y,1),y.m(c,u)):y&&(ot(),lt(y,1,1,(()=>{y=null})),st()),1&e&&L(h,"active","record"===t[0])},i(t){f||(at(y),X((()=>{d||(d=ut(h,Wt,{duration:500},!0)),d.run(1)})),f=!0)},o(t){lt(y),d||(d=ut(h,Wt,{duration:500},!1)),d.run(0),f=!1},d(t){t&&k(e),v.d(),y&&y.d(),t&&d&&d.end(),p=!1,_()}}}function Rf(t,e,n){let r,i,o,s,a;function l(t){let e=r.indexOf(i)+t;hf(`${r[e]}`)}d(t,rf,(t=>n(8,r=t))),d(t,Dt,(t=>n(9,i=t))),d(t,wt,(t=>n(0,o=t))),d(t,It,(t=>n(1,s=t))),d(t,St,(t=>n(2,a=t)));return[o,s,a,l,()=>{l(-1)},()=>{l(1)},()=>{bt.set("nav")},()=>{s&&a&&Cf(),wt.set("gallery")}]}class Pf extends mt{constructor(t){super(),gt(this,t,Rf,Tf,a,{})}}function Mf(e){let n,r,i,o,s,a,l;return{c(){n=I("h3"),n.textContent="Record Your Gaze: Overview",r=N(),i=I("p"),i.textContent="In order to generate a visualization of your viewing session, well ask you to\r\n  study a piece of artwork for 15 seconds with your webcam turned on.",o=N(),s=I("p"),s.innerHTML="<strong>No personal information will be recorded.</strong> The only information\n  that will be recorded is a series of points corresponding to your eye movement.\n  Please enable webcam permission to proceed!",a=N(),l=I("p"),l.textContent="This should take about 5 minutes total."},m(t,e){x(t,n,e),x(t,r,e),x(t,i,e),x(t,o,e),x(t,s,e),x(t,a,e),x(t,l,e)},p:t,i:t,o:t,d(t){t&&k(n),t&&k(r),t&&k(i),t&&k(o),t&&k(s),t&&k(a),t&&k(l)}}}class Af extends mt{constructor(t){super(),gt(this,t,null,Mf,a,{})}}function Of(e){let n,r,i;return{c(){n=I("h3"),n.textContent="Calibrate: Video",r=N(),i=I("p"),i.textContent="Well need to first calibrate your webcam in order to proceed. Ensure that\r\n    your are in a well-lit environment, and that your face is in the green\r\n    section of the screen below.",P(i,"class","inst")},m(t,e){x(t,n,e),x(t,r,e),x(t,i,e)},p:t,d(t){t&&k(n),t&&k(r),t&&k(i)}}}function Df(t){let e,n,r,i,o,s,a,l;return{c(){e=I("h3"),e.textContent="Existing Calibration Loaded",n=N(),r=I("p"),i=S("Your webcam was already calibrated with an accuracy rate of "),o=I("strong"),s=S(t[2]),a=S("%"),l=S(". Please ensure your face is centered below, then click to proceed and view\r\n    art!"),P(r,"class","inst")},m(t,c){x(t,e,c),x(t,n,c),x(t,r,c),w(r,i),w(r,o),w(o,s),w(o,a),w(r,l)},p(t,e){4&e&&M(s,t[2])},d(t){t&&k(e),t&&k(n),t&&k(r)}}}function Lf(t){let e;return{c(){e=I("div"),e.innerHTML="<p>Initializing Video Stream...</p>",P(e,"class","video-wrapper glow svelte-10bw9l4")},m(t,n){x(t,e,n)},d(t){t&&k(e)}}}function Ff(e){let n,r;function i(t,e){return 1==t[0]?Df:0==t[0]?Of:void 0}let o=i(e),s=o&&o(e),a=!e[1]&&Lf();return{c(){s&&s.c(),n=N(),a&&a.c(),r=T()},m(t,e){s&&s.m(t,e),x(t,n,e),a&&a.m(t,e),x(t,r,e)},p(t,[e]){o===(o=i(t))&&s?s.p(t,e):(s&&s.d(1),s=o&&o(t),s&&(s.c(),s.m(n.parentNode,n))),t[1]?a&&(a.d(1),a=null):a||(a=Lf(),a.c(),a.m(r.parentNode,r))},i:t,o:t,d(t){s&&s.d(t),t&&k(n),a&&a.d(t),t&&k(r)}}}function $f(t,e,n){let r,i,o;d(t,St,(t=>n(1,r=t))),d(t,It,(t=>n(3,i=t))),d(t,Nt,(t=>n(2,o=t)));let{calibrated:s}=e;return t.$$set=t=>{"calibrated"in t&&n(0,s=t.calibrated)},t.$$.update=()=>{10&t.$$.dirty&&i&&(r?async function(){let t=document.querySelector("#webgazerVideoContainer");document.querySelector(".container-body").append(t),await webgazer.resume(),Ef()}():setTimeout((()=>{!async function(){console.log("gazer video init"),await webgazer.resume(),Ef(),St.set(!0),console.log("video done init")}()}),200))},[s,r,o,i]}class qf extends mt{constructor(t){super(),gt(this,t,$f,Ff,a,{calibrated:0})}}function jf(t,e,n){const r=t.slice();return r[7]=e[n],r}function zf(t){let e;function n(t,e){return t[1]>t[3]?Hf:Wf}let r=n(t),i=r(t);return{c(){i.c(),e=T()},m(t,n){i.m(t,n),x(t,e,n)},p(t,o){r===(r=n(t))&&i?i.p(t,o):(i.d(1),i=r(t),i&&(i.c(),i.m(e.parentNode,e)))},d(t){i.d(t),t&&k(e)}}}function Bf(t){let e,n,r,i,o,s,a;return{c(){e=I("p"),e.textContent="Great work! Now stare at the dot at the center of the screen for 5 seconds\r\n    so we can calculate your accuracy rate!",n=N(),r=I("div"),r.textContent="Start staring!",i=N(),o=I("div"),P(e,"class","svelte-19g2675"),P(r,"class","clickable btn btn-stare accent svelte-19g2675"),L(r,"disabled",t[2]),P(o,"class","center-dot svelte-19g2675")},m(l,c){x(l,e,c),x(l,n,c),x(l,r,c),x(l,i,c),x(l,o,c),s||(a=R(r,"click",t[6]),s=!0)},p(t,e){4&e&&L(r,"disabled",t[2])},d(t){t&&k(e),t&&k(n),t&&k(r),t&&k(i),t&&k(o),s=!1,a()}}}function Uf(t){let e,n=t[4],r=[];for(let e=0;e<n.length;e+=1)r[e]=Vf(jf(t,n,e));return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=T()},m(t,n){for(let e=0;e<r.length;e+=1)r[e].m(t,n);x(t,e,n)},p(t,i){if(48&i){let o;for(n=t[4],o=0;o<n.length;o+=1){const s=jf(t,n,o);r[o]?r[o].p(s,i):(r[o]=Vf(s),r[o].c(),r[o].m(e.parentNode,e))}for(;o<r.length;o+=1)r[o].d(1);r.length=n.length}},d(t){E(r,t),t&&k(e)}}}function Wf(t){let e,n,r,i,o,s,a,l,c,u,h;return{c(){e=I("p"),n=S("Your calculated accuracy is "),r=I("strong"),i=S(t[1]),o=S("%"),s=S("."),a=N(),l=I("p"),c=S("Unfortunately we require an accuracy rate of "),u=S(t[3]),h=S("% or\r\n      higher to proceed! Please re-do your calibration, or exit to gallery."),O(e,"color","var(--color-neg)"),P(e,"class","svelte-19g2675"),P(l,"class","svelte-19g2675")},m(t,d){x(t,e,d),w(e,n),w(e,r),w(r,i),w(r,o),w(e,s),x(t,a,d),x(t,l,d),w(l,c),w(l,u),w(l,h)},p(t,e){2&e&&M(i,t[1]),8&e&&M(u,t[3])},d(t){t&&k(e),t&&k(a),t&&k(l)}}}function Hf(t){let e,n,r,i,o,s,a,l,c,u,h,d,f,p=100-t[1]+"";return{c(){e=I("p"),n=S("Your calculated accuracy is "),r=I("strong"),i=S(t[1]),o=S("%"),s=S("!"),a=N(),l=I("p"),c=S("This means that the eye tracker can detect your eye movements with a\r\n      margin of error of "),u=S(p),h=S("% of the size of the container\r\n      that holds this text."),d=N(),f=I("p"),f.textContent="Not perfect, but good enough to deduce patterns in how you look at art!\r\n      Lastly, please look at the selected piece of artwork (full-screen) for 20\r\n      seconds, and well generate a custom visual summarizing how you viewed the\r\n      painting.",O(e,"color","var(--color-pos)"),P(e,"class","svelte-19g2675"),P(l,"class","svelte-19g2675"),P(f,"class","svelte-19g2675")},m(t,p){x(t,e,p),w(e,n),w(e,r),w(r,i),w(r,o),w(e,s),x(t,a,p),x(t,l,p),w(l,c),w(l,u),w(l,h),x(t,d,p),x(t,f,p)},p(t,e){2&e&&M(i,t[1]),2&e&&p!==(p=100-t[1]+"")&&M(u,p)},d(t){t&&k(e),t&&k(a),t&&k(l),t&&k(d),t&&k(f)}}}function Vf(e){let n,r,i;return{c(){n=I("div"),P(n,"class","calibration-pt svelte-19g2675"),O(n,"top",e[7].top),O(n,"right",e[7].right),P(n,"numclicks","0")},m(t,o){x(t,n,o),r||(i=R(n,"click",e[5]),r=!0)},p:t,d(t){t&&k(n),r=!1,i()}}}function Gf(e){let n,r,i;function o(t,e){return"dots"==t[0]?Uf:"stare"==t[0]?Bf:"done"==t[0]?zf:void 0}let s=o(e),a=s&&s(e);return{c(){n=I("h3"),n.textContent="Calibrate: Exercise",r=N(),a&&a.c(),i=T()},m(t,e){x(t,n,e),x(t,r,e),a&&a.m(t,e),x(t,i,e)},p(t,[e]){s===(s=o(t))&&a?a.p(t,e):(a&&a.d(1),a=s&&s(t),a&&(a.c(),a.m(i.parentNode,i)))},i:t,o:t,d(t){t&&k(n),t&&k(r),a&&a.d(t),t&&k(i)}}}function Yf(t,e,n){let r,i;d(t,Nt,(t=>n(1,r=t))),d(t,Tt,(t=>n(3,i=t)));let o="dots";!async function(){webgazer.addMouseEventListeners()}();let s;return t.$$.update=()=>{3&t.$$.dirty&&("stare"==o&&Ef(),r&&n(0,o="done")),t.$$.dirty},[o,r,s,i,[{top:"10%",right:"7%",numClicks:0},{top:"50%",right:"7%",numClicks:0},{top:"90%",right:"7%",numClicks:0},{top:"10%",right:"93%",numClicks:0},{top:"50%",right:"93%",numClicks:0},{top:"90%",right:"93%",numClicks:0},{top:"10%",right:"50%",numClicks:0},{top:"50%",right:"50%",numClicks:0},{top:"90%",right:"50%",numClicks:0}],function(t){let e=parseInt(this.getAttribute("numclicks"))+1;this.setAttribute("numclicks",e),this.style.opacity=1-e*(1/4),4==e&&function(){let t=document.querySelectorAll(".calibration-pt"),e=!0;return t.forEach((t=>{parseInt(t.getAttribute("numclicks"))<4&&(e=!1)})),e}()&&n(0,o="stare")},()=>{n(2,s=!0),kf()}]}class Kf extends mt{constructor(t){super(),gt(this,t,Yf,Gf,a,{})}}function Xf(e){let n,r,i,o,s;return{c(){n=I("h3"),n.textContent="Calibrate: Instructions",r=N(),i=I("p"),i.textContent="Great! Your face calibration will be displayed on the right for reference.\r\n  Next, well calibrate your eye tracking movement on the screen. Remember these\r\n  two rules!",o=N(),s=I("div"),s.innerHTML='<div class="svelte-1i27hj5"><p class="svelte-1i27hj5">#1: Eyes on cursor at all times</p> \n    <img src="./assets/img/explain-eye.svg"/></div> \n  <div class="svelte-1i27hj5"><p class="svelte-1i27hj5">#2: Move cursor to each red dot, and click on dot until it disappears</p> \n    <img src="./assets/img/explain-cursor.svg"/></div>',P(i,"class","instr svelte-1i27hj5"),P(s,"class","explain svelte-1i27hj5")},m(t,e){x(t,n,e),x(t,r,e),x(t,i,e),x(t,o,e),x(t,s,e)},p:t,i:t,o:t,d(t){t&&k(n),t&&k(r),t&&k(i),t&&k(o),t&&k(s)}}}class Qf extends mt{constructor(t){super(),gt(this,t,null,Xf,a,{})}}function Jf(e){let n,r,i,s,a,l,c,u,h,d;return{c(){n=I("h3"),n.textContent="Calibrate: Results",r=N(),i=I("p"),i.textContent="Great work! Were generating your custom visualization (it will take up to 30\r\n  seconds). In the meantime, enter the name with which youd like associate your\r\n  visualization in the gallery!",s=N(),a=I("div"),l=I("input"),c=N(),u=I("div"),u.textContent="Save & View",P(l,"placeholder","Enter name here"),P(l,"class","svelte-18s0wyp"),P(u,"class","btn accent clickable svelte-18s0wyp"),L(u,"disabled-part",1==e[0]),P(a,"class","input-wrapper svelte-18s0wyp")},m(t,o){x(t,n,o),x(t,r,o),x(t,i,o),x(t,s,o),x(t,a,o),w(a,l),A(l,e[1]),w(a,c),w(a,u),h||(d=[R(l,"input",e[3]),R(l,"keyup",e[4]),R(u,"click",e[2])],h=!0)},p(t,[e]){2&e&&l.value!==t[1]&&A(l,t[1]),1&e&&L(u,"disabled-part",1==t[0])},i:t,o:t,d(t){t&&k(n),t&&k(r),t&&k(i),t&&k(s),t&&k(a),h=!1,o(d)}}}function Zf(t,e,n){let r,i,o;d(t,Ct,(t=>n(5,r=t))),d(t,kt,(t=>n(6,i=t))),d(t,Mt,(t=>n(7,o=t)));let s,a=o,l=i,c=r.key,u=Ct,h=!1;async function f(){n(0,h=!0),await sa("works/"+c+"/sessionData/"+a+"/name",s),new MutationObserver((t=>{t[0].removedNodes.length>0&&(console.log(Ct.key),Lt.set(Ct.key),wt.set("gallery"))})).observe(document.querySelector(".container-body"),{childList:!0,subtree:!1,characterDataOldValue:!0}),Cf()}!async function(){await sa("sessionData/"+a,l),await sa("sessionData/"+a,l)}(),async function(){let t=await oa("works/"+c);console.log(t),t||await sa("works/"+c,u),await sa("works/"+c+"/sessionData/"+a,{name:"Anonymous"})}();return[h,s,f,function(){s=this.value,n(1,s)},t=>{13===t.keyCode?f():n(0,h=!1)}]}class tp extends mt{constructor(t){super(),gt(this,t,Zf,Jf,a,{})}}function ep(e){let n,r,i,o,s,a;return{c(){n=I("div"),r=I("div"),i=I("img"),s=N(),a=I("p"),a.textContent="Please look at the following image for 20 seconds",P(i,"id","artView"),c(i.src,o=e[1].url)||P(i,"src",o),P(i,"class","svelte-1iaoraq"),L(i,"inactive",1==e[0]),P(a,"class","svelte-1iaoraq"),L(a,"inactive",0==e[0]),P(r,"class","img-holder svelte-1iaoraq"),P(n,"class","wrapper-full svelte-1iaoraq")},m(t,e){x(t,n,e),w(n,r),w(r,i),w(r,s),w(r,a)},p(t,[e]){2&e&&!c(i.src,o=t[1].url)&&P(i,"src",o),1&e&&L(i,"inactive",1==t[0]),1&e&&L(a,"inactive",0==t[0])},i:t,o:t,d(t){t&&k(n)}}}function np(t,e,n){let r;d(t,Ct,(t=>n(1,r=t)));let i=!0;return setTimeout((()=>{n(0,i=!1),async function(){let t=document.querySelector("#artView").getBoundingClientRect();webgazer.setGazeListener((function(e,n){if(null==e)return;let r={time:n,x:e.x-t.x,y:e.y-t.y,xPct:100*(e.x-t.x)/t.width,yPct:100*(e.y-t.y)/t.height,xMin:t.left,xMax:t.right,yMin:t.top,yMax:t.bottom,sessionID:h(Mt)},i=h(kt);i.push(r),kt.set(i)})),setTimeout((()=>{webgazer.clearGazeListener(),console.log(h(kt)),Rt.set(h(Rt)+1)}),2e4)}()}),3e3),[i,r]}class rp extends mt{constructor(t){super(),gt(this,t,np,ep,a,{})}}function ip(t,e,n){const r=t.slice();return r[22]=e[n],r}function op(t){let e;return{c(){e=I("div"),P(e,"class","nav-dot svelte-1c3jx3e"),L(e,"active",t[0][t[2]]===t[22])},m(t,n){x(t,e,n)},p(t,n){5&n&&L(e,"active",t[0][t[2]]===t[22])},d(t){t&&k(e)}}}function sp(e){let n,r;return n=new tp({}),{c(){dt(n.$$.fragment)},m(t,e){ft(n,t,e),r=!0},p:t,i(t){r||(at(n.$$.fragment,t),r=!0)},o(t){lt(n.$$.fragment,t),r=!1},d(t){pt(n,t)}}}function ap(e){let n,r;return n=new rp({}),{c(){dt(n.$$.fragment)},m(t,e){ft(n,t,e),r=!0},p:t,i(t){r||(at(n.$$.fragment,t),r=!0)},o(t){lt(n.$$.fragment,t),r=!1},d(t){pt(n,t)}}}function lp(e){let n,r;return n=new Kf({}),{c(){dt(n.$$.fragment)},m(t,e){ft(n,t,e),r=!0},p:t,i(t){r||(at(n.$$.fragment,t),r=!0)},o(t){lt(n.$$.fragment,t),r=!1},d(t){pt(n,t)}}}function cp(e){let n,r;return n=new Qf({}),{c(){dt(n.$$.fragment)},m(t,e){ft(n,t,e),r=!0},p:t,i(t){r||(at(n.$$.fragment,t),r=!0)},o(t){lt(n.$$.fragment,t),r=!1},d(t){pt(n,t)}}}function up(t){let e,n,r;return n=new qf({props:{calibrated:t[6]}}),{c(){e=I("div"),dt(n.$$.fragment)},m(t,i){x(t,e,i),ft(n,e,null),r=!0},p(t,e){const r={};64&e&&(r.calibrated=t[6]),n.$set(r)},i(t){r||(at(n.$$.fragment,t),r=!0)},o(t){lt(n.$$.fragment,t),r=!1},d(t){t&&k(e),pt(n)}}}function hp(e){let n,r,i;return r=new Af({}),{c(){n=I("div"),dt(r.$$.fragment)},m(t,e){x(t,n,e),ft(r,n,null),i=!0},p:t,i(t){i||(at(r.$$.fragment,t),i=!0)},o(t){lt(r.$$.fragment,t),i=!1},d(t){t&&k(n),pt(r)}}}function dp(t){let e,n,r,i,o=t[0][t[2]].btnBackLabel+"";return{c(){e=I("div"),n=S(o),P(e,"class","btn-prev btn disabled svelte-1c3jx3e"),L(e,"accent",t[1]&&t[1]<70),L(e,"disabled",1==t[3])},m(o,s){x(o,e,s),w(e,n),r||(i=R(e,"click",t[14]),r=!0)},p(t,r){5&r&&o!==(o=t[0][t[2]].btnBackLabel+"")&&M(n,o),2&r&&L(e,"accent",t[1]&&t[1]<70),8&r&&L(e,"disabled",1==t[3])},d(t){t&&k(e),r=!1,i()}}}function fp(t){let e,n,r;return{c(){e=I("div"),e.textContent="Re-Calibrate",P(e,"class","btn re-cal clickable svelte-1c3jx3e"),L(e,"disabled",0==t[6])},m(i,o){x(i,e,o),n||(r=R(e,"click",t[9]),n=!0)},p(t,n){64&n&&L(e,"disabled",0==t[6])},d(t){t&&k(e),n=!1,r()}}}function pp(t){let e,n,r;function i(t,e){return t[8]?gp:_p}let o=i(t),s=o(t);return{c(){e=I("div"),s.c(),P(e,"class","btn-next btn accent clickable svelte-1c3jx3e"),L(e,"disabled",t[8]||t[4]),L(e,"glow",t[8])},m(i,o){x(i,e,o),s.m(e,null),n||(r=R(e,"click",t[15]),n=!0)},p(t,n){o===(o=i(t))&&s?s.p(t,n):(s.d(1),s=o(t),s&&(s.c(),s.m(e,null))),272&n&&L(e,"disabled",t[8]||t[4]),256&n&&L(e,"glow",t[8])},d(t){t&&k(e),s.d(),n=!1,r()}}}function _p(t){let e,n=t[0][t[2]].btnLabel+"";return{c(){e=S(n)},m(t,n){x(t,e,n)},p(t,r){5&r&&n!==(n=t[0][t[2]].btnLabel+"")&&M(e,n)},d(t){t&&k(e)}}}function gp(e){let n;return{c(){n=S("Loading...")},m(t,e){x(t,n,e)},p:t,d(t){t&&k(n)}}}function mp(t){let e,n,r,i,o,s,a,l,c,u,h,d,f,p,_,g,m,v,y=t[7].title+"",b=t[7].artist+"",C=t[0],T=[];for(let e=0;e<C.length;e+=1)T[e]=op(ip(t,C,e));const R=[hp,up,cp,lp,ap,sp],A=[];function O(t,e){return"overview"==t[0][t[2]].sectionName?0:"calibrate-vid"==t[0][t[2]].sectionName?1:"calibrate-instructions"==t[0][t[2]].sectionName?2:"calibrate-exercise"==t[0][t[2]].sectionName?3:"view"==t[0][t[2]].sectionName?4:"results"==t[0][t[2]].sectionName?5:-1}function D(t,e){return t[6]&&t[2]!==t[0].length-1?fp:dp}~(f=O(t))&&(p=A[f]=R[f](t));let L=D(t),F=L(t),$=!t[5]&&pp(t);return{c(){e=I("section"),n=I("div"),r=I("div"),i=S("Gazing at:"),o=I("span"),s=S(y),a=S(" by "),l=S(b),c=N(),u=I("div");for(let t=0;t<T.length;t+=1)T[t].c();h=N(),d=I("div"),p&&p.c(),_=N(),g=I("div"),F.c(),m=N(),$&&$.c(),P(o,"class","selection-holder svelte-1c3jx3e"),P(r,"class","current-selection"),P(u,"class","nav-ind svelte-1c3jx3e"),P(n,"class","container-header svelte-1c3jx3e"),P(d,"class","container-body svelte-1c3jx3e"),P(g,"class","container-footer svelte-1c3jx3e"),P(e,"class","experiment-container svelte-1c3jx3e")},m(t,p){x(t,e,p),w(e,n),w(n,r),w(r,i),w(r,o),w(o,s),w(o,a),w(o,l),w(n,c),w(n,u);for(let t=0;t<T.length;t+=1)T[t].m(u,null);w(e,h),w(e,d),~f&&A[f].m(d,null),w(e,_),w(e,g),F.m(g,null),w(g,m),$&&$.m(g,null),v=!0},p(t,[e]){if((!v||128&e)&&y!==(y=t[7].title+"")&&M(s,y),(!v||128&e)&&b!==(b=t[7].artist+"")&&M(l,b),5&e){let n;for(C=t[0],n=0;n<C.length;n+=1){const r=ip(t,C,n);T[n]?T[n].p(r,e):(T[n]=op(r),T[n].c(),T[n].m(u,null))}for(;n<T.length;n+=1)T[n].d(1);T.length=C.length}let n=f;f=O(t),f===n?~f&&A[f].p(t,e):(p&&(ot(),lt(A[n],1,1,(()=>{A[n]=null})),st()),~f?(p=A[f],p?p.p(t,e):(p=A[f]=R[f](t),p.c()),at(p,1),p.m(d,null)):p=null),L===(L=D(t))&&F?F.p(t,e):(F.d(1),F=L(t),F&&(F.c(),F.m(g,m))),t[5]?$&&($.d(1),$=null):$?$.p(t,e):($=pp(t),$.c(),$.m(g,null))},i(t){v||(at(p),v=!0)},o(t){lt(p),v=!1},d(t){t&&k(e),E(T,t),~f&&A[f].d(),F.d(),$&&$.d()}}}function vp(t,e,n){let r,i,o,s,a,l,c,u;d(t,Tt,(t=>n(11,r=t))),d(t,Nt,(t=>n(1,i=t))),d(t,St,(t=>n(12,o=t))),d(t,It,(t=>n(13,s=t))),d(t,Rt,(t=>n(2,a=t))),d(t,Mt,(t=>n(18,l=t))),d(t,Ct,(t=>n(7,c=t))),d(t,Pt,(t=>n(8,u=t)));let h,p=!1,_=!1,g=!1,m=!1,v=[{sectionName:"overview",videoShown:!1,btnLabel:"Start!",disableBack:!0,showLoader:!0,btnBackLabel:"Back to Overview"},{sectionName:"calibrate-vid",videoShown:!0,videoPos:"middle",disableBack:!1,disableNext:!1,btnBackLabel:"Back to Overview",btnLabel:"Got It - Face is Aligned",showLoader:!0},{sectionName:"calibrate-instructions",videoShown:!0,videoPos:"top",btnBackLabel:"Back to Video Alignment",btnLabel:"Got It - Proceed"},{sectionName:"calibrate-exercise",videoShown:!0,videoPos:"top",disableNext:!0,btnBackLabel:"Restart Eye Calibration",btnLabel:"Proceed to View Art",gazerRecording:!0},{sectionName:"view",videoShown:!1,btnLabel:"Proceed",disableNext:!1,btnBackLabel:"Back to Calibration",showLoader:!0},{sectionName:"results",videoShown:!1,btnLabel:"View Pattern",disableBack:!0,hideNext:!0,btnBackLabel:"Back to Calibration"}],y=[{sectionName:"calibrate-vid",videoShown:!0,videoPos:"middle",disableBack:!0,disableNext:!1,btnBackLabel:"Back to Overview",btnLabel:"Got It - Face is Aligned",showLoader:!0},v[4],v[5]],w=v;!async function(){let t=await bf.getItem("webgazerGlobalData"),e=await bf.getItem("calibrationPct");Nt.set(e),t&&(t.length>20&&e>r?(n(0,w=y),n(6,m=!0)):n(0,w=v))}(),U((()=>{Rt.set(0),l||Mt.set((new Date).getTime()),s||(console.log("gazer first init"),webgazer.showVideo(!1),webgazer.begin(),xf()),document.querySelector("body").className="gaze"}));return t.$$.update=()=>{5125&t.$$.dirty&&(n(10,h=w[a]),1==h.videoShown&&1==o?(webgazer.showVideo(!0),function(t){let e=document.querySelector("#webgazerVideoContainer"),n=320;"top"==t?(n=110,webgazer.setVideoViewerSize(n,n),e.style.top="0%",e.style.left="90%",e.style.width=`${n}px`,e.style.height="auto"):"middle"==t&&(webgazer.setVideoViewerSize(n,n),e.style.width=`${n}px`,e.style.height="auto",e.style.position="absolute",e.style.left="50%",e.style.top="30%",e.style.transform="translate(-50%, -50%)")}(h.videoPos)):webgazer.showVideo(!1),h.disableBack?n(3,p=!0):n(3,p=!1),h.disableNext?n(4,_=!0):n(4,_=!1),h.hideNext?n(5,g=!0):n(5,g=!1)),13312&t.$$.dirty&&(v[0].loadingVar=s,v[1].loadingVar=o,y[0].loadingVar=o,h&&(1!=h.showLoader||h.loadingVar?Pt.set(!1):Pt.set(!0))),2050&t.$$.dirty&&i>r&&n(4,_=!1)},[w,i,a,p,_,g,m,c,u,function(){n(6,m=!1),n(0,w=v),Nt.set(null),webgazer.clearData()},h,r,o,s,()=>{"calibrate-exercise"==w[a].sectionName&&(console.log("yea that me"),console.log("uh restarting i guess"),Nt.set(null)),f(Rt,a--,a)},()=>{a<w.length-2&&f(Rt,a++,a)}]}class yp extends mt{constructor(t){super(),gt(this,t,vp,mp,a,{})}}function wp(t,e,n){const r=t.slice();return r[5]=e[n],r}function bp(t){let e,n,r,i,o,s,a,l,u,h,d,f,p,_,g,m=t[5].title+"",v=t[5].artist+"";function y(){return t[4](t[5])}return{c(){e=I("div"),n=I("div"),r=I("img"),o=N(),s=I("div"),a=I("p"),l=I("strong"),u=S(m),h=N(),d=I("p"),f=S(v),p=N(),c(r.src,i=t[5].url)||P(r,"src",i),P(r,"class","svelte-jo2too"),P(n,"class","img-holder svelte-jo2too"),P(a,"class","svelte-jo2too"),P(d,"class","svelte-jo2too"),P(s,"class","txt-holder svelte-jo2too"),P(e,"class","artwork-holder clickable svelte-jo2too")},m(t,i){x(t,e,i),w(e,n),w(n,r),w(e,o),w(e,s),w(s,a),w(a,l),w(l,u),w(s,h),w(s,d),w(d,f),w(e,p),_||(g=R(e,"click",y),_=!0)},p(e,n){t=e,1&n&&!c(r.src,i=t[5].url)&&P(r,"src",i),1&n&&m!==(m=t[5].title+"")&&M(u,m),1&n&&v!==(v=t[5].artist+"")&&M(f,v)},d(t){t&&k(e),_=!1,g()}}}function Cp(t){let e,n,r,i,o,s,a,l,c,u,h,d,f=t[0],p=[];for(let e=0;e<f.length;e+=1)p[e]=bp(wp(t,f,e));return{c(){e=I("div"),n=I("div"),r=I("div"),i=I("h1"),i.textContent="Navigate Artworks",o=N(),s=I("div"),s.innerHTML='<span class="material-icons-round svelte-jo2too">close</span>',a=N(),l=I("div");for(let t=0;t<p.length;t+=1)p[t].c();P(s,"class","btn clickable svelte-jo2too"),P(r,"class","cont-header svelte-jo2too"),P(l,"class","artwork-container svelte-jo2too"),P(n,"class","container svelte-jo2too"),P(e,"class","modal svelte-jo2too")},m(c,f){x(c,e,f),w(e,n),w(n,r),w(r,i),w(r,o),w(r,s),w(n,a),w(n,l);for(let t=0;t<p.length;t+=1)p[t].m(l,null);u=!0,h||(d=R(s,"click",t[3]),h=!0)},p(t,[e]){if(5&e){let n;for(f=t[0],n=0;n<f.length;n+=1){const r=wp(t,f,n);p[n]?p[n].p(r,e):(p[n]=bp(r),p[n].c(),p[n].m(l,null))}for(;n<p.length;n+=1)p[n].d(1);p.length=f.length}},i(n){u||(X((()=>{c||(c=ut(e,t[1],{duration:150},!0)),c.run(1)})),u=!0)},o(n){c||(c=ut(e,t[1],{duration:150},!1)),c.run(0),u=!1},d(t){t&&k(e),E(p,t),t&&c&&c.end(),h=!1,d()}}}function xp(t,e,n){let r;function i(t){hf(`${t.key}`),bt.set(null)}d(t,of,(t=>n(0,r=t)));return[r,function(t,e){const n=Wt(t,e);return{duration:e.duration,css:t=>`\n\t\t\t\t${n.css(t)}\n\t\t\t\topacity: ${t};\n\t\t\t`}},i,()=>{bt.set(null)},t=>{i(t)}]}class kp extends mt{constructor(t){super(),gt(this,t,xp,Cp,a,{})}}const{document:Ep}=ht;function Ip(t){let e,n;return e=new kp({}),{c(){dt(e.$$.fragment)},m(t,r){ft(e,t,r),n=!0},i(t){n||(at(e.$$.fragment,t),n=!0)},o(t){lt(e.$$.fragment,t),n=!1},d(t){pt(e,t)}}}function Sp(t){let e,n,r,i;return n=new yp({}),{c(){e=I("div"),dt(n.$$.fragment),O(e,"height","auto"),O(e,"width","auto")},m(t,r){x(t,e,r),ft(n,e,null),i=!0},i(t){i||(at(n.$$.fragment,t),X((()=>{r||(r=ut(e,Ut,{},!0)),r.run(1)})),i=!0)},o(t){lt(n.$$.fragment,t),r||(r=ut(e,Ut,{},!1)),r.run(0),i=!1},d(t){t&&k(e),pt(n),t&&r&&r.end()}}}function Np(t){let e,n,r,i;return n=new gf({}),{c(){e=I("div"),dt(n.$$.fragment),O(e,"height","auto"),O(e,"width","auto")},m(t,r){x(t,e,r),ft(n,e,null),i=!0},i(t){i||(at(n.$$.fragment,t),X((()=>{r||(r=ut(e,Ut,{},!0)),r.run(1)})),i=!0)},o(t){lt(n.$$.fragment,t),r||(r=ut(e,Ut,{},!1)),r.run(0),i=!1},d(t){t&&k(e),pt(n),t&&r&&r.end()}}}function Tp(t){let e,n,r,i,o,s,a,l,u,h,d,f,p,_;n=new Pf({});let g="nav"==t[0]&&Ip();const m=[Np,Sp],v=[];function y(t,e){return"gallery"==t[1]?0:"record"==t[1]?1:-1}return~(s=y(t))&&(a=v[s]=m[s](t)),{c(){e=I("main"),dt(n.$$.fragment),r=N(),i=I("div"),g&&g.c(),o=N(),a&&a.c(),l=N(),u=I("html"),h=I("script"),P(i,"class","container"),Ep.title="How We Gaze",P(u,"lang","en"),c(h.src,d="./assets/webgazer.min.js")||P(h,"src","./assets/webgazer.min.js")},m(a,c){x(a,e,c),ft(n,e,null),w(e,r),w(e,i),g&&g.m(i,null),w(i,o),~s&&v[s].m(i,null),x(a,l,c),w(Ep.head,u),w(Ep.head,h),f=!0,p||(_=R(h,"load",t[2]),p=!0)},p(t,[e]){"nav"==t[0]?g?1&e&&at(g,1):(g=Ip(),g.c(),at(g,1),g.m(i,o)):g&&(ot(),lt(g,1,1,(()=>{g=null})),st());let n=s;s=y(t),s!==n&&(a&&(ot(),lt(v[n],1,1,(()=>{v[n]=null})),st()),~s?(a=v[s],a||(a=v[s]=m[s](t),a.c()),at(a,1),a.m(i,null)):a=null)},i(t){f||(at(n.$$.fragment,t),at(g),at(a),f=!0)},o(t){lt(n.$$.fragment,t),lt(g),lt(a),f=!1},d(t){t&&k(e),pt(n),g&&g.d(),~s&&v[s].d(),t&&k(l),k(u),k(h),p=!1,_()}}}function Rp(t,e,n){let r,i;function o(){At.set(jt().windowW),Ot.set(jt().windowH)}d(t,bt,(t=>n(0,r=t))),d(t,wt,(t=>n(1,i=t))),Ht({duration:1500,easing:Bt}),U((()=>{o()})),window.onresize=function(){o()};return t.$$.update=()=>{1&t.$$.dirty&&(document.querySelector("body").style.overflow=r?"hidden":"auto")},[r,i,()=>{Et.set(!0)}]}const Pp=new class extends mt{constructor(t){super(),gt(this,t,Rp,Tp,a,{})}}({target:document.body,props:{name:"world"}});return Pp}();
//# sourceMappingURL=bundle.js.map
